!function(e){function t(t){for(var i,s,a=t[0],h=t[1],c=t[2],l=0,d=[];l<a.length;l++)s=a[l],o[s]&&d.push(o[s][0]),o[s]=0;for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(e[i]=h[i]);for(u&&u(t);d.length;)d.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,a=1;a<n.length;a++){var h=n[a];0!==o[h]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},o={0:0},r=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],h=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var u=h;r.push([1478,1]),n()}({1478:function(e,t,n){"use strict";n.r(t);n(36);var i=n(546),o=n(87),r=n.n(o),s=n(1),a=n.n(s),h=n(2),c=n.n(h),u=n(5),l=n.n(u),d=n(6),p=n.n(d),f=n(7),y=n.n(f),v=function(e){return Array.isArray(e)?e.reduce(function(e,t){return e[t.name]=t.value,e},{}):e||{}},g=function(){function e(t,n){a()(this,e),this.sprite=void 0;var i=n.x,o=n.y,r=n.texture,s=n.frame;this.sprite=t.add.sprite(i,o,r,s),this.sprite.y-=this.sprite.height*this.sprite.originY,n.scale&&this.sprite.setScale(n.scale),n.depth&&this.sprite.setDepth(n.depth)}return c()(e,[{key:"destroy",value:function(){this.sprite.destroy(),delete this.sprite}}]),e}(),m=new(function(){function e(){a()(this,e),this.depths={parallax:1,background0:10,background1:11,background2:12,background3:13,background4:14,background5:15,background6:16,background7:17,background8:18,background9:19,background10:20,background11:21,background12:22,background13:23,background14:24,background15:25,background16:26,background17:27,background18:28,background19:29,ground:40,door:50,sign:50,adventurer:60,foreground0:70,foreground1:71,foreground2:72,foreground3:73,foreground4:74,foreground5:75,foreground6:76,foreground7:77,foreground8:78,foreground9:79,foreground10:80,foreground11:81,foreground12:82,foreground13:83,foreground14:84,foreground15:85,foreground16:86,foreground17:87,foreground18:88,foreground19:89,notifications:100,debug:200}}return c()(e,[{key:"depthFor",value:function(e){if(this.depths[e])return this.depths[e];throw new Error("DepthManager::INVALID_DEPTH_ID")}}]),e}()),b=function(e){function t(e,n){var i;return a()(this,t),(i=l()(this,p()(t).call(this,e,n))).map=void 0,i.tileset=void 0,i.tileLayers=void 0,i.objects=void 0,i.markers=void 0,i.zones=void 0,i.currentAreaKey=void 0,i.areaMap=void 0,i.backgroundSets=void 0,i.background=void 0,i.tileLayers=[],i.objects={},i.markers={},i.zones={},i.currentAreaKey="",i.areaMap={},i.backgroundSets={},i}return y()(t,e),c()(t,[{key:"registerArea",value:function(e,t,n,i){this.areaMap[e]={mapKey:t,tilesetName:n,tilesetKey:i}}},{key:"registerBackgroundSet",value:function(e,t){this.backgroundSets[e]=t}},{key:"load",value:function(e){this.currentAreaKey=e;var t=this.areaMap[e],n=this.scene.make.tilemap({key:t.mapKey}),i=n.addTilesetImage(t.tilesetName,t.tilesetKey);this.map=n,this.tileset=i,this.tileLayers=[],this.objects={},this.loadMarkers(),this.loadZones(),this.createBackground(v(this.map.properties)),this.createTileLayers(this.map.layers.map(function(e){return e.name})),this.createEntities(this.map.objects.map(function(e){return e.name}))}},{key:"unload",value:function(){this.currentAreaKey="",this.objects={},this.markers={},this.zones={},this.tileLayers.forEach(function(e){return e.destroy()}),this.tileLayers=[],delete this.tileset,this.map&&this.map.destroy(),this.background&&this.background.destroy()}},{key:"placeEntityAtMarker",value:function(e,t){var n=this.markers[t],i=e.getComponent(g).sprite;e.getComponent(g).sprite.setPosition(n.x,n.y-i.height*i.originY)}},{key:"getTileLayer",value:function(e){return this.tileLayers.find(function(t){return t.layer.name===e})}},{key:"getZone",value:function(e){return this.zones[e]}},{key:"getCollisionMap",value:function(){return v(this.map.properties).entityLayerCollisions.split(",").reduce(function(e,t){var n=t.split(":"),i=r()(n,2),o=i[0],s=i[1];return e[o]=e[o]||[],e[o].push(s),e},{})}},{key:"loadMarkers",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){v(t.properties).marker&&(e.markers[t.name]={x:t.x,y:t.y})})})}},{key:"loadZones",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){v(t.properties).zone&&(e.zones[t.name]={x:t.x,y:t.y,width:t.width,height:t.height})})})}},{key:"createTileLayers",value:function(e){var t=this;e.forEach(function(e){var n=t.map.createStaticLayer(e,t.tileset),i=v(n.layer.properties);i.collides&&(n.forEachTile(function(e){e.setCollision(!0,!0,!0,!0,!1)},t,0,0,n.width,n.height,{isNotEmpty:!0}),n.calculateFacesWithin(0,0,n.width,n.height)),n.setDepth(m.depthFor(i.depth)),t.tileLayers.push(n)})}},{key:"createEntities",value:function(e){var t=this;e.forEach(function(e){var n=t.map.getObjectLayer(e),i=v(n.properties),o=n.objects;t.objects[e]=[];var r=t.scene;o.forEach(function(n){var o=null;n.type&&(o=r.phecs.phEntities.createPrefab(n.type,n.properties,m.depthFor(i.depth),n.x,n.y),t.objects[e].push(o))})})}},{key:"createBackground",value:function(e){if(e.backgroundSet){var t=this.backgroundSets[e.backgroundSet].map(function(e){return{key:e}});this.background=this.scene.add.parallaxSprite(t,m.depthFor("parallax")),this.background.scrollWithCamera(this.scene.cameras.main)}else e.backgroundColor&&this.scene.cameras.main.setBackgroundColor("#".concat(e.backgroundColor))}}]),t}(Phaser.Plugins.ScenePlugin);function C(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}var x,k=function(){function e(){a()(this,e),this.onPressListeners=void 0,this.onReleaseListeners=void 0,this.isPressed=void 0,this.onPressListeners=[],this.onReleaseListeners=[],this.isPressed=!1}return c()(e,[{key:"onPress",value:function(e,t){var n=this,i=C();return this.onPressListeners.push({id:i,context:t,callback:e}),function(){var e=n.onPressListeners.findIndex(function(e){return e.id===i});n.onPressListeners.splice(e,1)}}},{key:"onRelease",value:function(e,t){var n=this,i=C();return this.onReleaseListeners.push({id:i,context:t,callback:e}),function(){var e=n.onReleaseListeners.findIndex(function(e){return e.id===i});n.onReleaseListeners.splice(e,1)}}},{key:"press",value:function(){if(!this.isPressed){var e=!0,t=!1,n=void 0;try{for(var i,o=this.onPressListeners[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value;r.callback.call(r.context)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}this.isPressed=!0}},{key:"release",value:function(){if(this.isPressed){var e=!0,t=!1,n=void 0;try{for(var i,o=this.onReleaseListeners[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value;r.callback.call(r.context)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}this.isPressed=!1}},{key:"destroy",value:function(){this.onPressListeners=[],this.onReleaseListeners=[]}}]),e}(),w=function(e){function t(e,n){var i;return a()(this,t),(i=l()(this,p()(t).call(this,e,n))).left=void 0,i.right=void 0,i.up=void 0,i.down=void 0,i.action=void 0,i.shoot=void 0,i.left=new k,i.right=new k,i.up=new k,i.down=new k,i.action=new k,i.shoot=new k,i}return y()(t,e),c()(t,[{key:"start",value:function(){this.startListening(),this.scene.events.once(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}},{key:"stop",value:function(){this.scene.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this),this.shutdown()}},{key:"startListening",value:function(){this.scene.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.onPress,this),this.scene.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_UP,this.onRelease,this)}},{key:"shutdown",value:function(){this.scene.input.keyboard.off(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.onPress,this),this.scene.input.keyboard.off(Phaser.Input.Keyboard.Events.ANY_KEY_UP,this.onRelease,this),this.left.destroy(),this.right.destroy(),this.up.destroy(),this.down.destroy(),this.action.destroy(),this.shoot.destroy()}},{key:"onPress",value:function(e){switch(e.code){case"ArrowLeft":this.left.press();break;case"ArrowRight":this.right.press();break;case"ArrowUp":this.up.press();break;case"ArrowDown":this.down.press();break;case"KeyF":this.action.press();break;case"Space":this.shoot.press()}}},{key:"onRelease",value:function(e){switch(e.code){case"ArrowLeft":this.left.release();break;case"ArrowRight":this.right.release();break;case"ArrowUp":this.up.release();break;case"ArrowDown":this.down.release();break;case"KeyF":this.action.release();break;case"Space":this.shoot.release()}}}]),t}(Phaser.Plugins.ScenePlugin),P=function(){function e(t,n,i){a()(this,e),this.scene=void 0,this.layers=void 0,this.scene=t;var o=t.cameras.main.centerX,r=t.cameras.main.centerY,s=t.cameras.main.width,h=t.cameras.main.height,c=n.length;this.layers=n.map(function(e,n){var a=t.add.tileSprite(o,r,s,h,e.key);return a.setScrollFactor(0),a.setDepth(i),{tileSprite:a,scrollFactor:(n+1)/c*.2}})}return c()(e,[{key:"scrollWithCamera",value:function(e){var t=this;this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,function(){return t.setOffset(e.scrollX)})}},{key:"setOffset",value:function(e){this.layers.forEach(function(t){t.tileSprite.setTilePosition(t.scrollFactor*e)})}},{key:"destroy",value:function(){this.layers.forEach(function(e){e.tileSprite.destroy()})}}]),e}(),E=function(e){function t(e){var n;return a()(this,t),n=l()(this,p()(t).call(this,e)),e.registerGameObject("parallaxSprite",n.createParallaxSprite),n}return y()(t,e),c()(t,[{key:"createParallaxSprite",value:function(e,t){return new P(this.scene,e,t)}}]),t}(Phaser.Plugins.BasePlugin),S=function(){function e(t){a()(this,e),this.progression=void 0,this.oldLady=[{conversationId:"oldLady1",unlockDependencies:[],completed:!1},{conversationId:"oldLady2",unlockDependencies:[{type:"conversation",name:"oldMan",index:0}],completed:!1},{conversationId:"oldLady3",unlockDependencies:[{type:"quest",name:"saveFarm",index:0}],completed:!1}],this.oldMan=[{conversationId:"oldMan1",unlockDependencies:[],completed:!1},{conversationId:"oldMan2",unlockDependencies:[{type:"conversation",name:"oldMan",index:0}],completed:!1},{conversationId:"oldMan3",unlockDependencies:[{type:"quest",name:"saveFarm",index:0}],completed:!1}],this.progression=t}return c()(e,[{key:"getCurrentConversationId",value:function(e){return this.getCurrentConversation(e).conversationId}},{key:"markCurrentConversationComplete",value:function(e){this.getCurrentConversation(e).completed=!0}},{key:"isUnlocked",value:function(e){return this.progression.areCompleted(e.unlockDependencies)}},{key:"isCompleted",value:function(e){switch(e.name){case"oldLady":return this.oldLady[e.index].completed;case"oldMan":return this.oldMan[e.index].completed;default:throw new Error("ConversationDocument::CANNOT_CHECK_IF_COMPLETE::INVALID_CONVERSATION_NAME")}}},{key:"fromJson",value:function(e){var t=this;e.oldLady.forEach(function(e,n){t.oldLady[n].completed=e}),e.oldMan.forEach(function(e,n){t.oldMan[n].completed=e})}},{key:"toJson",value:function(){return{oldLady:this.oldLady.map(function(e){return e.completed}),oldMan:this.oldMan.map(function(e){return e.completed})}}},{key:"reset",value:function(){this.oldLady.forEach(function(e){return e.completed=!1}),this.oldMan.forEach(function(e){return e.completed=!1})}},{key:"getCurrentConversation",value:function(e){var t=null;switch(e){case"oldLady":t=this.oldLady;break;case"oldMan":t=this.oldMan;break;default:throw new Error("ConversationDocument::CANNOT_GET_CURRENT_CONVERSATION_ID::INVALID_CONVERSATION_NAME")}for(var n=0,i=0;i<t.length;i++)this.isUnlocked(t[i])&&(n=i);return t[n]}}]),e}(),T=function(){function e(){a()(this,e),this.conversations=void 0,this.reset()}return c()(e,[{key:"areCompleted",value:function(e){var t=this;return e.every(function(e){switch(e.type){case"conversation":return t.conversations.isCompleted(e);case"quest":return!1}})}},{key:"reset",value:function(){this.conversations=new S(this)}},{key:"fromJson",value:function(e){this.conversations.fromJson(e.conversations)}},{key:"toJson",value:function(){return{conversations:this.conversations.toJson()}}}]),e}(),A=function(){function e(t){a()(this,e),this.propNames=void 0,this.onChangeListeners=void 0,this.data=void 0,this.propNames=t,this.onChangeListeners={},this.data={},Object.defineProperties(this,t.reduce(function(e,t){var n={get:function(){return this.data[t]},set:function(e){this.data[t]=e,(this.onChangeListeners[t]||[]).forEach(function(t){return t(e)})}};return e[t]=n,e},{}))}return c()(e,[{key:"onChange",value:function(e,t){var n=this;return this.onChangeListeners[e]=this.onChangeListeners[e]||[],this.onChangeListeners[e].push(t),function(){var i=n.onChangeListeners[e].findIndex(function(e){return e==t});n.onChangeListeners[e].splice(i,1)}}},{key:"toJson",value:function(){var e=this;return this.propNames.reduce(function(t,n){return t[n]=e.data[n],t},{})}},{key:"fromJson",value:function(e){var t=this;this.propNames.forEach(function(n){t.data[n]=e[n]})}}]),e}(),M=function(e){function t(){var e;return a()(this,t),(e=l()(this,p()(t).call(this,["maxHealth","health"]))).maxHealth=void 0,e.health=void 0,e.reset(),e}return y()(t,e),c()(t,[{key:"reset",value:function(){this.maxHealth=0,this.health=0}}]),t}(A),I=function(e){function t(){var e;return a()(this,t),(e=l()(this,p()(t).call(this,["areaKey","markerName"]))).areaKey=void 0,e.markerName=void 0,e.reset(),e}return y()(t,e),c()(t,[{key:"reset",value:function(){this.areaKey="",this.markerName=""}}]),t}(A),L="archer-adventure-save-game",D=function(e){function t(e){var n;return a()(this,t),(n=l()(this,p()(t).call(this,e))).data=void 0,n.progression=void 0,n.adventurer=void 0,n.location=void 0,n.data={},n.progression=new T,n.adventurer=new M,n.location=new I,n}return y()(t,e),c()(t,[{key:"hasSaveGame",value:function(){return null!=localStorage.getItem(L)}},{key:"resetSaveGame",value:function(){this.hasSaveGame()&&(this.progression.reset(),this.adventurer.reset(),this.location.reset(),this.save())}},{key:"save",value:function(){this.data.progression=this.progression.toJson(),this.data.adventurer=this.adventurer.toJson(),this.data.location=this.location.toJson(),localStorage.setItem(L,JSON.stringify(this.data))}},{key:"load",value:function(){var e=localStorage.getItem(L);if(!e)throw new Error("PERSISTENCE_PLUGIN::NO_SAVED_DATA");this.data=JSON.parse(e),this.progression.fromJson(this.data.progression),this.adventurer.fromJson(this.data.adventurer),this.location.fromJson(this.data.location)}}]),t}(Phaser.Plugins.BasePlugin),O=n(88),N=n.n(O),B=n(268),R=n.n(B),j=function(){function e(t){a()(this,e),this.type=void 0,this.id=void 0,this.components=void 0,this.type=t,this.id=C(),this.components=[]}return c()(e,[{key:"getComponent",value:function(e){var t=this.components.find(function(t){return t instanceof e});if(t)return t;throw new Error("BaseEntity::NO_COMPONENT_".concat(R()(e)))}},{key:"hasComponent",value:function(e){return this.components.some(function(t){return t instanceof e})}}]),e}(),F=function(){function e(t){a()(this,e),this.scene=void 0,this.prefabs=void 0,this.entitiesById=void 0,this.entities=void 0,this.scene=t,this.prefabs={},this.entitiesById={},this.entities=[]}return c()(e,[{key:"registerPrefab",value:function(e,t){this.prefabs[e]=t}},{key:"createPrefab",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=this.scene,s=new j(e),a=this.prefabs[e],h=N()({x:i,y:o,depth:n},v(t));return this.getComponentDefinitions(a).forEach(function(e){var t=new e.component(r,N()({},h,e.data),s);s.components.push(t)}),this.entitiesById[s.id]=s,this.entities.push(s),s}},{key:"getEntityById",value:function(e){return this.entitiesById[e]}},{key:"getEntities",value:function(e){if("string"==typeof e)return this.getEntitiesByType(e);if("function"==typeof e)return this.getEntitiesByComponent(e);throw new Error("Phecs.EntityManager::BAD_ENTITY_IDENTIFIER::".concat(e))}},{key:"destroy",value:function(){this.entities.forEach(function(e){e.components.forEach(function(e){return e.destroy()})}),this.entitiesById={},this.entities=[]}},{key:"getComponentDefinitions",value:function(e){return e.components.map(function(e){return"function"==typeof e?{component:e}:e})}},{key:"getEntitiesByComponent",value:function(e){return this.entities.filter(function(t){return t.hasComponent(e)})}},{key:"getEntitiesByType",value:function(e){return this.entities.filter(function(t){return t.type===e})}}]),e}(),H=function(){function e(t){a()(this,e),this.scene=void 0,this.systems=void 0,this.scene=t,this.systems=[]}return c()(e,[{key:"start",value:function(e){this.systems.forEach(function(t){t.start&&t.start(e)})}},{key:"stop",value:function(e){this.systems.forEach(function(t){t.stop&&t.stop(e)})}},{key:"update",value:function(e){this.systems.forEach(function(t){t.update&&t.update(e)})}},{key:"destroy",value:function(){this.systems.forEach(function(e){e.destroy&&e.destroy()}),this.systems=[]}},{key:"registerSystems",value:function(e){var t=this;e.forEach(function(e){t.systems.push(new e(t.scene))})}}]),e}(),G=function(e){function t(e,n){var i;return a()(this,t),(i=l()(this,p()(t).call(this,e,n))).phEntities=void 0,i.phSystems=void 0,i.phEntities=new F(e),i.phSystems=new H(e),i}return y()(t,e),c()(t,[{key:"start",value:function(){this.phSystems.start(this.phEntities),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"stop",value:function(){this.phSystems.stop(this.phEntities),this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"update",value:function(){this.phSystems.update(this.phEntities)}},{key:"destroy",value:function(){this.phEntities.destroy()}},{key:"reset",value:function(){this.stop(),this.destroy()}},{key:"shutdown",value:function(){this.stop(),this.destroy(),this.phSystems.destroy()}}]),t}(Phaser.Plugins.ScenePlugin),_=function(e){function t(e,n){var i;return a()(this,t),(i=l()(this,p()(t).call(this,e,n))).states=void 0,i.sets=void 0,i.states={},i.sets={},i}return y()(t,e),c()(t,[{key:"destroy",value:function(){this.states={},this.sets={}}},{key:"registerSets",value:function(e){var t=this;e.forEach(function(e){return t.addSet(e.id,e.states)})}},{key:"getState",value:function(e){return this.states[e]}},{key:"getSet",value:function(e){var t=this;return this.sets[e].map(function(e){return t.states[e]})}},{key:"addSet",value:function(e,t){var n=this;t.forEach(function(e){n.states[e.id]=e}),this.sets[e]=t.map(function(e){return e.id})}}]),t}(Phaser.Plugins.ScenePlugin),K=function(e){function t(){var e,n;a()(this,t);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=l()(this,(e=p()(t)).call.apply(e,[this].concat(o)))).phecs=void 0,n.areaManager=void 0,n.stateRegistrar=void 0,n.persistence=void 0,n.controls=void 0,n}return y()(t,e),t}(Phaser.Scene),X={maxVelocity:350,horizontalAcceleration:800,horizontalDeceleration:2e3,slideVelocityThreshold:250,slideDeceleration:350,shortJumpVelocity:-350,jumpVelocity:-425,aerialMaxHorizontalVelocity:250,aerialHorizontalAcceleration:300,aerialHorizontalFrictionAcceleration:150};!function(e){e[e.Initial=0]="Initial",e[e.PressControl=1]="PressControl",e[e.ReleaseControl=2]="ReleaseControl",e[e.Conditional=3]="Conditional",e[e.Timer=4]="Timer"}(x||(x={}));var z=function(){function e(t,n,i){a()(this,e),this.body=void 0,t.physics.add.existing(i.getComponent(g).sprite);var o=i.getComponent(g).sprite;this.body=o.body,this.body.setSize(o.width,o.height),this.body.updateBounds(),n.maxVelocityX&&(this.body.maxVelocity.x=n.maxVelocityX)}return c()(e,[{key:"destroy",value:function(){this.body.destroy(),delete this.body}}]),e}(),V={transitions:[{type:x.Conditional,condition:function(e){return!e.getComponent(z).body.blocked.down},to:function(e){return e.getComponent(z).body.velocity.y=100,e.getComponent(z).body.velocity.x>0?"adventurer-fall-right":e.getComponent(z).body.velocity.x<0?"adventurer-fall-left":"adventurer-fall"}}]};function Y(e,t){var n=[e.onEnter,t.onEnter].filter(Boolean),i=[e.onUpdate,t.onUpdate].filter(Boolean),o=[e.onLeave,t.onLeave].filter(Boolean),r=[e.transitions,t.transitions].filter(Boolean).flat(),s=N()({},e.data,t.data);return{id:e.id||t.id,transitions:r,data:s,onEnter:function(e,t){return n.forEach(function(n){return n(e,t)})},onUpdate:function(e,t){return i.forEach(function(n){return n(e,t)})},onLeave:function(e,t){return o.forEach(function(n){return n(e,t)})}}}var U=Y(V,{onEnter:function(e){!function(e){e.getComponent(z).body.acceleration.x=e.getComponent(z).body.velocity.x<0?X.horizontalDeceleration:-X.horizontalDeceleration}(e)},onUpdate:function(e){!function(e){Phaser.Math.Within(e.getComponent(z).body.velocity.x,0,100)&&(e.getComponent(z).body.acceleration.x=0,e.getComponent(z).body.velocity.x=0)}(e)}}),W=Y(U,{id:"adventurer-stand",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-stand")},transitions:[{type:x.PressControl,control:"right",to:"adventurer-run-right"},{type:x.PressControl,control:"left",to:"adventurer-run-left"},{type:x.PressControl,control:"down",to:"adventurer-crouch"},{type:x.PressControl,control:"up",to:"adventurer-jump-prep"},{type:x.PressControl,control:"shoot",to:"adventurer-stand-draw"}]}),J=function(){function e(t,n,i,o){a()(this,e),this.scene=void 0,this.entity=void 0,this.states=void 0,this.initialState=void 0,this.triggerCancelers=void 0,this.currentState=void 0,this.scene=t,this.entity=n,this.states=i,this.initialState=o,this.currentState={id:"dummy",transitions:[]},this.triggerCancelers=[]}return c()(e,[{key:"update",value:function(){this.currentState.onUpdate&&this.currentState.onUpdate(this.entity,this.currentState.data||{})}},{key:"doTransition",value:function(e){this.cancelTransitionTriggers(),this.currentState.onLeave&&this.currentState.onLeave(this.entity,this.currentState.data||{});var t="string"==typeof e.to?e.to:e.to(this.entity);this.currentState=this.states.find(function(e){return e.id===t}),e.onTransition&&e.type!==x.Initial&&e.onTransition(this.entity),this.currentState.onEnter&&this.currentState.onEnter(this.entity,this.currentState.data||{}),this.registerTransitionTriggers()}},{key:"disable",value:function(){this.doTransition({to:this.initialState.id}),this.cancelTransitionTriggers()}},{key:"enable",value:function(){this.registerTransitionTriggers()}},{key:"destroy",value:function(){this.cancelTransitionTriggers()}},{key:"cancelTransitionTriggers",value:function(){this.triggerCancelers.forEach(function(e){return e()}),this.triggerCancelers=[]}},{key:"registerTransitionTriggers",value:function(){var e=this;this.currentState.transitions.forEach(function(t){switch(t.type){case x.PressControl:e.registerPressControlTransitionTrigger(t);break;case x.ReleaseControl:e.registerReleaseControlTransitionTrigger(t);break;case x.Conditional:e.registerConditionalTransitionTrigger(t);break;case x.Timer:e.registerTimerTransitionTrigger(t)}})}},{key:"registerPressControlTransitionTrigger",value:function(e){var t=this,n=this.scene.controls[e.control].onPress(function(){return t.doTransition(e)});this.triggerCancelers.push(n)}},{key:"registerReleaseControlTransitionTrigger",value:function(e){var t=this,n=this.scene.controls[e.control].onRelease(function(){return t.doTransition(e)});this.triggerCancelers.push(n)}},{key:"registerConditionalTransitionTrigger",value:function(e){var t=this,n=function(){e.condition(t.entity)&&t.doTransition(e)};this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,n),this.triggerCancelers.push(function(){return t.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,n)})}},{key:"registerTimerTransitionTrigger",value:function(e){var t=this,n="number"==typeof e.delay?e.delay:e.delay(),i=this.scene.time.delayedCall(n,function(){t.doTransition(e)});this.triggerCancelers.push(function(){return i.remove()})}}]),e}(),Z=function(){function e(t,n,i){a()(this,e),this.phiniteStateMachine=void 0;var o=t,r=o.stateRegistrar.getSet(n.stateSet),s=o.stateRegistrar.getState(n.initialStateId);this.phiniteStateMachine=new J(t,i,r,s),this.phiniteStateMachine.doTransition({type:x.Initial,to:s.id})}return c()(e,[{key:"destroy",value:function(){this.phiniteStateMachine.destroy(),delete this.phiniteStateMachine}}]),e}(),q=3,Q=function(){function e(t,n,i){a()(this,e),this.shotPower=void 0,this.shotChargeRate=void 0,this.minShotPower=void 0,this.maxShotPower=void 0,this.arrows=void 0,this.entity=void 0;var o=t;this.entity=i,this.minShotPower=300,this.maxShotPower=700,this.shotChargeRate=15,this.shotPower=this.minShotPower,this.arrows=[];for(var r=0;r<q;r++){var s=o.phecs.phEntities.createPrefab("arrow",{},i.getComponent(g).sprite.depth,0,0);s.getComponent(Z).phiniteStateMachine.doTransition({to:"arrow-disabled"}),this.arrows.push(s)}}return c()(e,[{key:"shootArrow",value:function(){var e=this.getAvailableArrow();e.getComponent(g).sprite.x=this.entity.getComponent(g).sprite.x,e.getComponent(g).sprite.y=this.entity.getComponent(g).sprite.y,e.getComponent(Z).phiniteStateMachine.doTransition({to:"arrow-flying"});var t=Phaser.Math.Clamp(this.shotPower,this.minShotPower,this.maxShotPower);this.entity.getComponent(g).sprite.flipX&&(t*=-1),e.getComponent(z).body.setVelocity(t,0),e.getComponent(z).body.setGravityY(-500),this.shotPower=this.minShotPower}},{key:"getAvailableArrow",value:function(){var e=this.arrows.filter(function(e){return"arrow-disabled"===e.getComponent(Z).phiniteStateMachine.currentState.id}),t=this.arrows.filter(function(e){return"arrow-hit"===e.getComponent(Z).phiniteStateMachine.currentState.id});if(e.length)return e[0];if(t.length)return t[0];throw new Error("ShootsArrows::shootArrow::NO_AVAILABLE_ARROWS")}},{key:"destroy",value:function(){this.arrows=[]}}]),e}(),$=Y(U,{id:"adventurer-stand-draw",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-stand-draw",!0)},onUpdate:function(e){e.getComponent(Q).shotPower+=e.getComponent(Q).shotChargeRate},transitions:[{type:x.Conditional,condition:function(e){return!e.getComponent(g).sprite.anims.isPlaying},to:"adventurer-stand-hold"},{type:x.ReleaseControl,control:"shoot",to:"adventurer-stand-shoot"},{type:x.PressControl,control:"left",to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(g).sprite.flipX=!0}},{type:x.PressControl,control:"right",to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(g).sprite.flipX=!1}}]}),ee=Y(U,{id:"adventurer-stand-hold",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-stand-hold",!0)},onUpdate:function(e){e.getComponent(Q).shotPower+=e.getComponent(Q).shotChargeRate},transitions:[{type:x.ReleaseControl,control:"shoot",to:"adventurer-stand-shoot"},{type:x.PressControl,control:"left",to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(g).sprite.flipX=!0}},{type:x.PressControl,control:"right",to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(g).sprite.flipX=!1}}]}),te=function(){function e(t){a()(this,e),this.scene=void 0,this.scene=t}return c()(e,[{key:"destroy",value:function(){delete this.scene}}]),e}(),ne=Y(U,{id:"adventurer-stand-shoot",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-stand-shoot")},onLeave:function(e){e.getComponent(Q).shootArrow()},transitions:[{type:x.Conditional,condition:function(e){return!e.getComponent(g).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(te).scene.controls;return t.right.isPressed?"adventurer-run-right":t.left.isPressed?"adventurer-run-left":"adventurer-stand"}}]}),ie=Y(U,{onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-crouch")},transitions:[{type:x.ReleaseControl,control:"down",to:function(e){var t=e.getComponent(te).scene.controls;return t.left.isPressed?"adventurer-run-left":t.right.isPressed?"adventurer-run-right":"adventurer-stand"}}]}),oe=Y(ie,{id:"adventurer-crouch",transitions:[{type:x.PressControl,control:"left",to:"adventurer-crouch-left"},{type:x.PressControl,control:"right",to:"adventurer-crouch-right"}]}),re=Y(ie,{id:"adventurer-crouch-left",onEnter:function(e){e.getComponent(g).sprite.flipX=!0},transitions:[{type:x.PressControl,control:"right",to:"adventurer-crouch-right"}]}),se=Y(ie,{id:"adventurer-crouch-right",onEnter:function(e){e.getComponent(g).sprite.flipX=!1},transitions:[{type:x.PressControl,control:"left",to:"adventurer-crouch-left"}]}),ae=Y(V,{onEnter:function(e){e.getComponent(g).sprite.flipX=!1,e.getComponent(g).sprite.anims.play("adventurer-run")},transitions:[{type:x.PressControl,control:"shoot",to:"adventurer-stand-draw"},{type:x.PressControl,control:"down",to:function(e){return Math.abs(e.getComponent(z).body.velocity.x)<X.slideVelocityThreshold?"adventurer-crouch":"adventurer-slide"}},{type:x.PressControl,control:"up",to:"adventurer-jump-prep"}]});function he(e,t){"left"===t?e.getComponent(z).body.acceleration.x=-X.horizontalAcceleration:"right"===t&&(e.getComponent(z).body.acceleration.x=X.horizontalAcceleration),function(e){Phaser.Math.Within(e.getComponent(z).body.velocity.x,0,5)||(e.getComponent(z).body.velocity.x+=.5*e.getComponent(z).body.velocity.x*-1)}(e)}var ce=Y(ae,{id:"adventurer-run-right",onEnter:function(e){e.getComponent(g).sprite.flipX=!1,e.getComponent(g).sprite.anims.play("adventurer-run"),he(e,"right")},transitions:[{type:x.ReleaseControl,control:"right",to:"adventurer-stand"},{type:x.PressControl,control:"left",to:"adventurer-run-left"}]}),ue=Y(ae,{id:"adventurer-run-left",onEnter:function(e){e.getComponent(g).sprite.flipX=!0,e.getComponent(g).sprite.anims.play("adventurer-run"),he(e,"left")},transitions:[{type:x.ReleaseControl,control:"left",to:"adventurer-stand"},{type:x.PressControl,control:"right",to:"adventurer-run-right"}]}),le=Y(V,{id:"adventurer-slide",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-slide"),e.getComponent(z).body.velocity.x>0?e.getComponent(z).body.acceleration.x=-1*X.slideDeceleration:e.getComponent(z).body.acceleration.x=X.slideDeceleration},onUpdate:function(e){Phaser.Math.Within(e.getComponent(z).body.velocity.x,0,5)&&(e.getComponent(z).body.acceleration.x=0)},transitions:[{type:x.Conditional,condition:function(e){return!e.getComponent(g).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(te).scene.controls;return t.left.isPressed?"adventurer-run-left":t.right.isPressed?"adventurer-run-right":t.down.isPressed?"adventurer-crouch":"adventurer-stand"}},{type:x.PressControl,control:"up",to:"adventurer-jump-prep"}]}),de={id:"adventurer-jump-prep",onEnter:function(e){e.getComponent(z).body.acceleration.x=0,e.getComponent(g).sprite.anims.play("adventurer-jump-prep")},transitions:[{type:x.Conditional,condition:function(e){return!e.getComponent(g).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(te).scene.controls;return t.right.isPressed?"adventurer-jump-right":t.left.isPressed?"adventurer-jump-left":e.getComponent(z).body.velocity.x>0?"adventurer-jump-right":e.getComponent(z).body.velocity.x<0?"adventurer-jump-left":"adventurer-jump"},onTransition:function(e){e.getComponent(te).scene.controls.up.isPressed?e.getComponent(z).body.velocity.y=X.jumpVelocity:e.getComponent(z).body.velocity.y=X.shortJumpVelocity}}]};var pe,fe,ye,ve={onUpdate:function(e,t){var n=e.getComponent(z).body,i=e.getComponent(te).scene.controls;i.left.isPressed||i.right.isPressed?function(e,t){var n=e.getComponent(z).body,i=e.getComponent(te).scene.controls;i.left.isPressed&&n.velocity.x>t?n.acceleration.x=-1*X.aerialHorizontalAcceleration:i.right.isPressed&&n.velocity.x<t&&(n.acceleration.x=X.aerialHorizontalAcceleration)}(e,t.targetAerialHorizontalVelocity):function(e){var t=e.getComponent(z).body;t.velocity.x>0?t.acceleration.x=-1*X.aerialHorizontalFrictionAcceleration:t.velocity.x<0?t.acceleration.x=X.aerialHorizontalFrictionAcceleration:t.acceleration.x=0}(e),Phaser.Math.Within(t.targetAerialHorizontalVelocity,n.velocity.x,5)&&(n.acceleration.x=0,n.velocity.x=t.targetAerialHorizontalVelocity)}},ge=Y(ve,{onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-jump-rise")},transitions:[{type:x.PressControl,control:"shoot",to:"adventurer-air-draw"}]}),me=Y(ge,{id:"adventurer-jump",data:{targetAerialHorizontalVelocity:0},transitions:[{type:x.PressControl,control:"left",to:"adventurer-jump-left"},{type:x.PressControl,control:"right",to:"adventurer-jump-right"},{type:x.Conditional,condition:function(e){return e.getComponent(z).body.velocity.y>1},to:"adventurer-fall"}]}),be=Y(ge,{id:"adventurer-jump-left",data:{targetAerialHorizontalVelocity:-1*X.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(g).sprite.flipX=!0},transitions:[{type:x.PressControl,control:"right",to:"adventurer-jump-right"},{type:x.Conditional,condition:function(e){return e.getComponent(z).body.velocity.y>0},to:"adventurer-fall-left"}]}),Ce=Y(ge,{id:"adventurer-jump-right",data:{targetAerialHorizontalVelocity:X.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(g).sprite.flipX=!1},transitions:[{type:x.PressControl,control:"left",to:"adventurer-jump-left"},{type:x.Conditional,condition:function(e){return e.getComponent(z).body.velocity.y>0},to:"adventurer-fall-right"}]}),xe=Y(ve,{onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-fall")},transitions:[{type:x.PressControl,control:"shoot",to:"adventurer-air-draw"},{type:x.Conditional,condition:function(e){return e.getComponent(z).body.blocked.down},to:function(e){var t=e.getComponent(te).scene.controls;return t.down.isPressed?Math.abs(e.getComponent(z).body.velocity.x)<X.slideVelocityThreshold?"adventurer-crouch":"adventurer-slide":t.left.isPressed?"adventurer-run-left":t.right.isPressed?"adventurer-run-right":"adventurer-stand"}}]}),ke=[W,$,ee,ne,oe,re,se,ce,ue,le,de,me,be,Ce,Y(xe,{id:"adventurer-fall",data:{horizontalMaxVelocity:0},transitions:[{type:x.PressControl,control:"left",to:"adventurer-fall-left"},{type:x.PressControl,control:"right",to:"adventurer-fall-right"}]}),Y(xe,{id:"adventurer-fall-left",data:{targetAerialHorizontalVelocity:-1*X.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(g).sprite.flipX=!0},transitions:[{type:x.PressControl,control:"right",to:"adventurer-fall-right"}]}),Y(xe,{id:"adventurer-fall-right",data:{targetAerialHorizontalVelocity:X.aerialMaxHorizontalVelocity},onEnter:function(e,t){e.getComponent(g).sprite.flipX=!1},transitions:[{type:x.PressControl,control:"left",to:"adventurer-fall-left"}]}),Y(ve,{id:"adventurer-air-draw",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-air-draw",!0)},onUpdate:function(e){e.getComponent(Q).shotPower+=e.getComponent(Q).shotChargeRate},transitions:[{type:x.Conditional,condition:function(e){return e.getComponent(z).body.blocked.down},to:"adventurer-stand-hold"},{type:x.ReleaseControl,control:"shoot",to:"adventurer-air-shoot"},{type:x.Conditional,condition:function(e){return!e.getComponent(g).sprite.anims.isPlaying},to:"adventurer-air-hold"},{type:x.PressControl,control:"left",to:"adventurer-air-draw",onTransition:function(e){e.getComponent(g).sprite.flipX=!0}},{type:x.PressControl,control:"right",to:"adventurer-air-draw",onTransition:function(e){e.getComponent(g).sprite.flipX=!1}}]}),Y(ve,{id:"adventurer-air-hold",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-air-hold",!0)},onUpdate:function(e){e.getComponent(Q).shotPower+=e.getComponent(Q).shotChargeRate},transitions:[{type:x.Conditional,condition:function(e){return e.getComponent(z).body.blocked.down},to:"adventurer-stand-hold"},{type:x.ReleaseControl,control:"shoot",to:"adventurer-air-shoot"},{type:x.PressControl,control:"left",to:"adventurer-air-hold",onTransition:function(e){e.getComponent(g).sprite.flipX=!0}},{type:x.PressControl,control:"right",to:"adventurer-air-hold",onTransition:function(e){e.getComponent(g).sprite.flipX=!1}}]}),Y(ve,{id:"adventurer-air-shoot",onEnter:function(e){e.getComponent(g).sprite.anims.play("adventurer-air-shoot")},transitions:[{type:x.Conditional,condition:function(e){return e.getComponent(z).body.blocked.down},to:"adventurer-stand-shoot"},{type:x.Conditional,condition:function(e){return!e.getComponent(g).sprite.anims.isPlaying},to:function(e){return e.getComponent(z).body.velocity.y<0?"adventurer-jump":"adventurer-fall"},onTransition:function(e){e.getComponent(Q).shootArrow()}}]})],we={id:"arrow-flying",transitions:[{type:x.Conditional,condition:function(e){return!e.getComponent(z).body.blocked.none},to:"arrow-hit"}],onEnter:function(e){e.getComponent(g).sprite.active=!0,e.getComponent(g).sprite.visible=!0,e.getComponent(z).body.enable=!0,e.getComponent(z).body.allowGravity=!0,e.getComponent(z).body.setVelocity(400,0)},onUpdate:function(e){if(e.getComponent(z).body.blocked.none){var t=Math.atan2(e.getComponent(z).body.velocity.y,e.getComponent(z).body.velocity.x);e.getComponent(g).sprite.rotation=t}}},Pe={id:"arrow-hit",transitions:[],onEnter:function(e){e.getComponent(z).body.setVelocity(0,0),e.getComponent(z).body.allowGravity=!1}},Ee=function(){function e(t,n,i){a()(this,e),this.config=void 0,this.shape=void 0,this.debugGraphic=void 0,this.config=t,this.shape=new Phaser.Geom.Rectangle(0,0,t.width,t.height),n&&i&&(this.debugGraphic=i.add.rectangle(this.shape.x,this.shape.y,this.shape.width,this.shape.height,n,.5),this.debugGraphic.setOrigin(0),this.debugGraphic.setDepth(m.depthFor("debug")))}return c()(e,[{key:"setConfig",value:function(e){this.config=e}},{key:"disable",value:function(){this.shape.x=0,this.shape.y=0,this.shape.width=0,this.shape.height=0,this.debugGraphic&&(this.debugGraphic.width=0,this.debugGraphic.height=0)}},{key:"overlapsRectangle",value:function(e){return Phaser.Geom.Intersects.RectangleToRectangle(e,this.shape)}},{key:"overlapsCircle",value:function(e){return Phaser.Geom.Intersects.CircleToRectangle(e,this.shape)}},{key:"syncToSprite",value:function(e){var t=e.scaleX,n=e.scaleY,i=(e.flipX?-1*this.config.offsetX:this.config.offsetX)*t,o=(e.flipY?-1*this.config.offsetY:this.config.offsetY)*n,r=t*this.config.width,s=n*this.config.height,a=e.getCenter(),h=new Phaser.Geom.Point(a.x+i,a.y+o);Phaser.Math.RotateAround(h,a.x,a.y,e.rotation),h.x-=r/2,h.y-=s/2,this.shape.x=h.x,this.shape.y=h.y,this.shape.width=r,this.shape.height=s,this.debugGraphic&&(this.debugGraphic.x=this.shape.x,this.debugGraphic.y=this.shape.y,this.debugGraphic.width=this.shape.width,this.debugGraphic.height=this.shape.height)}},{key:"destroy",value:function(){this.debugGraphic&&this.debugGraphic.destroy(),delete this.shape,delete this.destroy}}]),e}(),Se=function(){function e(t,n,i){a()(this,e),this.config=void 0,this.shape=void 0,this.debugGraphic=void 0,this.config=t,this.shape=new Phaser.Geom.Circle(0,0,t.radius),n&&i&&(this.debugGraphic=i.add.circle(this.shape.x,this.shape.y,this.shape.radius,n,.5),this.debugGraphic.setOrigin(.5),this.debugGraphic.setDepth(m.depthFor("debug")))}return c()(e,[{key:"setConfig",value:function(e){this.config=e}},{key:"disable",value:function(){this.shape.x=0,this.shape.y=0,this.shape.radius=0,this.debugGraphic&&(this.debugGraphic.radius=0)}},{key:"overlapsRectangle",value:function(e){return Phaser.Geom.Intersects.CircleToRectangle(this.shape,e)}},{key:"overlapsCircle",value:function(e){return Phaser.Geom.Intersects.CircleToCircle(this.shape,e)}},{key:"syncToSprite",value:function(e){var t=e.scale,n=(e.flipX?-1*this.config.offsetX:this.config.offsetX)*t,i=(e.flipY?-1*this.config.offsetY:this.config.offsetY)*t,o=t*this.config.radius,r=e.getCenter(),s=new Phaser.Geom.Point(r.x+n,r.y+i);Phaser.Math.RotateAround(s,r.x,r.y,e.rotation),this.shape.x=s.x,this.shape.y=s.y,this.shape.radius=o,this.debugGraphic&&(this.debugGraphic.x=this.shape.x,this.debugGraphic.y=this.shape.y,this.debugGraphic.radius=this.shape.radius)}},{key:"destroy",value:function(){this.debugGraphic&&this.debugGraphic.destroy(),delete this.shape,delete this.destroy}}]),e}(),Te=function(){function e(t,n,i,o){if(a()(this,e),this.type=void 0,this.shape=void 0,this.enabled=void 0,this.type=t,this.enabled=!0,"circle"===n.shape)this.shape=new Se(n,i,o);else{if("rectangle"!==n.shape)throw new Error("Attachment::INVALID_SHAPE_TYPE_IN_CONFIG");this.shape=new Ee(n,i,o)}}return c()(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.shape.disable()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"overlaps",value:function(e){if(this.shape instanceof Ee){if(e.shape instanceof Ee)return this.shape.overlapsRectangle(e.shape.shape);if(e.shape instanceof Se)return this.shape.overlapsCircle(e.shape.shape)}else if(this.shape instanceof Se){if(e.shape instanceof Ee)return this.shape.overlapsRectangle(e.shape.shape);if(e.shape instanceof Se)return this.shape.overlapsCircle(e.shape.shape)}throw new Error("Attachment::INVALID_ATTACHMENT_FOR_OVERLAP")}},{key:"setConfig",value:function(e){this.shape instanceof Ee&&this.shape.setConfig(e)}},{key:"syncToSprite",value:function(e){this.enabled&&this.shape.syncToSprite(e)}},{key:"destroy",value:function(){this.shape.destroy()}}]),e}(),Ae=function(){function e(t,n,i){a()(this,e),this.attachments=void 0,this.scene=void 0,this.data=void 0,this.scene=t,this.data=n,this.attachments=[]}return c()(e,[{key:"createAttachment",value:function(e,t,n){var i=new Te(e,t,n,this.scene);return this.attachments.push(i),i}},{key:"getAttachmentsByType",value:function(e){return this.attachments.filter(function(t){return t.type===e})}},{key:"destroy",value:function(){this.attachments.forEach(function(e){return e.destroy()}),delete this.attachments,delete this.getAttachmentsByType,delete this.createAttachment}}]),e}(),Me=16711680,Ie=function(){function e(t,n,i){a()(this,e),this.hitboxFrames=void 0,this.enabled=void 0,this.entity=void 0,this.entity=i,this.hitboxFrames=t.cache.json.get(n.hitboxesKey).frames,this.enabled=!0;for(var o=this.hitboxFrames.map(function(e){return e.hitboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),r=0;r<o;r++)i.getComponent(Ae).createAttachment("hitbox",{shape:"rectangle",offsetX:0,offsetY:0,width:0,height:0},n.debug?Me:void 0)}return c()(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(Ae).getAttachmentsByType("hitbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hitboxFrames}}]),e}(),Le=[we,Pe,{id:"arrow-disabled",transitions:[],onEnter:function(e){e.getComponent(g).sprite.active=!1,e.getComponent(g).sprite.visible=!1,e.getComponent(z).body.enable=!1,e.getComponent(z).body.allowGravity=!1,e.getComponent(Ie).disable()},onLeave:function(e){e.getComponent(g).sprite.active=!0,e.getComponent(g).sprite.visible=!0,e.getComponent(z).body.enable=!0,e.getComponent(z).body.allowGravity=!0,e.getComponent(Ie).enable()}}],De=n(269),Oe=n.n(De),Ne=function(){function e(){a()(this,e),this.entities=void 0,this.entities={}}return c()(e,[{key:"update",value:function(e){var t=this;new Set([].concat(Oe()(Object.keys(this.entities)),Oe()(e))).forEach(function(n){var i=t.entities[n];null!=i&&"inactive"!==i||!e.includes(n)?"entering"===i?t.entities[n]="active":"active"!==i||e.includes(n)?"exiting"===i&&(t.entities[n]="inactive"):t.entities[n]="exiting":t.entities[n]="entering"})}},{key:"getEntityIds",value:function(e){return Object.entries(this.entities).filter(function(t){var n=r()(t,2);n[0];return n[1]===e}).map(function(e){return r()(e,1)[0]})}},{key:"destroy",value:function(){this.entities={}}}]),e}(),Be=65280,Re=function(){function e(t,n,i){a()(this,e),this.interactionTracker=void 0,this.debugInteractionCircle=void 0,this.attachment=void 0,this.attachment=i.getComponent(Ae).createAttachment("interaction",N()({offsetX:0,offsetY:0},n.shapeConfig||{shape:"circle",radius:n.interactionRadius}),n.debug?Be:void 0),this.interactionTracker=new Ne}return c()(e,[{key:"destroy",value:function(){this.interactionTracker.destroy(),this.attachment.destroy(),delete this.interactionTracker,delete this.debugInteractionCircle}}]),e}(),je=function(){function e(t,n){a()(this,e),this.scene=void 0,this.scene=t}return c()(e,[{key:"decreaseHealth",value:function(e){this.scene.persistence.adventurer.health-=e}},{key:"destroy",value:function(){}}]),e}(),Fe={id:"enemy-idle",onEnter:function(e){e.getComponent(z).body.velocity.x=0,e.getComponent(g).sprite.anims.play("enemy-idle")},transitions:[{type:x.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:x.Conditional,condition:function(e){var t=e.getComponent(Re).interactionTracker.getEntityIds("active"),n=e.getComponent(te).scene,i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var h=s.value;if(n.phecs.phEntities.getEntityById(h).hasComponent(je))return!0}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return!1},to:"enemy-track-adventurer"}]},He=255,Ge=function(){function e(t,n,i){a()(this,e),this.hurtboxFrames=void 0,this.enabled=void 0,this.entity=void 0,this.entity=i,this.hurtboxFrames=t.cache.json.get(n.hurtboxesKey).frames,this.enabled=!0;for(var o=this.hurtboxFrames.map(function(e){return e.hurtboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),r=0;r<o;r++)i.getComponent(Ae).createAttachment("hurtbox",{shape:"rectangle",offsetX:0,offsetY:0,width:0,height:0},n.debug?He:void 0)}return c()(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(Ae).getAttachmentsByType("hurtbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hurtboxFrames}}]),e}(),_e={id:"enemy-dead",onEnter:function(e){var t=e.getComponent(g).sprite;t.anims.stop(),e.getComponent(z).body.enable=!1,e.getComponent(Ge).disable(),e.getComponent(te).scene.tweens.add({targets:[t],props:{alpha:0},duration:100,yoyo:!0,repeat:1,onComplete:function(){t.active=!1,t.visible=!1}})},transitions:[]},Ke={id:"enemy-stun",onEnter:function(e){var t=e.getComponent(g).sprite,n=e.getComponent(z).body;t.anims.stop(),n.allowGravity=!1,n.velocity.x=0,n.velocity.y=0,e.getComponent(te).scene.tweens.timeline({tweens:[{targets:t,props:{alpha:.5},duration:100,completeDelay:300},{targets:t,props:{alpha:1},duration:100}]})},onLeave:function(e){e.getComponent(z).body.allowGravity=!0},transitions:[{type:x.Conditional,condition:function(e){var t=e.getComponent(g).sprite;return!e.getComponent(te).scene.tweens.isTweening(t)},to:function(e){return e.getComponent(z).body.blocked.down?"enemy-idle":"enemy-fall"}}]},Xe=-350,ze=60,Ve=30,Ye={id:"enemy-jump",onEnter:function(e){e.getComponent(g).sprite.anims.play("enemy-jump"),e.getComponent(z).body.velocity.y=Xe},transitions:[{type:x.Conditional,condition:function(e){return e.getComponent(z).body.velocity.y<=0},to:"enemy-fall"}]},Ue={id:"enemy-track-adventurer",onEnter:function(e){e.getComponent(g).sprite.anims.play("enemy-jump")},onUpdate:function(e){var t=e.getComponent(te).scene.phecs.phEntities.getEntities(je)[0].getComponent(g).sprite,n=e.getComponent(g).sprite,i=e.getComponent(z).body;n.x<t.x?(i.velocity.x=ze,n.flipX=!1):n.x>t.x&&(i.velocity.x=-ze,n.flipX=!0)},transitions:[{type:x.Timer,delay:1e3,to:"enemy-jump-prep"},{type:x.Conditional,condition:function(e){var t=e.getComponent(te).scene,n=e.getComponent(Re).interactionTracker.getEntityIds("active"),i=t.phecs.phEntities.getEntities(je)[0].id;return!n.includes(i)},to:"enemy-idle"}]},We={id:"enemy-fall",onEnter:function(e){e.getComponent(g).sprite.anims.play("enemy-jump")},transitions:[{type:x.Conditional,condition:function(e){return e.getComponent(z).body.blocked.down},to:"enemy-idle"}]},Je=function(){function e(t,n){a()(this,e),this.zone=void 0;var i=t.areaManager.getZone(n.zoneBoundaryName);if(null==i)throw new Error("ZoneBoundaryComponent::ZONE_NOT_FOUND");this.zone=new Phaser.Geom.Rectangle(i.x,i.y,i.width,i.height)}return c()(e,[{key:"destroy",value:function(){delete this.zone}}]),e}(),Ze={id:"enemy-wander",onEnter:function(e){var t=e.getComponent(g).sprite,n=e.getComponent(z).body;n.velocity.x=Phaser.Math.RND.pick([-1,1])*Ve,n.velocity.x<0?t.flipX=!0:t.flipX=!1},onUpdate:function(e){var t=e.getComponent(g).sprite,n=e.getComponent(z).body,i=e.getComponent(Je).zone;Phaser.Geom.Rectangle.ContainsRect(i,t.getBounds())||(n.velocity.x*=-1)},transitions:[{type:x.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(e){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:x.Conditional,condition:function(e){var t=e.getComponent(Re).interactionTracker.getEntityIds("active"),n=e.getComponent(te).scene,i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var h=s.value;if(n.phecs.phEntities.getEntityById(h).hasComponent(je))return!0}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return!1},to:"enemy-track-adventurer"}]},qe=[Fe,Ke,_e,{id:"enemy-jump-prep",onEnter:function(e){var t=e.getComponent(g).sprite,n=e.getComponent(te).scene;t.anims.stop(),n.tweens.timeline({tweens:[{targets:t,props:{scaleY:.8,scaleX:1.2},duration:100,completeDelay:100},{targets:t,props:{scaleY:1,scaleX:1},duration:100}]})},transitions:[{type:x.Timer,delay:300,to:"enemy-jump"}]},Ye,We,Ue,Ze],Qe=[{id:"old-lady-idle",onEnter:function(e){e.getComponent(g).sprite.anims.play("old-lady-idle")},transitions:[]}],$e=[{id:"old-man-idle",onEnter:function(e){e.getComponent(g).sprite.anims.play("old-man-idle")},transitions:[]}],et={id:"sheep-walk-left",onEnter:function(e){e.getComponent(g).sprite.anims.play("sheep-walk"),e.getComponent(g).sprite.flipX=!0,e.getComponent(z).body.velocity.x=-50},transitions:[{type:x.Timer,delay:function(){return Phaser.Math.RND.between(1e3,1500)},to:function(){return Phaser.Math.RND.pick(["sheep-idle","sheep-walk-left"])}},{type:x.Conditional,condition:function(e){var t=e.getComponent(g).sprite,n=e.getComponent(Je).zone;return t.x<n.x},to:"sheep-walk-right"}]},tt={id:"sheep-walk-right",onEnter:function(e){e.getComponent(g).sprite.anims.play("sheep-walk"),e.getComponent(g).sprite.flipX=!1,e.getComponent(z).body.velocity.x=50},transitions:[{type:x.Timer,delay:function(){return Phaser.Math.RND.between(1e3,1500)},to:function(){return Phaser.Math.RND.pick(["sheep-walk-right","sheep-idle"])}},{type:x.Conditional,condition:function(e){var t=e.getComponent(g).sprite,n=e.getComponent(Je).zone;return t.x+t.width>n.x+n.width},to:"sheep-walk-left"}]},nt=[{id:"sheep-idle",onEnter:function(e){e.getComponent(z).body.setVelocity(0),e.getComponent(g).sprite.anims.stop()},transitions:[{type:x.Timer,delay:function(){return Phaser.Math.RND.between(1e3,1500)},to:function(){return Phaser.Math.RND.pick(["sheep-walk-left","sheep-walk-right"])}}]},et,tt],it=function(){function e(t,n){a()(this,e),this.maxHealth=void 0,this.currentHealth=void 0,this.onDeathListeners=void 0,this.onDamageListeners=void 0,this.maxHealth=n.maxHealth,this.currentHealth=this.maxHealth,this.onDeathListeners=[],this.onDamageListeners=[]}return c()(e,[{key:"decreaseHealth",value:function(e){var t=this;this.currentHealth-=e,this.currentHealth<=0?this.onDeathListeners.forEach(function(e){return e()}):this.onDamageListeners.forEach(function(e){return e(t.currentHealth)})}},{key:"onDamage",value:function(e){this.onDamageListeners.push(e)}},{key:"onDeath",value:function(e){this.onDeathListeners.push(e)}},{key:"destroy",value:function(){delete this.maxHealth,delete this.currentHealth,delete this.onDeathListeners,delete this.onDamageListeners}}]),e}(),ot=function(){function e(t,n,i){a()(this,e),this.entities1Config=void 0,this.entities2Config=void 0,this.onHit=void 0,this.entities1Config=t,this.entities2Config=n,this.onHit=i}return c()(e,[{key:"update",value:function(e){var t=this.entities1Config.entityFetcher(e),n=this.entities2Config.entityFetcher(e),i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var h=s.value,c=h.getComponent(Ae).getAttachmentsByType(this.entities1Config.boxType).filter(function(e){return e.isEnabled()}),u=!0,l=!1,d=void 0;try{for(var p,f=n[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var y=p.value,v=y.getComponent(Ae).getAttachmentsByType(this.entities2Config.boxType).filter(function(e){return e.isEnabled()});this.doBoxesOverlap(c,v)&&this.onHit(h,y)}}catch(e){l=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw d}}}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}}},{key:"doBoxesOverlap",value:function(e,t){var n=!1,i=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var h=s.value;if(n)break;var c=!0,u=!1,l=void 0;try{for(var d,p=t[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value;if(n)break;n=h.overlaps(f)}}catch(e){u=!0,l=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}}]),e}(),rt=function(){function e(t,n,i){a()(this,e);var o=i.getComponent(it),r=i.getComponent(Z).phiniteStateMachine;o.onDamage(function(){r.doTransition({to:"enemy-stun"})}),o.onDeath(function(){r.doTransition({to:"enemy-dead"})})}return c()(e,[{key:"destroy",value:function(){}}]),e}(),st=1,at=function(e){function t(){return a()(this,t),l()(this,p()(t).call(this,{entityFetcher:function(e){return e.getEntities("arrow").filter(function(e){return"arrow-flying"===e.getComponent(Z).phiniteStateMachine.currentState.id})},boxType:"hitbox"},{entityFetcher:function(e){return e.getEntities(rt)},boxType:"hurtbox"},function(e,t){e.getComponent(Z).phiniteStateMachine.doTransition({to:"arrow-disabled"}),t.getComponent(it).decreaseHealth(st)}))}return y()(t,e),t}(ot),ht={preload:"preload",title:"title",exploration:"exploration",hud:"hud",death:"death",newGame:"newGame",continueGame:"continueGame",prefabTest:"prefabTest"},ct=function(){function e(t){a()(this,e),this.scene=void 0,this.healthListenerCleanupFn=void 0,this.scene=t}return c()(e,[{key:"start",value:function(e){var t=this;this.healthListenerCleanupFn=this.scene.persistence.adventurer.onChange("health",function(e){e<=0&&(t.scene.scene.stop(ht.hud),t.scene.scene.pause(ht.exploration),t.scene.scene.launch(ht.death))})}},{key:"stop",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn(),delete this.healthListenerCleanupFn}}]),e}(),ut=function(){function e(t,n,i){a()(this,e),this.scene=void 0,this.identifierA=void 0,this.identifierB=void 0,this.listeners=void 0,this.scene=t,this.identifierA=n,this.identifierB=i,this.listeners=[]}return c()(e,[{key:"start",value:function(e){var t=this,n=e.getEntities(this.identifierA),i=e.getEntities(this.identifierB);this.validateEntities(n),this.validateEntities(i);var o=this.scene.controls.action,r=!0,s=!1,a=void 0;try{for(var h,c=function(){var e=h.value,n=!0,r=!1,s=void 0;try{for(var a,c=function(){var n=a.value,i=function(){e.getComponent(Re).interactionTracker.getEntityIds("active").includes(n.id)&&t.onInteraction&&t.onInteraction(e,n)},r=o.onPress(i);t.listeners.push({control:"action",listener:i,listenerCancelFn:r})},u=i[Symbol.iterator]();!(n=(a=u.next()).done);n=!0)c()}catch(e){r=!0,s=e}finally{try{n||null==u.return||u.return()}finally{if(r)throw s}}},u=n[Symbol.iterator]();!(r=(h=u.next()).done);r=!0)c()}catch(e){s=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(s)throw a}}}},{key:"stop",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this.listeners[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.listenerCancelFn()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"update",value:function(e){var t=e.getEntities(this.identifierA),n=e.getEntities(this.identifierB),i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var h=s.value,c=h.getComponent(Re).interactionTracker,u=this.getInteractingEntityBs(c,n,"entering"),l=!0,d=!1,p=void 0;try{for(var f,y=u[Symbol.iterator]();!(l=(f=y.next()).done);l=!0){var v=f.value;this.onEnter&&this.onEnter(h,v)}}catch(e){d=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(d)throw p}}var g=this.getInteractingEntityBs(c,n,"exiting"),m=!0,b=!1,C=void 0;try{for(var x,k=g[Symbol.iterator]();!(m=(x=k.next()).done);m=!0){var w=x.value;this.onExit&&this.onExit(h,w)}}catch(e){b=!0,C=e}finally{try{m||null==k.return||k.return()}finally{if(b)throw C}}}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}}},{key:"destroy",value:function(){this.listeners=[]}},{key:"validateEntities",value:function(e){if(!e.every(function(e){return e.hasComponent(Re)}))throw new Error("BaseInteractionSystem::ENTITY_MISSING_INTERACTION_COMPONENT")}},{key:"getInteractingEntityBs",value:function(e,t,n){var i=e.getEntityIds(n);return t.filter(function(e){return i.includes(e.id)})}}]),e}(),lt=n(108),dt=n.n(lt);!function(e){e.TOP="top",e.LEFT="left"}(ye||(ye={}));var pt=10,ft=(pe={},dt()(pe,ye.TOP,"indicator-down"),dt()(pe,ye.LEFT,"indicator-right"),pe),yt=(fe={},dt()(fe,ye.TOP,"indicator-down"),dt()(fe,ye.LEFT,"indicator-right"),fe),vt=function(){function e(t,n,i){a()(this,e),this.sprite=void 0,this.side=void 0;var o=n.x,r=n.y;this.side=i,this.sprite=t.add.sprite(o,r,ft[i]),this.sprite.setDepth(n.depth),i===ye.TOP?(this.sprite.setOrigin(.5,1),this.sprite.y=r-n.height*n.scaleY/2-pt):i===ye.LEFT&&(this.sprite.setOrigin(1,.5),this.sprite.x=o-n.width*n.scaleX/2-pt)}return c()(e,[{key:"show",value:function(){this.sprite.visible=!0,this.sprite.active=!0,this.sprite.anims.play(yt[this.side])}},{key:"hide",value:function(){this.sprite.visible=!1,this.sprite.active=!1,this.sprite.anims.stop()}},{key:"destroy",value:function(){this.sprite.destroy()}}]),e}(),gt=function(){function e(t,n,i){a()(this,e),this.indicator=void 0;var o=n.indicatorSide||ye.TOP,r=i.getComponent(g).sprite;this.indicator=new vt(t,r,o),this.indicator.hide()}return c()(e,[{key:"destroy",value:function(){this.indicator.destroy()}}]),e}(),mt=function(){function e(t,n){a()(this,e),this.toAreaKey=void 0,this.toMarker=void 0,this.toAreaKey=n.toAreaKey,this.toMarker=n.toMarker}return c()(e,[{key:"destroy",value:function(){delete this.toAreaKey,delete this.toMarker}}]),e}(),bt=function(e){function t(e){var n;return a()(this,t),(n=l()(this,p()(t).call(this,e,je,mt))).explorationScene=void 0,n.explorationScene=e,n}return y()(t,e),c()(t,[{key:"onEnter",value:function(e,t){t.getComponent(gt).indicator.show()}},{key:"onInteraction",value:function(e,t){var n=t.getComponent(mt);this.explorationScene.loadNewArea(n.toAreaKey,n.toMarker)}},{key:"onExit",value:function(e,t){t.getComponent(gt).indicator.hide()}}]),t}(ut),Ct=function(){function e(t,n,i){a()(this,e),this.scene=void 0,this.conversation=void 0,this.entityY=void 0,this.conversationBoxSprite=void 0,this.conversationProgressIndex=void 0,this.conversationKey=void 0,this.scene=t,this.conversationKey=n.conversationKey,this.conversation=[];var o=i.getComponent(g).sprite;this.entityY=o.y,this.conversationProgressIndex=0,this.conversationBoxSprite=t.add.ninePatch(o.x,o.y,0,0,"conversation-box",null,{top:6,left:15,right:15,bottom:12}),this.conversationBoxSprite.alpha=0,this.conversationBoxSprite.setDepth(m.depthFor("notifications"))}return c()(e,[{key:"startConversation",value:function(){this.loadConversation(),this.conversationBoxSprite.alpha=1,this.conversationProgressIndex=0,this.updateConversationText()}},{key:"continueConversation",value:function(){this.hasMoreConversation()?this.conversationProgressIndex+=1:this.stopConversation(),this.updateConversationText()}},{key:"stopConversation",value:function(){this.conversationBoxSprite.alpha=0}},{key:"hasMoreConversation",value:function(){return this.conversationProgressIndex<this.conversation.length-1}},{key:"destroy",value:function(){this.conversationBoxSprite.destroy()}},{key:"loadConversation",value:function(){var e=this.scene.persistence.progression.conversations.getCurrentConversationId(this.conversationKey);this.conversation=this.scene.cache.json.get("conversations")[e]}},{key:"updateConversationText",value:function(){var e=this.scene.add.bitmapText(0,0,"compass-24-conversation",this.conversation[this.conversationProgressIndex]);e.setMaxWidth(300),e.setOrigin(.5);var t=e.getTextBounds().local;if(this.conversationBoxSprite.resize(t.width+50,t.height+50),this.conversationBoxSprite.add(e),this.hasMoreConversation()){var n=this.scene.add.sprite(this.conversationBoxSprite.width/2-5,-this.conversationBoxSprite.height/2-2,"indicator-right");n.setOrigin(1,0),n.anims.play("indicator-right"),this.conversationBoxSprite.add(n)}this.conversationBoxSprite.y=this.entityY-this.conversationBoxSprite.height/2-40}}]),e}(),xt=function(e){function t(e){var n;return a()(this,t),(n=l()(this,p()(t).call(this,e,je,"npc"))).interacting=void 0,n.interacting=!1,n}return y()(t,e),c()(t,[{key:"onEnter",value:function(e,t){t.getComponent(gt).indicator.show()}},{key:"onInteraction",value:function(e,t){var n=t.getComponent(Ct);this.interacting?this.interacting&&n.hasMoreConversation()?n.continueConversation():(this.interacting=!1,n.stopConversation(),this.scene.persistence.progression.conversations.markCurrentConversationComplete(n.conversationKey),this.scene.persistence.save()):(this.interacting=!0,t.getComponent(gt).indicator.hide(),n.startConversation())}},{key:"onExit",value:function(e,t){if(this.interacting){var n=t.getComponent(Ct);n.hasMoreConversation()||(this.scene.persistence.progression.conversations.markCurrentConversationComplete(n.conversationKey),this.scene.persistence.save()),n.stopConversation(),this.interacting=!1}t.getComponent(gt).indicator.hide()}}]),t}(ut),kt=function(){function e(t,n){a()(this,e),this.isTextboxShowing=void 0,this.signs=void 0,this.textboxSprite=void 0,this.textboxShowTween=void 0,this.textboxHideTween=void 0,this.signs=t.cache.json.get("signs"),this.isTextboxShowing=!1;var i=t.cameras.main.width/2;this.textboxSprite=t.add.ninePatch(i,-100,400,100,"textbox",null,{top:10,bottom:10,left:10,right:10}),this.textboxSprite.setDepth(m.depthFor("notifications")).setScrollFactor(0);var o=t.add.bitmapText(0,0,"compass-24",this.signs[n.signId].message);o.setOrigin(.5),this.textboxSprite.add(o),this.textboxShowTween=t.tweens.add({targets:this.textboxSprite,y:75,duration:300,ease:Phaser.Math.Easing.Quadratic.Out}).pause(),this.textboxHideTween=t.tweens.add({targets:[this.textboxSprite],y:-100,duration:300,ease:Phaser.Math.Easing.Quadratic.In}).pause()}return c()(e,[{key:"showTextbox",value:function(){this.isTextboxShowing=!0,this.textboxHideTween.pause(),this.textboxShowTween.restart()}},{key:"hideTextbox",value:function(){this.isTextboxShowing=!1,this.textboxShowTween.pause(),this.textboxHideTween.restart()}},{key:"destroy",value:function(){this.textboxShowTween.remove(),this.textboxHideTween.remove(),this.textboxSprite.destroy(),delete this.textboxShowTween,delete this.textboxHideTween,delete this.textboxSprite}}]),e}(),wt=function(e){function t(e){return a()(this,t),l()(this,p()(t).call(this,e,je,"sign"))}return y()(t,e),c()(t,[{key:"onEnter",value:function(e,t){t.getComponent(gt).indicator.show()}},{key:"onInteraction",value:function(e,t){t.getComponent(kt).isTextboxShowing?t.getComponent(kt).hideTextbox():t.getComponent(kt).showTextbox()}},{key:"onExit",value:function(e,t){t.getComponent(gt).indicator.hide(),t.getComponent(kt).isTextboxShowing&&t.getComponent(kt).hideTextbox()}}]),t}(ut),Pt=function(){function e(t,n,i){a()(this,e),this.isInvulnerable=void 0,this.scene=void 0,this.sprite=void 0,this.scene=t,this.isInvulnerable=!1,this.sprite=i.getComponent(g).sprite}return c()(e,[{key:"makeInvulnerable",value:function(){var e=this;this.isInvulnerable=!0,this.sprite.alpha=.5;var t=this.scene.time.delayedCall(500,function(){e.sprite.alpha=1,e.isInvulnerable=!1,t.destroy()})}},{key:"destroy",value:function(){delete this.isInvulnerable}}]),e}(),Et=1,St=function(e){function t(){return a()(this,t),l()(this,p()(t).call(this,{entityFetcher:function(e){return e.getEntities(je).filter(function(e){return!e.getComponent(Pt).isInvulnerable})},boxType:"hurtbox"},{entityFetcher:function(e){return e.getEntities(rt)},boxType:"hurtbox"},function(e,t){e.getComponent(Pt).makeInvulnerable(),e.getComponent(je).decreaseHealth(Et)}))}return y()(t,e),t}(ot),Tt=function(){function e(){a()(this,e)}return c()(e,[{key:"update",value:function(e){var t=e.getEntities(Ae),n=!0,i=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value,h=!0,c=!1,u=void 0;try{for(var l,d=a.getComponent(Ae).attachments[Symbol.iterator]();!(h=(l=d.next()).done);h=!0){l.value.syncToSprite(a.getComponent(g).sprite)}}catch(e){c=!0,u=e}finally{try{h||null==d.return||d.return()}finally{if(c)throw u}}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}}]),e}(),At=function(){function e(t,n){a()(this,e),this.boundsFrames=void 0,this.boundsFrames=t.cache.json.get(n.boundsKey)}return c()(e,[{key:"destroy",value:function(){delete this.boundsFrames}}]),e}(),Mt=function(){function e(){a()(this,e)}return c()(e,[{key:"update",value:function(e){e.getEntities(At).forEach(function(e){var t=e.getComponent(g).sprite.frame.texture.key,n=e.getComponent(g).sprite.frame.name,i=e.getComponent(At).boundsFrames.find(function(e){return e.key===t&&e.frame===n});if(i){var o=i.bounds,r={x:o.offset.x,y:o.offset.y};e.getComponent(g).sprite.flipX&&(r.x=e.getComponent(g).sprite.width-o.offset.x-o.size.width),e.getComponent(g).sprite.flipY&&(r.y=e.getComponent(g).sprite.height-o.offset.y-o.size.height);var s={x:e.getComponent(g).sprite.displayWidth*e.getComponent(g).sprite.originX/e.getComponent(g).sprite.scale,y:e.getComponent(g).sprite.displayHeight*e.getComponent(g).sprite.originY/e.getComponent(g).sprite.scale};Phaser.Math.RotateAround(r,s.x,s.y,e.getComponent(g).sprite.rotation),e.getComponent(z).body.setSize(o.size.width,o.size.height),e.getComponent(z).body.setOffset(r.x,r.y)}else e.getComponent(z).body.setSize(e.getComponent(g).sprite.width,e.getComponent(g).sprite.height),e.getComponent(z).body.setOffset(0,0);e.getComponent(z).body.updateBounds()})}}]),e}(),It=function(){function e(){a()(this,e)}return c()(e,[{key:"update",value:function(e){e.getEntities(Ie).filter(function(e){return e.getComponent(Ie).enabled}).forEach(function(e){var t=e.getComponent(g).sprite.frame.texture.key,n=e.getComponent(g).sprite.frame.name,i=e.getComponent(Ie).hitboxFrames.find(function(e){return e.key===t&&e.frame===n});if(i&&i.hitboxes)for(var o=e.getComponent(Ae).getAttachmentsByType("hitbox"),r=0;r<o.length;r++){var s=i.hitboxes[r],a=o[r];s?(a.enable(),a.setConfig({shape:"rectangle",offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):a.disable()}})}}]),e}(),Lt=function(){function e(){a()(this,e)}return c()(e,[{key:"update",value:function(e){e.getEntities(Ge).filter(function(e){return e.getComponent(Ge).enabled}).forEach(function(e){var t=e.getComponent(g).sprite.frame.texture.key,n=e.getComponent(g).sprite.frame.name,i=e.getComponent(Ge).hurtboxFrames.find(function(e){return e.key===t&&e.frame===n});if(i&&i.hurtboxes)for(var o=e.getComponent(Ae).getAttachmentsByType("hurtbox"),r=0;r<o.length;r++){var s=i.hurtboxes[r],a=o[r];s?(a.enable(),a.setConfig({shape:"rectangle",offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):a.disable()}})}}]),e}(),Dt=function(){function e(){a()(this,e)}return c()(e,[{key:"update",value:function(e){var t=e.getEntities(Re),n=!0,i=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value,h=this.getIntersectingInteractionIds(a,t);a.getComponent(Re).interactionTracker.update(h)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}},{key:"getIntersectingInteractionIds",value:function(e,t){return t.filter(function(t){return t.id!==e.id}).filter(function(t){var n=e.getComponent(Ae).getAttachmentsByType("interaction")[0],i=t.getComponent(Ae).getAttachmentsByType("interaction")[0];return n.overlaps(i)}).map(function(e){return e.id})}}]),e}(),Ot=function(){function e(){a()(this,e)}return c()(e,[{key:"update",value:function(e){e.getEntities(Z).forEach(function(e){e.getComponent(Z).phiniteStateMachine.update()})}}]),e}(),Nt=n(66),Bt=n.n(Nt),Rt=n(107),jt=n.n(Rt),Ft=function(){function e(t){a()(this,e),this.scriptActions=void 0,this.scriptActions=t}return c()(e,[{key:"run",value:function(){var e=jt()(Bt.a.mark(function e(){var t,n,i,o,r,s;return Bt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,i=void 0,e.prev=3,o=this.scriptActions[Symbol.iterator]();case 5:if(t=(r=o.next()).done){e.next=12;break}return s=r.value,e.next=9,s.run();case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,i=e.t0;case 18:e.prev=18,e.prev=19,t||null==o.return||o.return();case 21:if(e.prev=21,!n){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.abrupt("return",Promise.resolve());case 27:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}));return function(){return e.apply(this,arguments)}}()}]),e}(),Ht=function(){function e(t){a()(this,e),this.script=void 0,this.script=t}return c()(e,[{key:"run",value:function(){var e=jt()(Bt.a.mark(function e(){return Bt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.script.run();case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Gt=function(){function e(t){a()(this,e),this.runFn=void 0,this.runFn=t}return c()(e,[{key:"run",value:function(){var e=jt()(Bt.a.mark(function e(){return Bt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runFn());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),_t=function(){function e(t,n){a()(this,e),this.scene=void 0,this.adventurer=void 0,this.scene=t,this.adventurer=n}return c()(e,[{key:"disablePhSM",value:function(){var e=this;return new Gt(function(){return e.adventurer.getComponent(Z).phiniteStateMachine.disable(),Promise.resolve()})}},{key:"enablePhSM",value:function(){var e=this;return new Gt(function(){return e.adventurer.getComponent(Z).phiniteStateMachine.enable(),Promise.resolve()})}},{key:"faceRight",value:function(){var e=this;return new Gt(function(){return e.adventurer.getComponent(g).sprite.flipX=!1,Promise.resolve()})}},{key:"walk",value:function(e){var t=this;return new Gt(function(){return new Promise(function(n){var i=t.adventurer.getComponent(g).sprite;i.flipX=e<0,i.anims.play("adventurer-run"),t.scene.tweens.add({targets:i,props:{x:i.x+e},duration:500,onComplete:function(){i.anims.play("adventurer-stand"),n()}})})})}}]),e}(),Kt=function(){function e(t,n,i){a()(this,e),this.scene=void 0,this.text=void 0,this.targetSprite=void 0,this.scene=t,this.targetSprite=i.getComponent(g).sprite,this.text=t.add.dynamicBitmapText(0,0,"compass-24",""),this.text.setOrigin(.5,.5),this.text.setDepth(m.depthFor("notifications")),this.hide()}return c()(e,[{key:"say",value:function(e,t,n){var i=this,o=this.targetSprite.getTopCenter();this.text.setText(e),this.text.setPosition(o.x,o.y-40),this.scene.time.delayedCall(t,function(){i.text.setVisible(!1),n()}),this.show()}},{key:"shout",value:function(e,t,n){var i=this;this.text.setDisplayCallback(function(e){return e.x=Phaser.Math.Between(e.x-0,e.x+0),e.y=Phaser.Math.Between(e.y-1,e.y+1),e}),this.say(e,t,function(){i.text.setDisplayCallback(function(){}),n()})}},{key:"destroy",value:function(){this.text.destroy(),delete this.scene,delete this.text,delete this.targetSprite}},{key:"hide",value:function(){this.text.setActive(!1),this.text.setVisible(!1)}},{key:"show",value:function(){this.text.setActive(!0),this.text.setVisible(!0)}}]),e}(),Xt=function(){function e(t,n){a()(this,e),this.scene=void 0,this.sheep=void 0,this.scene=t,this.sheep=n}return c()(e,[{key:"disablePhSM",value:function(){var e=this;return new Gt(function(){return e.sheep.getComponent(Z).phiniteStateMachine.disable(),Promise.resolve()})}},{key:"enablePhSM",value:function(){var e=this;return new Gt(function(){return e.sheep.getComponent(Z).phiniteStateMachine.enable(),Promise.resolve()})}},{key:"faceLeft",value:function(){var e=this;return new Gt(function(){return e.sheep.getComponent(g).sprite.flipX=!0,Promise.resolve()})}},{key:"shout",value:function(e){var t=this;return new Gt(function(){return new Promise(function(e){t.sheep.getComponent(Kt).shout("BAAAH!",900,e)})})}}]),e}(),zt=function(e){function t(e){return a()(this,t),l()(this,p()(t).call(this,e,je,"sheep"))}return y()(t,e),c()(t,[{key:"onEnter",value:function(e,t){if(!this.scene.persistence.progression.conversations.isCompleted({type:"conversation",name:"oldMan",index:0})){var n=new _t(this.scene,e),i=new Xt(this.scene,t),o=new Ft([i.disablePhSM(),n.disablePhSM(),i.faceLeft(),i.shout("BAAAAH!"),n.walk(-100),i.enablePhSM(),n.enablePhSM()]);new Ht(o).run()}}}]),t}(ut),Vt={components:[{component:g,data:{texture:"adventurer-core",frame:0}},{component:z,data:{maxVelocityX:350}},je,{component:Ae,data:{attachmentDebug:!1}},{component:Ge,data:{hurtboxesKey:"adventurer-hurtboxes",debug:!1}},{component:At,data:{boundsKey:"adventurer-bounds"}},{component:Re,data:{interactionRadius:30,debug:!1}},{component:Z,data:{stateSet:"adventurer",initialStateId:"adventurer-stand"}},{component:Q},Pt,te]},Yt={components:[{component:g,data:{texture:"arrow",frame:0}},z,{component:Ae,data:{attachmentDebug:!1}},{component:Ie,data:{hitboxesKey:"arrow-hitboxes",debug:!1}},{component:Z,data:{stateSet:"arrow",initialStateId:"arrow-disabled"}},{component:At,data:{boundsKey:"arrow-bounds"}}]},Ut={components:[{component:g,data:{texture:"doors",frame:1}},mt,gt,{component:Ae,data:{attachmentDebug:!1}},{component:Re,data:{interactionRadius:40,debug:!1}}]},Wt={components:[{component:g,data:{texture:"enemy",frame:0}},z,{component:Ae,data:{attachmentDebug:!1}},{component:Z,data:{stateSet:"enemy",initialStateId:"enemy-idle"}},{component:Ge,data:{hurtboxesKey:"enemy-hurtboxes",debug:!1}},{component:Ie,data:{hitboxesKey:"enemy-hitboxes",debug:!1}},{component:it,data:{maxHealth:2}},{component:Re,data:{interactionRadius:220,debug:!1}},rt,{component:Je,data:{zoneBoundaryName:"enemyBounds"}},{component:te}]},Jt={components:[g,Z,{component:Ae,data:{attachmentDebug:!1}},{component:Re,data:{interactionRadius:70,debug:!1}},gt,Ct,function(){function e(t,n){a()(this,e),this.npcId=void 0,this.npcId=n.npcId}return c()(e,[{key:"destroy",value:function(){delete this.npcId}}]),e}()]},Zt={components:[{component:g,data:{texture:"sheep-walk",frame:0}},z,{component:Z,data:{stateSet:"sheep",initialStateId:"sheep-idle"}},{component:Je,data:{zoneBoundaryName:"sheepBounds"}},{component:Ae,data:{attachmentDebug:!0}},{component:Re,data:{debug:!1,shapeConfig:{shape:"rectangle",width:40,height:100,offsetY:-30}}},Kt]},qt={components:[{component:g,data:{texture:"core-tileset-spritesheet",frame:1128}},{component:Ae,data:{attachmentDebug:!1}},{component:Re,data:{interactionRadius:30,debug:!1}},gt,kt]},Qt=function(e){function t(){var e;return a()(this,t),(e=l()(this,p()(t).call(this,{key:ht.exploration}))).isLoadingArea=void 0,e.isLoadingArea=!1,e}return y()(t,e),c()(t,[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(e){var t=this;this.registerStateSets(),this.registerAreas(),this.registerBackgroundSets(),this.registerSystems(),this.registerPrefabs(),this.cameras.main.fadeOut(0),this.loadNewArea(e.areaKey,e.markerName).then(function(){t.cameras.main.fadeIn(1e3,0,0,0,function(e,n){1===n&&t.scene.launch(ht.hud)})})}},{key:"registerStateSets",value:function(){this.stateRegistrar.registerSets([{id:"adventurer",states:ke},{id:"arrow",states:Le},{id:"enemy",states:qe},{id:"sheep",states:nt},{id:"old-lady",states:Qe},{id:"old-man",states:$e}])}},{key:"registerAreas",value:function(){this.areaManager.registerArea("woollards-farm","woollards-farm","core-tileset","core-tileset"),this.areaManager.registerArea("woollards-house","woollards-house","core-tileset","core-tileset")}},{key:"registerBackgroundSets",value:function(){this.areaManager.registerBackgroundSet("green-hills",["green-hills-1","green-hills-2","green-hills-3","green-hills-4"])}},{key:"registerSystems",value:function(){this.phecs.phSystems.registerSystems([at,ct,bt,xt,wt,St,Tt,Mt,It,Lt,Dt,Ot,zt])}},{key:"registerPrefabs",value:function(){this.phecs.phEntities.registerPrefab("adventurer",Vt),this.phecs.phEntities.registerPrefab("arrow",Yt),this.phecs.phEntities.registerPrefab("door",Ut),this.phecs.phEntities.registerPrefab("enemy",Wt),this.phecs.phEntities.registerPrefab("npc",Jt),this.phecs.phEntities.registerPrefab("sheep",Zt),this.phecs.phEntities.registerPrefab("sign",qt)}},{key:"loadNewArea",value:function(e,t){var n=this;return new Promise(function(i,o){n.isLoadingArea?o():(n.isLoadingArea=!0,n.time.delayedCall(0,function(){n.controls.stop(),n.phecs.reset(),n.areaManager.unload(),n.areaManager.load(e);var o=n.areaManager.map,s=n.areaManager.tileset,a=n.phecs.phEntities.createPrefab("adventurer",{},m.depthFor("adventurer")),h=v(o.properties);t?n.areaManager.placeEntityAtMarker(a,t):h.startingMarker&&n.areaManager.placeEntityAtMarker(a,h.startingMarker),h.entityLayerCollisions&&h.entityLayerCollisions.split(",").forEach(function(e){var t=e.split(":"),i=r()(t,2),o=i[0],s=i[1],a=n.phecs.phEntities.getEntities(o),h=n.areaManager.getTileLayer(s);if(null==h)throw new Error("Layer does not exist for collision pair: ".concat(e));var c=!0,u=!1,l=void 0;try{for(var d,p=a[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value.getComponent(g).sprite;n.physics.add.collider(f,h)}}catch(e){u=!0,l=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}}),n.controls.start(),n.phecs.start();var c=n.calculateCameraBounds(o,s),u=c.x,l=c.y,d=c.width,p=c.height;n.cameras.main.setBounds(u,l,d,p),n.cameras.main.startFollow(a.getComponent(g).sprite,!0),n.persistence.location.areaKey=e,t&&(n.persistence.location.markerName=t),n.persistence.save(),n.isLoadingArea=!1,i()},[],null))})}},{key:"shutdown",value:function(){this.phecs.shutdown(),this.areaManager.unload()}},{key:"calculateCameraBounds",value:function(e,t){var n=0,i=0,o=e.width*t.tileWidth,r=e.height*t.tileHeight;return o<800&&(n-=(800-o)/2),r<450&&(i-=(450-r)/2),{x:n,y:i,width:o,height:r}}}]),t}(K),$t=function(e){function t(){return a()(this,t),l()(this,p()(t).call(this,{key:ht.death}))}return y()(t,e),c()(t,[{key:"create",value:function(){var e=this;this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY-24,"compass-72","You died").setOrigin(.5),this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY+32,"compass-24","Try again?").setOrigin(.5),this.input.keyboard.once(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,function(){e.cameras.main.fadeOut(1e3,0,0,0,function(t,n){1===n&&(e.scene.stop(ht.exploration),e.scene.stop(ht.hud),e.scene.stop(ht.death),e.scene.start(ht.continueGame))})})}}]),t}(K),en=function(e){function t(){var e;return a()(this,t),(e=l()(this,p()(t).call(this,{key:ht.prefabTest}))).centerDebugCircle=void 0,e.enemy=void 0,e}return y()(t,e),c()(t,[{key:"create",value:function(){this.phecs.phEntities.registerPrefab("arrow",Yt),this.phecs.phSystems.registerSystems([Tt,Dt,Mt,Lt,It]),this.stateRegistrar.registerSets([{id:"arrow",states:Le}]);var e=0,t=this.add.text(200,50,"Frame ".concat(e)),n=this.phecs.phEntities.createPrefab("arrow",{},5,0,0);n.getComponent(g).sprite.x=150,n.getComponent(g).sprite.y=200,n.getComponent(g).sprite.setFrame(e),n.getComponent(z).body.allowGravity=!1,n.getComponent(g).sprite.anims.stop(),this.centerDebugCircle=this.add.circle(0,0,10,65280),this.centerDebugCircle.setDepth(100),this.input.keyboard.on("keydown",function(i){switch(i.key){case"ArrowUp":e++;break;case"ArrowDown":e--}n.getComponent(g).sprite.setFrame(e),t.setText("Frame ".concat(e))}),console.log(n),this.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,function(e){"ArrowLeft"===e.key?n.getComponent(z).body.acceleration.x=-600:"ArrowRight"===e.key?n.getComponent(z).body.acceleration.x=600:" "===e.key&&(n.getComponent(z).body.acceleration.x=0,n.getComponent(z).body.velocity.x=0)}),this.phecs.start(),this.cameras.main.setBackgroundColor("#cccccc"),this.enemy=n,this.events.on(Phaser.Scenes.Events.POST_UPDATE,this.myUpdate,this)}},{key:"myUpdate",value:function(){var e=this.enemy.getComponent(g).sprite.getCenter();this.centerDebugCircle.setPosition(e.x,e.y)}}]),t}(K),tn=function(e){function t(){return a()(this,t),l()(this,p()(t).call(this,{key:ht.preload}))}return y()(t,e),c()(t,[{key:"preload",value:function(){this.load.image("title-screen","assets/backgrounds/title-screen.png"),this.load.image("vignette-effect","assets/backgrounds/vignette-effect.png"),this.load.image("green-hills-1","assets/backgrounds/green-hills/1.png"),this.load.image("green-hills-2","assets/backgrounds/green-hills/2.png"),this.load.image("green-hills-3","assets/backgrounds/green-hills/3.png"),this.load.image("green-hills-4","assets/backgrounds/green-hills/4.png"),this.load.bitmapFont("compass-72","assets/fonts/compass-72.png","assets/fonts/compass-72.xml"),this.load.bitmapFont("compass-72-title","assets/fonts/compass-72-title.png","assets/fonts/compass-72-title.xml"),this.load.bitmapFont("compass-24","assets/fonts/compass-24.png","assets/fonts/compass-24.xml"),this.load.bitmapFont("compass-24-conversation","assets/fonts/compass-24-conversation.png","assets/fonts/compass-24-conversation.xml"),this.load.bitmapFont("compass-18","assets/fonts/compass-18.png","assets/fonts/compass-18.xml"),this.load.spritesheet("old-lady","assets/sprites/npcs/old-lady.png",{frameWidth:41,frameHeight:66}),this.load.animation("old-lady-animations","assets/animations/old-lady.json"),this.load.spritesheet("old-man","assets/sprites/npcs/old-man.png",{frameWidth:47,frameHeight:66}),this.load.animation("old-man-animations","assets/animations/old-man.json"),this.load.spritesheet("adventurer-core","assets/sprites/adventurer/adventurer-core.png",{frameWidth:100,frameHeight:74}),this.load.spritesheet("adventurer-bow","assets/sprites/adventurer/adventurer-bow.png",{frameWidth:100,frameHeight:74}),this.load.animation("adventurer-animations","assets/animations/adventurer.json"),this.load.json("adventurer-hurtboxes","assets/hurtboxes/adventurer.json"),this.load.json("adventurer-bounds","assets/bounds/adventurer.json"),this.load.image("arrow","assets/sprites/projectiles/arrow.png"),this.load.json("arrow-bounds","assets/bounds/arrow.json"),this.load.json("arrow-hitboxes","assets/hitboxes/arrow.json"),this.load.spritesheet("sheep-walk","assets/sprites/sheep/sheep-walk.png",{frameWidth:40,frameHeight:34}),this.load.animation("sheep-animations","assets/animations/sheep.json"),this.load.spritesheet("enemy","assets/sprites/enemy/enemy.png",{frameWidth:32,frameHeight:32}),this.load.animation("enemy-animations","assets/animations/enemy.json"),this.load.json("enemy-hurtboxes","assets/hurtboxes/enemy.json"),this.load.json("enemy-hitboxes","assets/hitboxes/enemy.json"),this.load.spritesheet("indicator-down","assets/sprites/indicators/indicator-down.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("indicator-right","assets/sprites/indicators/indicator-right.png",{frameWidth:32,frameHeight:32}),this.load.animation("indicator-animations","assets/animations/indicators.json"),this.load.spritesheet("doors","assets/sprites/doors/doors.png",{frameWidth:64,frameHeight:82}),this.load.spritesheet("core-tileset-spritesheet","assets/tilesets/core-tileset.png",{frameHeight:32,frameWidth:32}),this.load.image("core-tileset","assets/tilesets/core-tileset.png"),this.load.tilemapTiledJSON("woollards-farm","assets/tilemaps/woollards-farm.json"),this.load.tilemapTiledJSON("woollards-house","assets/tilemaps/woollards-house.json"),this.load.image("textbox","assets/sprites/conversations/textbox.png"),this.load.json("signs","assets/signs.json"),this.load.image("conversation-box","assets/sprites/conversations/conversation-box.png"),this.load.json("conversations","assets/conversations.json"),this.load.spritesheet("healthbar","assets/sprites/ui/healthbar.png",{frameWidth:124,frameHeight:22})}},{key:"create",value:function(){this.scene.start(ht.title)}}]),t}(K),nn={5:0,4:1,3:2,2:3,1:4},on=function(e){function t(){var e;return a()(this,t),(e=l()(this,p()(t).call(this,{key:ht.hud}))).healthListenerCleanupFn=void 0,e}return y()(t,e),c()(t,[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(){var e=this.add.sprite(80,25,"healthbar",0);this.healthListenerCleanupFn=this.persistence.adventurer.onChange("health",function(t){e.setFrame(nn[t])})}},{key:"shutdown",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn()}}]),t}(K),rn=function(){function e(t,n){a()(this,e),this.bitmapText=void 0,this.bitmapText=t.add.bitmapText(n.x,n.y,n.font,n.text),n.origin&&this.bitmapText.setOrigin(n.origin)}return c()(e,[{key:"destroy",value:function(){this.bitmapText.destroy()}}]),e}(),sn=function(){function e(t,n,i){a()(this,e),this.indicator=void 0;var o=n.indicatorSide||ye.TOP,r=i.getComponent(rn).bitmapText;this.indicator=new vt(t,r,o),this.indicator.hide()}return c()(e,[{key:"destroy",value:function(){this.indicator.destroy()}}]),e}(),an=function(){function e(t,n,i){a()(this,e),this.callback=void 0,this.disabled=void 0,this.callback=n.menuActionCallback,this.disabled=n.menuActionDisabled}return c()(e,[{key:"destroy",value:function(){delete this.callback}}]),e}(),hn=function(){function e(t){a()(this,e),this.scene=void 0,this.selectedIndex=void 0,this.menuOptions=void 0,this.scene=t,this.selectedIndex=0,this.menuOptions=[]}return c()(e,[{key:"start",value:function(e){var t=this;this.menuOptions=e.getEntities("menuButton"),this.scene.controls.up.onPress(function(){return t.changeMenuSelector("up")}),this.scene.controls.down.onPress(function(){return t.changeMenuSelector("down")}),this.scene.controls.action.onPress(function(){return t.selectMenuOption()}),this.selectFirstEnabledIndicatorPosition()}},{key:"selectFirstEnabledIndicatorPosition",value:function(){var e=this.menuOptions.findIndex(function(e){return!e.getComponent(an).disabled});this.updateIndicatorPosition(e)}},{key:"changeMenuSelector",value:function(e){var t="up"===e?-1:1,n=0,i=this.selectedIndex,o=this.selectedIndex;do{if(n++,o=Phaser.Math.Wrap(this.selectedIndex+t,0,this.menuOptions.length),n===this.menuOptions.length){o=i;break}}while(this.menuOptions[o].getComponent(an).disabled);o!=i&&this.updateIndicatorPosition(o)}},{key:"updateIndicatorPosition",value:function(e){this.menuOptions[this.selectedIndex].getComponent(sn).indicator.hide(),this.selectedIndex=e,this.menuOptions[this.selectedIndex].getComponent(sn).indicator.show()}},{key:"selectMenuOption",value:function(){this.menuOptions[this.selectedIndex].getComponent(an).callback()}}]),e}(),cn=function(e){function t(){return a()(this,t),l()(this,p()(t).call(this,{key:ht.title}))}return y()(t,e),c()(t,[{key:"init",value:function(){this.phecs.phEntities.registerPrefab("menuTitle",{components:[rn]}),this.phecs.phEntities.registerPrefab("menuButton",{components:[rn,sn,an]}),this.phecs.phSystems.registerSystems([hn])}},{key:"create",value:function(){this.add.image(0,0,"title-screen").setOrigin(0,0),this.add.image(0,0,"vignette-effect").setOrigin(0,0).setAlpha(.1),this.phecs.phEntities.createPrefab("menuTitle",{x:400,y:160,origin:.5,font:"compass-72-title",text:"Archer Adventure"}),this.createMenuButtons(),this.phecs.start(),this.controls.start()}},{key:"createMenuButtons",value:function(){var e=this,t=[{text:"Continue Game",menuActionDisabled:!this.persistence.hasSaveGame(),menuActionCallback:function(){e.phecs.stop(),e.scene.stop(),e.scene.start(ht.continueGame)}},{text:"New Game",menuActionCallback:function(){e.phecs.stop(),e.scene.stop(),e.scene.start(ht.newGame)}}],n=250;t.map(function(t){var i=e.phecs.phEntities.createPrefab("menuButton",{x:400,y:n,origin:.5,font:"compass-24",text:t.text,indicatorSide:ye.LEFT,menuActionDisabled:t.menuActionDisabled,menuActionCallback:t.menuActionCallback});t.menuActionDisabled&&(i.getComponent(rn).bitmapText.alpha=.5),n+=40})}}]),t}(K),un=function(e){function t(){return a()(this,t),l()(this,p()(t).call(this,{key:ht.newGame}))}return y()(t,e),c()(t,[{key:"create",value:function(){this.persistence.resetSaveGame(),this.persistence.adventurer.maxHealth=5,this.persistence.adventurer.health=5,this.persistence.location.areaKey="woollards-farm",this.persistence.location.markerName="adventurerStart",this.persistence.save(),this.scene.start(ht.continueGame)}}]),t}(K),ln=function(e){function t(){return a()(this,t),l()(this,p()(t).call(this,{key:ht.continueGame}))}return y()(t,e),c()(t,[{key:"create",value:function(){this.persistence.load(),this.persistence.adventurer.health=this.persistence.adventurer.maxHealth;var e={areaKey:this.persistence.location.areaKey,markerName:this.persistence.location.markerName};this.scene.start(ht.exploration,e)}}]),t}(K),dn={width:800,height:450,plugins:{global:[{key:"NinePatchPlugin",plugin:i.NinePatchPlugin,start:!0},{key:"ParallaxSpritePlugin",plugin:E,start:!0},{key:"PersistencePlugin",plugin:D,mapping:"persistence",start:!0}],scene:[{key:"StateRegistrar",plugin:_,mapping:"stateRegistrar"},{key:"Phecs",plugin:G,mapping:"phecs"},{key:"Controls",plugin:w,mapping:"controls"},{key:"AreaManager",plugin:b,mapping:"areaManager"}]},scene:[tn,cn,un,ln,Qt,on,$t,en],pixelArt:!0,physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1100}}}};new Phaser.Game(dn)}});