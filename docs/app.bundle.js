!function(e){function t(t){for(var i,s,a=t[0],c=t[1],h=t[2],l=0,d=[];l<a.length;l++)s=a[l],o[s]&&d.push(o[s][0]),o[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(u&&u(t);d.length;)d.shift()();return r.push.apply(r,h||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},o={0:0},r=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var h=0;h<a.length;h++)t(a[h]);var u=c;r.push([1492,1]),n()}({1492:function(e,t,n){"use strict";n.r(t);n(38);var i=n(563),o=n(48),r=n.n(o),s=n(37),a=n.n(s),c=n(1),h=n.n(c),u=n(2),l=n.n(u),d=n(5),p=n.n(d),f=n(6),v=n.n(f),y=n(7),m=n.n(y),g=function(e){return Array.isArray(e)?e.reduce(function(e,t){return e[t.name]=t.value,e},{}):e||{}},b=function(){function e(t,n){h()(this,e),this.sprite=void 0;var i=n.x,o=n.y,r=n.texture,s=n.frame;this.sprite=t.add.sprite(i,o,r,s),this.sprite.y-=this.sprite.height*this.sprite.originY,n.scale&&this.sprite.setScale(n.scale),n.depth&&this.sprite.setDepth(n.depth)}return l()(e,[{key:"destroy",value:function(){this.sprite.destroy(),delete this.sprite}}]),e}(),C=new(function(){function e(){h()(this,e),this.depths={parallax:1,background0:10,background1:11,background2:12,background3:13,background4:14,background5:15,background6:16,background7:17,background8:18,background9:19,background10:20,background11:21,background12:22,background13:23,background14:24,background15:25,background16:26,background17:27,background18:28,background19:29,ground:40,door:50,sign:50,adventurer:60,foreground0:70,foreground1:71,foreground2:72,foreground3:73,foreground4:74,foreground5:75,foreground6:76,foreground7:77,foreground8:78,foreground9:79,foreground10:80,foreground11:81,foreground12:82,foreground13:83,foreground14:84,foreground15:85,foreground16:86,foreground17:87,foreground18:88,foreground19:89,notifications:100,debug:200}}return l()(e,[{key:"depthFor",value:function(e){if(this.depths[e])return this.depths[e];throw new Error("DepthManager::INVALID_DEPTH_ID")}}]),e}()),k={oldLady:[{conversationId:"oldLady1",unlockDependencies:[]},{conversationId:"oldLady2",unlockDependencies:[{type:"conversation",name:"oldMan",index:0}]},{conversationId:"oldLady3",unlockDependencies:[{type:"quest",name:"saveFarm",index:0}]}],oldMan:[{conversationId:"oldMan1",unlockDependencies:[]},{conversationId:"oldMan2",unlockDependencies:[{type:"conversation",name:"oldMan",index:0}]},{conversationId:"oldMan3",unlockDependencies:[{type:"quest",name:"saveFarm",index:0}]}],knight:[{conversationId:"knight1",unlockDependencies:[]}]},x=function(){function e(t){h()(this,e),this.progression=void 0,this.conversations=void 0,this.progression=t,this.conversations=r()({},k)}return l()(e,[{key:"getCurrentConversationId",value:function(e){return this.getCurrentConversation(e).conversationId}},{key:"markCurrentConversationComplete",value:function(e){this.getCurrentConversation(e).completed=!0}},{key:"isUnlocked",value:function(e){return this.progression.areCompleted(e.unlockDependencies)}},{key:"isCompleted",value:function(e){if(!this.conversations[e.name][e.index])throw new Error("ConversationDocument::CANNOT_CHECK_IF_COMPLETE::INVALID_CONVERSATION_NAME");return this.conversations[e.name][e.index].completed}},{key:"fromJson",value:function(e){var t=this;Object.entries(e).forEach(function(e){var n=a()(e,2),i=n[0];n[1].forEach(function(e,n){t.conversations[i][n].completed=e}),t.conversations[i]})}},{key:"toJson",value:function(){var e={};return Object.entries(this.conversations).forEach(function(t){var n=a()(t,2),i=n[0],o=n[1];e[i]=o.map(function(e){return!!e.completed})}),e}},{key:"reset",value:function(){Object.entries(this.conversations).forEach(function(e){var t=a()(e,2);t[0];t[1].forEach(function(e){return e.completed=!1})})}},{key:"getCurrentConversation",value:function(e){for(var t=this.conversations[e],n=0,i=0;i<t.length;i++)this.isUnlocked(t[i])&&(n=i);return t[n]}}]),e}(),w=function(){function e(){h()(this,e),this.conversations=void 0,this.reset()}return l()(e,null,[{key:"parseProgressionKey",value:function(e){var t,n,i,o=e.split("."),r=a()(o,2);t=r[0];var s=r[1].split("["),c=a()(s,2);n=c[0];var h=c[1].split("]");return i=a()(h,1)[0],{type:t,name:n,index:parseInt(i)}}}]),l()(e,[{key:"areCompleted",value:function(e){var t=this;return e.every(function(e){switch(e.type){case"conversation":return t.conversations.isCompleted(e);case"quest":return!1}})}},{key:"reset",value:function(){this.conversations=new x(this)}},{key:"fromJson",value:function(e){this.conversations.fromJson(e.conversations)}},{key:"toJson",value:function(){return{conversations:this.conversations.toJson()}}}]),e}(),P={};function E(e,t,n,i){P[e]={mapKey:t,tilesetName:n,tilesetKey:i}}E("woollards-farm","woollards-farm","core-tileset","core-tileset"),E("woollards-house","woollards-house","core-tileset","core-tileset"),E("forest","forest","core-tileset","core-tileset"),E("town","town","core-tileset","core-tileset");var S,T={getArea:function(e){return P[e]}},A={};S=["green-hills-1","green-hills-2","green-hills-3","green-hills-4"],A["green-hills"]=S;var M={getBackgroundSet:function(e){return A[e]}},I=function(e){function t(e,n){var i;return h()(this,t),(i=p()(this,v()(t).call(this,e,n))).map=void 0,i.tileset=void 0,i.tileLayers=void 0,i.objects=void 0,i.markers=void 0,i.zones=void 0,i.currentAreaKey=void 0,i.background=void 0,i.tileLayers=[],i.objects={},i.markers={},i.zones={},i.currentAreaKey="",i}return m()(t,e),l()(t,[{key:"load",value:function(e){this.currentAreaKey=e;var t=T.getArea(e),n=this.scene.make.tilemap({key:t.mapKey}),i=n.addTilesetImage(t.tilesetName,t.tilesetKey);this.map=n,this.tileset=i,this.tileLayers=[],this.objects={},this.loadMarkers(),this.loadZones(),this.createBackground(g(this.map.properties)),this.createTileLayers(this.map.layers.map(function(e){return e.name})),this.createEntities(this.map.objects.map(function(e){return e.name}))}},{key:"unload",value:function(){this.currentAreaKey="",this.objects={},this.markers={},this.zones={},this.tileLayers.forEach(function(e){return e.destroy()}),this.tileLayers=[],delete this.tileset,this.map&&this.map.destroy(),this.background&&this.background.destroy()}},{key:"placeEntityAtMarker",value:function(e,t){var n=this.markers[t],i=e.getComponent(b).sprite;e.getComponent(b).sprite.setPosition(n.x,n.y-i.height*i.originY)}},{key:"getTileLayer",value:function(e){return this.tileLayers.find(function(t){return t.layer.name===e})}},{key:"getZone",value:function(e){return this.zones[e]}},{key:"getCollisionMap",value:function(){return g(this.map.properties).entityLayerCollisions.split(",").reduce(function(e,t){var n=t.split(":"),i=a()(n,2),o=i[0],r=i[1];return e[o]=e[o]||[],e[o].push(r),e},{})}},{key:"loadMarkers",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){g(t.properties).marker&&(e.markers[t.name]={x:t.x,y:t.y})})})}},{key:"loadZones",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){g(t.properties).zone&&(e.zones[t.name]={shape:new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height),data:g(t.properties)})})})}},{key:"createTileLayers",value:function(e){var t=this;e.forEach(function(e){var n=t.map.createStaticLayer(e,t.tileset),i=g(n.layer.properties);i.collides&&(n.forEachTile(function(e){e.setCollision(!0,!0,!0,!0,!1)},t,0,0,n.width,n.height,{isNotEmpty:!0}),n.calculateFacesWithin(0,0,n.width,n.height)),n.setDepth(C.depthFor(i.depth)),t.tileLayers.push(n)})}},{key:"createEntities",value:function(e){var t=this;e.forEach(function(e){var n=t.map.getObjectLayer(e),i=g(n.properties),o=n.objects;t.objects[e]=[];var s=t.scene;o.forEach(function(n){var o=null;if(n.type){var a=r()({},g(n.properties),{name:n.name});if(a.createConditionGate){var c=w.parseProgressionKey(a.createConditionGate);if(t.scene.persistence.progression.areCompleted([c])!==a.createCondition)return}o=s.phecs.phEntities.createPrefab(n.type,a,C.depthFor(i.depth),n.x,n.y),t.objects[e].push(o)}})})}},{key:"createBackground",value:function(e){if(e.backgroundSet){var t=M.getBackgroundSet(e.backgroundSet).map(function(e){return{key:e}});this.background=this.scene.add.parallaxSprite(t,C.depthFor("parallax")),this.background.scrollWithCamera(this.scene.cameras.main)}else e.backgroundColor&&this.scene.cameras.main.setBackgroundColor("#".concat(e.backgroundColor))}}]),t}(Phaser.Plugins.ScenePlugin);function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}var j,D=function(){function e(){h()(this,e),this.onPressListeners=void 0,this.onReleaseListeners=void 0,this.isPressed=void 0,this.pressedAt=void 0,this.releasedAt=void 0,this.onPressListeners=[],this.onReleaseListeners=[],this.isPressed=!1,this.pressedAt=null,this.releasedAt=null}return l()(e,[{key:"onPress",value:function(e,t){var n=this,i=O();return this.onPressListeners.push({id:i,context:t,callback:e}),function(){var e=n.onPressListeners.findIndex(function(e){return e.id===i});n.onPressListeners.splice(e,1)}}},{key:"onRelease",value:function(e,t){var n=this,i=O();return this.onReleaseListeners.push({id:i,context:t,callback:e}),function(){var e=n.onReleaseListeners.findIndex(function(e){return e.id===i});n.onReleaseListeners.splice(e,1)}}},{key:"press",value:function(){var e=!this.isPressed;if(this.isPressed=!0,this.pressedAt=Date.now(),this.releasedAt=null,e){var t=!0,n=!1,i=void 0;try{for(var o,r=this.onPressListeners[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.callback.call(s.context)}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}}},{key:"release",value:function(){var e=this.isPressed;if(this.isPressed=!1,this.pressedAt=null,this.releasedAt=Date.now(),e){var t=!0,n=!1,i=void 0;try{for(var o,r=this.onReleaseListeners[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.callback.call(s.context)}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}}},{key:"destroy",value:function(){this.onPressListeners=[],this.onReleaseListeners=[]}}]),e}(),F=function(e){function t(e,n){var i;return h()(this,t),(i=p()(this,v()(t).call(this,e,n))).left=void 0,i.right=void 0,i.up=void 0,i.down=void 0,i.action=void 0,i.shoot=void 0,i.left=new D,i.right=new D,i.up=new D,i.down=new D,i.action=new D,i.shoot=new D,i}return m()(t,e),l()(t,[{key:"start",value:function(){this.startListening(),this.scene.events.once(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}},{key:"stop",value:function(){this.scene.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this),this.shutdown()}},{key:"startListening",value:function(){this.scene.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.onPress,this),this.scene.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_UP,this.onRelease,this)}},{key:"shutdown",value:function(){this.scene.input.keyboard.off(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.onPress,this),this.scene.input.keyboard.off(Phaser.Input.Keyboard.Events.ANY_KEY_UP,this.onRelease,this),this.left.destroy(),this.right.destroy(),this.up.destroy(),this.down.destroy(),this.action.destroy(),this.shoot.destroy()}},{key:"onPress",value:function(e){switch(e.code){case"ArrowLeft":this.left.press();break;case"ArrowRight":this.right.press();break;case"ArrowUp":this.up.press();break;case"ArrowDown":this.down.press();break;case"KeyF":this.action.press();break;case"Space":this.shoot.press()}}},{key:"onRelease",value:function(e){switch(e.code){case"ArrowLeft":this.left.release();break;case"ArrowRight":this.right.release();break;case"ArrowUp":this.up.release();break;case"ArrowDown":this.down.release();break;case"KeyF":this.action.release();break;case"Space":this.shoot.release()}}}]),t}(Phaser.Plugins.ScenePlugin),L={"woollards-farm":"farm","woollards-house":"farm",forest:"forest",town:"farm"},N=function(e){return L[e]},B=function(e){function t(e,n){var i;return h()(this,t),(i=p()(this,v()(t).call(this,e,n))).currentMusicKey=void 0,i.keyedMusic=void 0,i.currentMusicKey="",i.keyedMusic={},i}return m()(t,e),l()(t,[{key:"playMusicForArea",value:function(e){var t=this.keyedMusic[this.currentMusicKey],n=N(e);if(this.currentMusicKey!==n){t&&this.scene.tweens.add({targets:t,props:{volume:{getStart:function(){return 1},getEnd:function(){return 0}}},onComplete:function(){t.stop()}}),this.keyedMusic[n]||(this.keyedMusic[n]=this.scene.sound.add(n,{loop:!0}));var i=this.keyedMusic[n];i.play(),this.scene.tweens.add({targets:i,props:{volume:{getStart:function(){return 0},getEnd:function(){return 1}}}}),this.currentMusicKey=n}}}]),t}(Phaser.Plugins.ScenePlugin),R=function(){function e(t,n,i){h()(this,e),this.scene=void 0,this.layers=void 0,this.scene=t;var o=t.cameras.main.centerX,r=t.cameras.main.centerY,s=t.cameras.main.width,a=t.cameras.main.height,c=n.length;this.layers=n.map(function(e,n){var h=t.add.tileSprite(o,r,s,a,e.key);return h.setScrollFactor(0),h.setDepth(i),{tileSprite:h,scrollFactor:(n+1)/c*.2}})}return l()(e,[{key:"scrollWithCamera",value:function(e){var t=this;this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,function(){return t.setOffset(e.scrollX)})}},{key:"setOffset",value:function(e){this.layers.forEach(function(t){t.tileSprite.setTilePosition(t.scrollFactor*e)})}},{key:"destroy",value:function(){this.layers.forEach(function(e){e.tileSprite.destroy()})}}]),e}(),H=function(e){function t(e){var n;return h()(this,t),n=p()(this,v()(t).call(this,e)),e.registerGameObject("parallaxSprite",n.createParallaxSprite),n}return m()(t,e),l()(t,[{key:"createParallaxSprite",value:function(e,t){return new R(this.scene,e,t)}}]),t}(Phaser.Plugins.BasePlugin),G=function(){function e(t){h()(this,e),this.propNames=void 0,this.onChangeListeners=void 0,this.data=void 0,this.propNames=t,this.onChangeListeners={},this.data={},Object.defineProperties(this,t.reduce(function(e,t){var n={get:function(){return this.data[t]},set:function(e){this.data[t]=e,(this.onChangeListeners[t]||[]).forEach(function(t){return t(e)})}};return e[t]=n,e},{}))}return l()(e,[{key:"onChange",value:function(e,t){var n=this;return this.onChangeListeners[e]=this.onChangeListeners[e]||[],this.onChangeListeners[e].push(t),function(){var i=n.onChangeListeners[e].findIndex(function(e){return e==t});n.onChangeListeners[e].splice(i,1)}}},{key:"toJson",value:function(){var e=this;return this.propNames.reduce(function(t,n){return t[n]=e.data[n],t},{})}},{key:"fromJson",value:function(e){var t=this;this.propNames.forEach(function(n){t.data[n]=e[n]})}}]),e}(),K=function(e){function t(){var e;return h()(this,t),(e=p()(this,v()(t).call(this,["maxHealth","health"]))).maxHealth=void 0,e.health=void 0,e.reset(),e}return m()(t,e),l()(t,[{key:"reset",value:function(){this.maxHealth=0,this.health=0}}]),t}(G),_=function(e){function t(){var e;return h()(this,t),(e=p()(this,v()(t).call(this,["areaKey","markerName"]))).areaKey=void 0,e.markerName=void 0,e.reset(),e}return m()(t,e),l()(t,[{key:"reset",value:function(){this.areaKey="",this.markerName=""}}]),t}(G),z="archer-adventure-save-game",X=function(e){function t(e){var n;return h()(this,t),(n=p()(this,v()(t).call(this,e))).data=void 0,n.progression=void 0,n.adventurer=void 0,n.location=void 0,n.data={},n.progression=new w,n.adventurer=new K,n.location=new _,n}return m()(t,e),l()(t,[{key:"hasSaveGame",value:function(){return null!=localStorage.getItem(z)}},{key:"resetSaveGame",value:function(){this.hasSaveGame()&&(this.progression.reset(),this.adventurer.reset(),this.location.reset(),this.save())}},{key:"save",value:function(){this.data.progression=this.progression.toJson(),this.data.adventurer=this.adventurer.toJson(),this.data.location=this.location.toJson(),localStorage.setItem(z,JSON.stringify(this.data))}},{key:"load",value:function(){var e=localStorage.getItem(z);if(!e)throw new Error("PERSISTENCE_PLUGIN::NO_SAVED_DATA");this.data=JSON.parse(e),this.progression.fromJson(this.data.progression),this.adventurer.fromJson(this.data.adventurer),this.location.fromJson(this.data.location)}}]),t}(Phaser.Plugins.BasePlugin),V=n(275),Y=n.n(V),W=function(){function e(t){h()(this,e),this.type=void 0,this.id=void 0,this.components=void 0,this.type=t,this.id=O(),this.components=[]}return l()(e,[{key:"getComponent",value:function(e){var t=this.components.find(function(t){return t instanceof e});if(t)return t;throw new Error("BaseEntity::NO_COMPONENT_".concat(Y()(e)))}},{key:"hasComponent",value:function(e){return this.components.some(function(t){return t instanceof e})}}]),e}(),U=function(){function e(t){h()(this,e),this.scene=void 0,this.prefabs=void 0,this.entitiesById=void 0,this.entities=void 0,this.scene=t,this.prefabs={},this.entitiesById={},this.entities=[]}return l()(e,[{key:"registerPrefab",value:function(e,t){this.prefabs[e]=t}},{key:"createPrefab",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=this.scene,a=new W(e),c=this.prefabs[e],h=r()({x:i,y:o,depth:n},g(t));return this.getComponentDefinitions(c).forEach(function(e){var t=new e.component(s,r()({},e.data,h),a);a.components.push(t)}),this.entitiesById[a.id]=a,this.entities.push(a),a}},{key:"getEntityById",value:function(e){return this.entitiesById[e]}},{key:"getEntities",value:function(e){if("string"==typeof e)return this.getEntitiesByType(e);if("function"==typeof e)return this.getEntitiesByComponent(e);throw new Error("Phecs.EntityManager::BAD_ENTITY_IDENTIFIER::".concat(e))}},{key:"destroy",value:function(){this.entities.forEach(function(e){e.components.forEach(function(e){return e.destroy()})}),this.entitiesById={},this.entities=[]}},{key:"getComponentDefinitions",value:function(e){return e.components.map(function(e){return"function"==typeof e?{component:e}:e})}},{key:"getEntitiesByComponent",value:function(e){return this.entities.filter(function(t){return t.hasComponent(e)})}},{key:"getEntitiesByType",value:function(e){return this.entities.filter(function(t){return t.type===e})}}]),e}(),J=function(){function e(t){h()(this,e),this.scene=void 0,this.systems=void 0,this.scene=t,this.systems=[]}return l()(e,[{key:"start",value:function(e){this.systems.forEach(function(t){t.start&&t.start(e)})}},{key:"stop",value:function(e){this.systems.forEach(function(t){t.stop&&t.stop(e)})}},{key:"update",value:function(e){this.systems.forEach(function(t){t.update&&t.update(e)})}},{key:"destroy",value:function(){this.systems.forEach(function(e){e.destroy&&e.destroy()}),this.systems=[]}},{key:"registerSystems",value:function(e){var t=this;e.forEach(function(e){t.systems.push(new e(t.scene))})}},{key:"removeSystems",value:function(e){var t=this,n=this.systems.filter(function(t){return e.some(function(e){return t instanceof e})});n.forEach(function(e){e.stop&&e.stop(t.scene.phecs.phEntities),e.destroy&&e.destroy()}),this.systems=this.systems.filter(function(e){return!n.includes(e)})}}]),e}(),Z=function(e){function t(e,n){var i;return h()(this,t),(i=p()(this,v()(t).call(this,e,n))).phEntities=void 0,i.phSystems=void 0,i.phEntities=new U(e),i.phSystems=new J(e),i}return m()(t,e),l()(t,[{key:"start",value:function(){this.phSystems.start(this.phEntities),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"stop",value:function(){this.phSystems.stop(this.phEntities),this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"update",value:function(){this.phSystems.update(this.phEntities)}},{key:"destroy",value:function(){this.phEntities.destroy()}},{key:"reset",value:function(){this.stop(),this.destroy()}},{key:"shutdown",value:function(){this.stop(),this.destroy(),this.phSystems.destroy()}}]),t}(Phaser.Plugins.ScenePlugin),q=function(e){function t(){var e,n;h()(this,t);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=p()(this,(e=v()(t)).call.apply(e,[this].concat(o)))).phecs=void 0,n.areaManager=void 0,n.persistence=void 0,n.controls=void 0,n.sfx=void 0,n}return m()(t,e),t}(Phaser.Scene),Q=function(){function e(t){h()(this,e),this.scene=void 0,this.scene=t}return l()(e,[{key:"update",value:function(e){var t=this.scene.areaManager.zones,n=e.getEntities("adventurer")[0].getComponent(b).sprite,i=Object.values(t).find(function(e){return e.shape.contains(n.x,n.y)});i&&i.data.toAreaKey&&i.data.toMarker&&this.scene.transferToArea(i.data.toAreaKey,i.data.toMarker)}}]),e}();!function(e){e[e.Initial=0]="Initial",e[e.PressControl=1]="PressControl",e[e.ReleaseControl=2]="ReleaseControl",e[e.Conditional=3]="Conditional",e[e.Timer=4]="Timer"}(j||(j={}));var $=function(){function e(t,n,i,o){h()(this,e),this.scene=void 0,this.entity=void 0,this.states=void 0,this.initialState=void 0,this.enabled=void 0,this.triggerCancelers=void 0,this.currentState=void 0,this.scene=t,this.entity=n,this.states=i,this.initialState=o,this.enabled=!0,this.currentState={id:"dummy",transitions:[]},this.triggerCancelers=[]}return l()(e,[{key:"update",value:function(){this.currentState.onUpdate&&this.currentState.onUpdate(this.entity,this.currentState.data||{})}},{key:"doTransition",value:function(e){this.cancelTransitionTriggers(),this.currentState.onLeave&&this.currentState.onLeave(this.entity,this.currentState.data||{});var t="string"==typeof e.to?e.to:e.to(this.entity);this.currentState=this.states.find(function(e){return e.id===t}),e.onTransition&&e.type!==j.Initial&&e.onTransition(this.entity),this.currentState.onEnter&&this.currentState.onEnter(this.entity,this.currentState.data||{}),this.registerTransitionTriggers()}},{key:"disable",value:function(){this.enabled=!1,this.doTransition({to:this.initialState.id}),this.cancelTransitionTriggers()}},{key:"enable",value:function(){this.enabled=!0,this.registerTransitionTriggers()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"destroy",value:function(){this.cancelTransitionTriggers()}},{key:"cancelTransitionTriggers",value:function(){this.triggerCancelers.forEach(function(e){return e()}),this.triggerCancelers=[]}},{key:"registerTransitionTriggers",value:function(){var e=this;this.currentState.transitions.forEach(function(t){switch(t.type){case j.PressControl:e.registerPressControlTransitionTrigger(t);break;case j.ReleaseControl:e.registerReleaseControlTransitionTrigger(t);break;case j.Conditional:e.registerConditionalTransitionTrigger(t);break;case j.Timer:e.registerTimerTransitionTrigger(t)}})}},{key:"registerPressControlTransitionTrigger",value:function(e){var t=this,n=this.scene.controls[e.control].onPress(function(){return t.doTransition(e)});this.triggerCancelers.push(n)}},{key:"registerReleaseControlTransitionTrigger",value:function(e){var t=this,n=this.scene.controls[e.control].onRelease(function(){return t.doTransition(e)});this.triggerCancelers.push(n)}},{key:"registerConditionalTransitionTrigger",value:function(e){var t=this,n=function(){e.condition(t.entity)&&t.doTransition(e)};this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,n),this.triggerCancelers.push(function(){return t.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,n)})}},{key:"registerTimerTransitionTrigger",value:function(e){var t=this,n="number"==typeof e.delay?e.delay:e.delay(),i=this.scene.time.delayedCall(n,function(){t.doTransition(e)});this.triggerCancelers.push(function(){return i.remove()})}}]),e}(),ee={maxVelocity:350,horizontalAcceleration:800,horizontalDeceleration:2e3,shortJumpVelocity:-350,jumpVelocity:-465,rollVelocity:350,aerialMaxHorizontalVelocity:250,aerialHorizontalAcceleration:300,aerialHorizontalFrictionAcceleration:150},te=function(){function e(t,n,i){h()(this,e),this.body=void 0,t.physics.add.existing(i.getComponent(b).sprite);var o=i.getComponent(b).sprite;this.body=o.body,this.body.setSize(o.width,o.height),this.body.updateBounds(),n.maxVelocityX&&(this.body.maxVelocity.x=n.maxVelocityX),n.collideWorldBounds&&(this.body.collideWorldBounds=!0)}return l()(e,[{key:"destroy",value:function(){this.body.destroy(),delete this.body}}]),e}(),ne={transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(te).body.blocked.down},to:function(e){return e.getComponent(te).body.velocity.y=100,e.getComponent(te).body.velocity.x>0?"adventurer-fall-right":e.getComponent(te).body.velocity.x<0?"adventurer-fall-left":"adventurer-fall"}}]};function ie(e,t){var n=[e.onEnter,t.onEnter].filter(Boolean),i=[e.onUpdate,t.onUpdate].filter(Boolean),o=[e.onLeave,t.onLeave].filter(Boolean),s=[e.transitions,t.transitions].filter(Boolean).flat(),a=r()({},e.data,t.data);return{id:e.id||t.id,transitions:s,data:a,onEnter:function(e,t){return n.forEach(function(n){return n(e,t)})},onUpdate:function(e,t){return i.forEach(function(n){return n(e,t)})},onLeave:function(e,t){return o.forEach(function(n){return n(e,t)})}}}var oe=ie(ne,{onEnter:function(e){!function(e){e.getComponent(te).body.acceleration.x=e.getComponent(te).body.velocity.x<0?ee.horizontalDeceleration:-ee.horizontalDeceleration}(e)},onUpdate:function(e){!function(e){Phaser.Math.Within(e.getComponent(te).body.velocity.x,0,100)&&(e.getComponent(te).body.acceleration.x=0,e.getComponent(te).body.velocity.x=0)}(e)}}),re=ie(oe,{id:"adventurer-stand",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-stand")},transitions:[{type:j.PressControl,control:"right",to:"adventurer-run"},{type:j.PressControl,control:"left",to:"adventurer-run"},{type:j.PressControl,control:"down",to:"adventurer-crouch"},{type:j.PressControl,control:"up",to:"adventurer-jump-prep"},{type:j.PressControl,control:"shoot",to:"adventurer-stand-draw"}]}),se=3,ae=function(){function e(t,n,i){h()(this,e),this.shotPower=void 0,this.shotChargeRate=void 0,this.minShotPower=void 0,this.maxShotPower=void 0,this.arrows=void 0,this.entity=void 0;var o=t;this.entity=i,this.minShotPower=300,this.maxShotPower=700,this.shotChargeRate=15,this.shotPower=this.minShotPower,this.arrows=[];for(var r=0;r<se;r++){var s=o.phecs.phEntities.createPrefab("arrow",{},i.getComponent(b).sprite.depth,0,0);s.getComponent(ft).phiniteStateMachine.doTransition({to:"arrow-disabled"}),this.arrows.push(s)}}return l()(e,[{key:"shootArrow",value:function(){var e=this.getAvailableArrow();e.getComponent(b).sprite.x=this.entity.getComponent(b).sprite.x,e.getComponent(b).sprite.y=this.entity.getComponent(b).sprite.y,e.getComponent(ft).phiniteStateMachine.doTransition({to:"arrow-flying"});var t=Phaser.Math.Clamp(this.shotPower,this.minShotPower,this.maxShotPower);this.entity.getComponent(b).sprite.flipX&&(t*=-1),e.getComponent(te).body.setVelocity(t,0),e.getComponent(te).body.setGravityY(-500),this.shotPower=this.minShotPower}},{key:"getAvailableArrow",value:function(){var e=this.arrows.filter(function(e){return"arrow-disabled"===e.getComponent(ft).phiniteStateMachine.currentState.id}),t=this.arrows.filter(function(e){return"arrow-hit"===e.getComponent(ft).phiniteStateMachine.currentState.id});if(e.length)return e[0];if(t.length)return t[0];throw new Error("ShootsArrows::shootArrow::NO_AVAILABLE_ARROWS")}},{key:"destroy",value:function(){this.arrows=[]}}]),e}(),ce=ie(oe,{id:"adventurer-stand-draw",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-stand-draw",!0)},onUpdate:function(e){e.getComponent(ae).shotPower+=e.getComponent(ae).shotChargeRate},transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(b).sprite.anims.isPlaying},to:"adventurer-stand-hold"},{type:j.ReleaseControl,control:"shoot",to:"adventurer-stand-shoot"},{type:j.PressControl,control:"left",to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(b).sprite.flipX=!0}},{type:j.PressControl,control:"right",to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(b).sprite.flipX=!1}}]}),he=ie(oe,{id:"adventurer-stand-hold",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-stand-hold",!0)},onUpdate:function(e){e.getComponent(ae).shotPower+=e.getComponent(ae).shotChargeRate},transitions:[{type:j.ReleaseControl,control:"shoot",to:"adventurer-stand-shoot"},{type:j.PressControl,control:"left",to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(b).sprite.flipX=!0}},{type:j.PressControl,control:"right",to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(b).sprite.flipX=!1}}]}),ue=function(){function e(t){h()(this,e),this.scene=void 0,this.scene=t}return l()(e,[{key:"destroy",value:function(){delete this.scene}}]),e}(),le=ie(oe,{id:"adventurer-stand-shoot",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-stand-shoot"),e.getComponent(ae).shootArrow()},transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(b).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(ue).scene.controls;return t.right.isPressed?"adventurer-run":t.left.isPressed?"adventurer-run":"adventurer-stand"}}]}),de=function(){function e(t,n,i){h()(this,e),this.isInvulnerable=void 0,this.scene=void 0,this.sprite=void 0,this.scene=t,this.isInvulnerable=!1,this.sprite=i.getComponent(b).sprite}return l()(e,[{key:"makeInvulnerableFor",value:function(e){var t=this;this.sprite.alpha=.5,this.makeInvulnerable();var n=this.scene.time.delayedCall(e,function(){t.sprite.alpha=1,t.makeVulnerable(),n.destroy()})}},{key:"makeInvulnerable",value:function(){this.isInvulnerable=!0}},{key:"makeVulnerable",value:function(){this.isInvulnerable=!1}},{key:"destroy",value:function(){delete this.isInvulnerable}}]),e}(),pe={id:"adventurer-roll",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-roll");var t=e.getComponent(te).body,n=e.getComponent(ue).scene;n.controls.left.isPressed?t.velocity.x=-ee.rollVelocity:n.controls.right.isPressed&&(t.velocity.x=ee.rollVelocity),e.getComponent(de).makeInvulnerable()},onLeave:function(e){e.getComponent(de).makeVulnerable()},transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(b).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(ue).scene.controls;return t.left.isPressed?"adventurer-run":t.right.isPressed?"adventurer-run":t.down.isPressed?"adventurer-crouch":"adventurer-stand"}},{type:j.PressControl,control:"up",to:"adventurer-jump-prep"}]},fe={id:"adventurer-jump-prep",onEnter:function(e){e.getComponent(te).body.acceleration.x=0,e.getComponent(b).sprite.anims.play("adventurer-jump-prep")},transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(b).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(ue).scene.controls;return t.right.isPressed?"adventurer-jump-right":t.left.isPressed?"adventurer-jump-left":e.getComponent(te).body.velocity.x>0?"adventurer-jump-right":e.getComponent(te).body.velocity.x<0?"adventurer-jump-left":"adventurer-jump"},onTransition:function(e){e.getComponent(ue).scene.controls.up.isPressed?e.getComponent(te).body.velocity.y=ee.jumpVelocity:e.getComponent(te).body.velocity.y=ee.shortJumpVelocity}}]};var ve={onUpdate:function(e,t){var n=e.getComponent(te).body,i=e.getComponent(ue).scene.controls;i.left.isPressed||i.right.isPressed?function(e,t){var n=e.getComponent(te).body,i=e.getComponent(ue).scene.controls;i.left.isPressed&&n.velocity.x>t?n.acceleration.x=-1*ee.aerialHorizontalAcceleration:i.right.isPressed&&n.velocity.x<t&&(n.acceleration.x=ee.aerialHorizontalAcceleration)}(e,t.targetAerialHorizontalVelocity):function(e){var t=e.getComponent(te).body;t.velocity.x>0?t.acceleration.x=-1*ee.aerialHorizontalFrictionAcceleration:t.velocity.x<0?t.acceleration.x=ee.aerialHorizontalFrictionAcceleration:t.acceleration.x=0}(e),Phaser.Math.Within(t.targetAerialHorizontalVelocity,n.velocity.x,5)&&(n.acceleration.x=0,n.velocity.x=t.targetAerialHorizontalVelocity)}},ye=ie(ve,{onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-jump-rise")},transitions:[{type:j.PressControl,control:"shoot",to:"adventurer-air-draw"}]}),me=ie(ye,{id:"adventurer-jump",data:{targetAerialHorizontalVelocity:0},transitions:[{type:j.PressControl,control:"left",to:"adventurer-jump-left"},{type:j.PressControl,control:"right",to:"adventurer-jump-right"},{type:j.Conditional,condition:function(e){return e.getComponent(te).body.velocity.y>1},to:"adventurer-fall"}]}),ge=ie(ye,{id:"adventurer-jump-left",data:{targetAerialHorizontalVelocity:-1*ee.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(b).sprite.flipX=!0},transitions:[{type:j.PressControl,control:"right",to:"adventurer-jump-right"},{type:j.Conditional,condition:function(e){return e.getComponent(te).body.velocity.y>0},to:"adventurer-fall-left"}]}),be=ie(ye,{id:"adventurer-jump-right",data:{targetAerialHorizontalVelocity:ee.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(b).sprite.flipX=!1},transitions:[{type:j.PressControl,control:"left",to:"adventurer-jump-left"},{type:j.Conditional,condition:function(e){return e.getComponent(te).body.velocity.y>0},to:"adventurer-fall-right"}]}),Ce=ie(ve,{onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-fall")},transitions:[{type:j.PressControl,control:"shoot",to:"adventurer-air-draw"},{type:j.Conditional,condition:function(e){return e.getComponent(te).body.blocked.down},to:function(e){var t=e.getComponent(ue).scene.controls;return t.down.isPressed?Math.abs(e.getComponent(te).body.velocity.x)>0?"adventurer-roll":"adventurer-crouch":t.left.isPressed?"adventurer-run":t.right.isPressed?"adventurer-run":"adventurer-stand"}}]}),ke=ie(Ce,{id:"adventurer-fall",data:{horizontalMaxVelocity:0},transitions:[{type:j.PressControl,control:"left",to:"adventurer-fall-left"},{type:j.PressControl,control:"right",to:"adventurer-fall-right"}]}),xe=ie(Ce,{id:"adventurer-fall-left",data:{targetAerialHorizontalVelocity:-1*ee.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(b).sprite.flipX=!0},transitions:[{type:j.PressControl,control:"right",to:"adventurer-fall-right"}]}),we=ie(Ce,{id:"adventurer-fall-right",data:{targetAerialHorizontalVelocity:ee.aerialMaxHorizontalVelocity},onEnter:function(e,t){e.getComponent(b).sprite.flipX=!1},transitions:[{type:j.PressControl,control:"left",to:"adventurer-fall-left"}]}),Pe=ie(ve,{id:"adventurer-air-draw",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-air-draw",!0)},onUpdate:function(e){e.getComponent(ae).shotPower+=e.getComponent(ae).shotChargeRate},transitions:[{type:j.Conditional,condition:function(e){return e.getComponent(te).body.blocked.down},to:"adventurer-stand-hold"},{type:j.ReleaseControl,control:"shoot",to:"adventurer-air-shoot"},{type:j.Conditional,condition:function(e){return!e.getComponent(b).sprite.anims.isPlaying},to:"adventurer-air-hold"},{type:j.PressControl,control:"left",to:"adventurer-air-draw",onTransition:function(e){e.getComponent(b).sprite.flipX=!0}},{type:j.PressControl,control:"right",to:"adventurer-air-draw",onTransition:function(e){e.getComponent(b).sprite.flipX=!1}}]}),Ee=ie(ve,{id:"adventurer-air-hold",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-air-hold",!0)},onUpdate:function(e){e.getComponent(ae).shotPower+=e.getComponent(ae).shotChargeRate},transitions:[{type:j.Conditional,condition:function(e){return e.getComponent(te).body.blocked.down},to:"adventurer-stand-hold"},{type:j.ReleaseControl,control:"shoot",to:"adventurer-air-shoot"},{type:j.PressControl,control:"left",to:"adventurer-air-hold",onTransition:function(e){e.getComponent(b).sprite.flipX=!0}},{type:j.PressControl,control:"right",to:"adventurer-air-hold",onTransition:function(e){e.getComponent(b).sprite.flipX=!1}}]}),Se=ie(ve,{id:"adventurer-air-shoot",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-air-shoot"),e.getComponent(ae).shootArrow()},transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(b).sprite.anims.isPlaying},to:function(e){return e.getComponent(te).body.velocity.y<0?"adventurer-jump":"adventurer-fall"}}]});var Te=[re,ce,he,le,ie(oe,{id:"adventurer-crouch",onEnter:function(e){e.getComponent(b).sprite.anims.play("adventurer-crouch")},transitions:[{type:j.ReleaseControl,control:"down",to:function(e){var t=e.getComponent(ue).scene.controls;return t.left.isPressed?"adventurer-run":t.right.isPressed?"adventurer-run":"adventurer-stand"}},{type:j.PressControl,control:"left",to:"adventurer-roll",onTransition:function(e){e.getComponent(b).sprite.flipX=!0}},{type:j.PressControl,control:"right",to:"adventurer-roll",onTransition:function(e){e.getComponent(b).sprite.flipX=!1}}]}),ie(ne,{id:"adventurer-run",onEnter:function(e){var t=e.getComponent(b).sprite,n=e.getComponent(ue).scene.controls;t.anims.play("adventurer-run");!function(e,t){"left"===t?(e.getComponent(b).sprite.flipX=!0,e.getComponent(te).body.acceleration.x=-ee.horizontalAcceleration):"right"===t&&(e.getComponent(b).sprite.flipX=!1,e.getComponent(te).body.acceleration.x=ee.horizontalAcceleration);!function(e){Phaser.Math.Within(e.getComponent(te).body.velocity.x,0,5)||(e.getComponent(te).body.velocity.x+=.5*e.getComponent(te).body.velocity.x*-1)}(e)}(e,n.left.isPressed&&n.right.isPressed?n.left.pressedAt>n.right.pressedAt?"left":"right":n.left.isPressed?"left":"right")},transitions:[{type:j.ReleaseControl,control:"right",to:function(e){return e.getComponent(ue).scene.controls.left.isPressed?"adventurer-run":"adventurer-stand"}},{type:j.ReleaseControl,control:"left",to:function(e){return e.getComponent(ue).scene.controls.right.isPressed?"adventurer-run":"adventurer-stand"}},{type:j.PressControl,control:"left",to:"adventurer-run"},{type:j.PressControl,control:"right",to:"adventurer-run"},{type:j.PressControl,control:"shoot",to:"adventurer-stand-draw"},{type:j.PressControl,control:"down",to:"adventurer-roll"},{type:j.PressControl,control:"up",to:"adventurer-jump-prep"}]}),pe,fe,me,ge,be,ke,xe,we,Pe,Ee,Se],Ae={id:"arrow-flying",transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(te).body.blocked.none},to:"arrow-hit"}],onEnter:function(e){e.getComponent(b).sprite.active=!0,e.getComponent(b).sprite.visible=!0,e.getComponent(te).body.enable=!0,e.getComponent(te).body.allowGravity=!0,e.getComponent(te).body.setVelocity(400,0)},onUpdate:function(e){if(e.getComponent(te).body.blocked.none){var t=Math.atan2(e.getComponent(te).body.velocity.y,e.getComponent(te).body.velocity.x);e.getComponent(b).sprite.rotation=t}}},Me={id:"arrow-hit",transitions:[],onEnter:function(e){e.getComponent(te).body.setVelocity(0,0),e.getComponent(te).body.allowGravity=!1}},Ie=function(){function e(t,n,i){h()(this,e),this.config=void 0,this.shape=void 0,this.debugGraphic=void 0,this.config=t,this.shape=new Phaser.Geom.Rectangle(0,0,t.width,t.height),n&&i&&(this.debugGraphic=i.add.rectangle(this.shape.x,this.shape.y,this.shape.width,this.shape.height,n,.5),this.debugGraphic.setOrigin(0),this.debugGraphic.setDepth(C.depthFor("debug")))}return l()(e,[{key:"setConfig",value:function(e){this.config=e}},{key:"disable",value:function(){this.shape.x=0,this.shape.y=0,this.shape.width=0,this.shape.height=0,this.debugGraphic&&(this.debugGraphic.width=0,this.debugGraphic.height=0)}},{key:"overlapsRectangle",value:function(e){return Phaser.Geom.Intersects.RectangleToRectangle(e,this.shape)}},{key:"overlapsCircle",value:function(e){return Phaser.Geom.Intersects.CircleToRectangle(e,this.shape)}},{key:"syncToSprite",value:function(e){var t=e.scaleX,n=e.scaleY,i=(e.flipX?-1*this.config.offsetX:this.config.offsetX)*t,o=(e.flipY?-1*this.config.offsetY:this.config.offsetY)*n,r=t*this.config.width,s=n*this.config.height,a=e.getCenter(),c=new Phaser.Geom.Point(a.x+i,a.y+o);Phaser.Math.RotateAround(c,a.x,a.y,e.rotation),c.x-=r/2,c.y-=s/2,this.shape.x=c.x,this.shape.y=c.y,this.shape.width=r,this.shape.height=s,this.debugGraphic&&(this.debugGraphic.x=this.shape.x,this.debugGraphic.y=this.shape.y,this.debugGraphic.width=this.shape.width,this.debugGraphic.height=this.shape.height)}},{key:"destroy",value:function(){this.debugGraphic&&this.debugGraphic.destroy(),delete this.shape,delete this.destroy}}]),e}(),Oe=function(){function e(t,n,i){h()(this,e),this.config=void 0,this.shape=void 0,this.debugGraphic=void 0,this.config=t,this.shape=new Phaser.Geom.Circle(0,0,t.radius),n&&i&&(this.debugGraphic=i.add.circle(this.shape.x,this.shape.y,this.shape.radius,n,.5),this.debugGraphic.setOrigin(.5),this.debugGraphic.setDepth(C.depthFor("debug")))}return l()(e,[{key:"setConfig",value:function(e){this.config=e}},{key:"disable",value:function(){this.shape.x=0,this.shape.y=0,this.shape.radius=0,this.debugGraphic&&(this.debugGraphic.radius=0)}},{key:"overlapsRectangle",value:function(e){return Phaser.Geom.Intersects.CircleToRectangle(this.shape,e)}},{key:"overlapsCircle",value:function(e){return Phaser.Geom.Intersects.CircleToCircle(this.shape,e)}},{key:"syncToSprite",value:function(e){var t=e.scale,n=(e.flipX?-1*this.config.offsetX:this.config.offsetX)*t,i=(e.flipY?-1*this.config.offsetY:this.config.offsetY)*t,o=t*this.config.radius,r=e.getCenter(),s=new Phaser.Geom.Point(r.x+n,r.y+i);Phaser.Math.RotateAround(s,r.x,r.y,e.rotation),this.shape.x=s.x,this.shape.y=s.y,this.shape.radius=o,this.debugGraphic&&(this.debugGraphic.x=this.shape.x,this.debugGraphic.y=this.shape.y,this.debugGraphic.radius=this.shape.radius)}},{key:"destroy",value:function(){this.debugGraphic&&this.debugGraphic.destroy(),delete this.shape,delete this.destroy}}]),e}(),je=function(){function e(t,n,i,o){if(h()(this,e),this.type=void 0,this.shape=void 0,this.enabled=void 0,this.type=t,this.enabled=!0,"circle"===n.shape)this.shape=new Oe(n,i,o);else{if("rectangle"!==n.shape)throw new Error("Attachment::INVALID_SHAPE_TYPE_IN_CONFIG");this.shape=new Ie(n,i,o)}}return l()(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.shape.disable()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"overlaps",value:function(e){if(this.shape instanceof Ie){if(e.shape instanceof Ie)return this.shape.overlapsRectangle(e.shape.shape);if(e.shape instanceof Oe)return this.shape.overlapsCircle(e.shape.shape)}else if(this.shape instanceof Oe){if(e.shape instanceof Ie)return this.shape.overlapsRectangle(e.shape.shape);if(e.shape instanceof Oe)return this.shape.overlapsCircle(e.shape.shape)}throw new Error("Attachment::INVALID_ATTACHMENT_FOR_OVERLAP")}},{key:"setConfig",value:function(e){this.shape instanceof Ie&&this.shape.setConfig(e)}},{key:"syncToSprite",value:function(e){this.enabled&&this.shape.syncToSprite(e)}},{key:"destroy",value:function(){this.shape.destroy()}}]),e}(),De=function(){function e(t,n,i){h()(this,e),this.attachments=void 0,this.scene=void 0,this.data=void 0,this.scene=t,this.data=n,this.attachments=[]}return l()(e,[{key:"createAttachment",value:function(e,t,n){var i=new je(e,t,n,this.scene);return this.attachments.push(i),i}},{key:"getAttachmentsByType",value:function(e){return this.attachments.filter(function(t){return t.type===e})}},{key:"destroy",value:function(){this.attachments.forEach(function(e){return e.destroy()}),delete this.attachments,delete this.getAttachmentsByType,delete this.createAttachment}}]),e}(),Fe=16711680,Le=function(){function e(t,n,i){h()(this,e),this.hitboxFrames=void 0,this.enabled=void 0,this.entity=void 0,this.entity=i,this.hitboxFrames=t.cache.json.get(n.hitboxesKey).frames,this.enabled=!0;for(var o=this.hitboxFrames.map(function(e){return e.hitboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),r=0;r<o;r++)i.getComponent(De).createAttachment("hitbox",{shape:"rectangle",offsetX:0,offsetY:0,width:0,height:0},n.debug?Fe:void 0)}return l()(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(De).getAttachmentsByType("hitbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hitboxFrames}}]),e}(),Ne=[Ae,Me,{id:"arrow-disabled",transitions:[],onEnter:function(e){e.getComponent(b).sprite.active=!1,e.getComponent(b).sprite.visible=!1,e.getComponent(te).body.enable=!1,e.getComponent(te).body.allowGravity=!1,e.getComponent(Le).disable()},onLeave:function(e){e.getComponent(b).sprite.active=!0,e.getComponent(b).sprite.visible=!0,e.getComponent(te).body.enable=!0,e.getComponent(te).body.allowGravity=!0,e.getComponent(Le).enable()}}],Be={id:"barrel-destroyed",transitions:[{type:j.Conditional,condition:function(e){return!e.getComponent(b).sprite.anims.isPlaying},to:"barrel-disabled"}],onEnter:function(e){e.getComponent(b).sprite.anims.play("barrel-destroy")}},Re=255,He=function(){function e(t,n,i){h()(this,e),this.hurtboxFrames=void 0,this.enabled=void 0,this.entity=void 0,this.entity=i,this.hurtboxFrames=t.cache.json.get(n.hurtboxesKey).frames,this.enabled=!0;for(var o=this.hurtboxFrames.map(function(e){return e.hurtboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),r=0;r<o;r++)i.getComponent(De).createAttachment("hurtbox",{shape:"rectangle",offsetX:0,offsetY:0,width:0,height:0},n.debug?Re:void 0)}return l()(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(De).getAttachmentsByType("hurtbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hurtboxFrames}}]),e}(),Ge=[{id:"barrel-idle",transitions:[]},Be,{id:"barrel-disabled",transitions:[],onEnter:function(e){e.getComponent(b).sprite.active=!1,e.getComponent(b).sprite.visible=!1,e.getComponent(He).disable()}}],Ke=n(276),_e=n.n(Ke),ze=function(){function e(){h()(this,e),this.entities=void 0,this.entities={}}return l()(e,[{key:"update",value:function(e){var t=this;new Set([].concat(_e()(Object.keys(this.entities)),_e()(e))).forEach(function(n){var i=t.entities[n];null!=i&&"inactive"!==i||!e.includes(n)?"entering"===i?t.entities[n]="active":"active"!==i||e.includes(n)?"exiting"===i&&(t.entities[n]="inactive"):t.entities[n]="exiting":t.entities[n]="entering"})}},{key:"getEntityIds",value:function(e){return Object.entries(this.entities).filter(function(t){var n=a()(t,2);n[0];return n[1]===e}).map(function(e){return a()(e,1)[0]})}},{key:"destroy",value:function(){this.entities={}}}]),e}(),Xe=65280,Ve=function(){function e(t,n,i){h()(this,e),this.interactionTracker=void 0,this.debugInteractionCircle=void 0,this.attachment=void 0,this.attachment=i.getComponent(De).createAttachment("interaction",r()({offsetX:0,offsetY:0},n.shapeConfig||{shape:"circle",radius:n.interactionRadius}),n.debug?Xe:void 0),this.interactionTracker=new ze}return l()(e,[{key:"destroy",value:function(){this.interactionTracker.destroy(),this.attachment.destroy(),delete this.interactionTracker,delete this.debugInteractionCircle}}]),e}(),Ye=function(){function e(t,n){h()(this,e),this.scene=void 0,this.scene=t}return l()(e,[{key:"decreaseHealth",value:function(e){this.scene.persistence.adventurer.health-=e}},{key:"destroy",value:function(){}}]),e}(),We={id:"enemy-idle",onEnter:function(e){e.getComponent(te).body.velocity.x=0,e.getComponent(b).sprite.anims.play("enemy-idle")},transitions:[{type:j.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:j.Conditional,condition:function(e){var t=e.getComponent(Ve).interactionTracker.getEntityIds("active"),n=e.getComponent(ue).scene,i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value;if(n.phecs.phEntities.getEntityById(c).hasComponent(Ye))return!0}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return!1},to:"enemy-track-adventurer"}]},Ue={id:"enemy-dead",onEnter:function(e){var t=e.getComponent(b).sprite;t.anims.stop(),e.getComponent(te).body.enable=!1,e.getComponent(He).disable(),e.getComponent(ue).scene.tweens.add({targets:[t],props:{alpha:0},duration:100,yoyo:!0,repeat:1,onComplete:function(){t.active=!1,t.visible=!1}})},transitions:[]},Je={id:"enemy-stun",onEnter:function(e){var t=e.getComponent(b).sprite,n=e.getComponent(te).body;t.anims.stop(),n.allowGravity=!1,n.velocity.x=0,n.velocity.y=0,e.getComponent(ue).scene.tweens.timeline({tweens:[{targets:t,props:{alpha:.5},duration:100,completeDelay:300},{targets:t,props:{alpha:1},duration:100}]})},onLeave:function(e){e.getComponent(te).body.allowGravity=!0},transitions:[{type:j.Conditional,condition:function(e){var t=e.getComponent(b).sprite;return!e.getComponent(ue).scene.tweens.isTweening(t)},to:function(e){return e.getComponent(te).body.blocked.down?"enemy-idle":"enemy-fall"}}]},Ze=-350,qe=60,Qe=30,$e={id:"enemy-jump",onEnter:function(e){e.getComponent(b).sprite.anims.play("enemy-jump"),e.getComponent(te).body.velocity.y=Ze},transitions:[{type:j.Conditional,condition:function(e){return e.getComponent(te).body.velocity.y<=0},to:"enemy-fall"}]},et={id:"enemy-track-adventurer",onEnter:function(e){e.getComponent(b).sprite.anims.play("enemy-jump")},onUpdate:function(e){var t=e.getComponent(ue).scene.phecs.phEntities.getEntities(Ye)[0].getComponent(b).sprite,n=e.getComponent(b).sprite,i=e.getComponent(te).body;n.x<t.x?(i.velocity.x=qe,n.flipX=!1):n.x>t.x&&(i.velocity.x=-qe,n.flipX=!0)},transitions:[{type:j.Timer,delay:1e3,to:"enemy-jump-prep"},{type:j.Conditional,condition:function(e){var t=e.getComponent(ue).scene,n=e.getComponent(Ve).interactionTracker.getEntityIds("active"),i=t.phecs.phEntities.getEntities(Ye)[0].id;return!n.includes(i)},to:"enemy-idle"}]},tt={id:"enemy-fall",onEnter:function(e){e.getComponent(b).sprite.anims.play("enemy-jump")},transitions:[{type:j.Conditional,condition:function(e){return e.getComponent(te).body.blocked.down},to:"enemy-idle"}]},nt=function(){function e(t,n){h()(this,e),this.zone=void 0;var i=t.areaManager.getZone(n.zoneBoundaryName);if(null==i)throw new Error("ZoneBoundaryComponent::ZONE_NOT_FOUND");this.zone=i.shape}return l()(e,[{key:"destroy",value:function(){delete this.zone}}]),e}(),it={id:"enemy-wander",onEnter:function(e){var t=e.getComponent(b).sprite,n=e.getComponent(te).body;n.velocity.x=Phaser.Math.RND.pick([-1,1])*Qe,n.velocity.x<0?t.flipX=!0:t.flipX=!1},onUpdate:function(e){var t=e.getComponent(b).sprite,n=e.getComponent(te).body,i=e.getComponent(nt).zone;Phaser.Geom.Rectangle.ContainsRect(i,t.getBounds())||(n.velocity.x*=-1)},transitions:[{type:j.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(e){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:j.Conditional,condition:function(e){var t=e.getComponent(Ve).interactionTracker.getEntityIds("active"),n=e.getComponent(ue).scene,i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value;if(n.phecs.phEntities.getEntityById(c).hasComponent(Ye))return!0}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return!1},to:"enemy-track-adventurer"}]},ot=[We,Je,Ue,{id:"enemy-jump-prep",onEnter:function(e){var t=e.getComponent(b).sprite,n=e.getComponent(ue).scene;t.anims.stop(),n.tweens.timeline({tweens:[{targets:t,props:{scaleY:.8,scaleX:1.2},duration:100,completeDelay:100},{targets:t,props:{scaleY:1,scaleX:1},duration:100}]})},transitions:[{type:j.Timer,delay:300,to:"enemy-jump"}]},$e,tt,et,it],rt={id:"sheep-walk-left",onEnter:function(e){e.getComponent(b).sprite.anims.play("sheep-walk"),e.getComponent(b).sprite.flipX=!0,e.getComponent(te).body.velocity.x=-50},transitions:[{type:j.Timer,delay:function(){return Phaser.Math.RND.between(1e3,1500)},to:function(){return Phaser.Math.RND.pick(["sheep-idle","sheep-walk-left"])}},{type:j.Conditional,condition:function(e){var t=e.getComponent(b).sprite,n=e.getComponent(nt).zone;return t.x<n.x},to:"sheep-walk-right"}]},st={id:"sheep-walk-right",onEnter:function(e){e.getComponent(b).sprite.anims.play("sheep-walk"),e.getComponent(b).sprite.flipX=!1,e.getComponent(te).body.velocity.x=50},transitions:[{type:j.Timer,delay:function(){return Phaser.Math.RND.between(1e3,1500)},to:function(){return Phaser.Math.RND.pick(["sheep-walk-right","sheep-idle"])}},{type:j.Conditional,condition:function(e){var t=e.getComponent(b).sprite,n=e.getComponent(nt).zone;return t.x+t.width>n.x+n.width},to:"sheep-walk-left"}]},at={id:"sheep-idle",onEnter:function(e){e.getComponent(te).body.setVelocity(0),e.getComponent(b).sprite.anims.stop()},transitions:[{type:j.Timer,delay:function(){return Phaser.Math.RND.between(1e3,1500)},to:function(){return Phaser.Math.RND.pick(["sheep-walk-left","sheep-walk-right"])}}]},ct={},ht={};[{id:"adventurer",states:Te},{id:"arrow",states:Ne},{id:"enemy",states:ot},{id:"sheep",states:[at,rt,st]},{id:"old-lady",states:[{id:"old-lady-idle",onEnter:function(e){e.getComponent(b).sprite.anims.play("old-lady-idle")},transitions:[]}]},{id:"old-man",states:[{id:"old-man-idle",onEnter:function(e){e.getComponent(b).sprite.anims.play("old-man-idle")},transitions:[]}]},{id:"barrel",states:Ge}].forEach(function(e){e.states.forEach(function(e){ct[e.id]=e}),ht[e.id]=e.states.map(function(e){return e.id})});var ut,lt,dt,pt={getState:function(e){return ct[e]},getSet:function(e){return ht[e].map(function(e){return ct[e]})}},ft=function(){function e(t,n,i){h()(this,e),this.phiniteStateMachine=void 0;var o=pt.getSet(n.stateSet),r=pt.getState(n.initialStateId);this.phiniteStateMachine=new $(t,i,o,r),n.phiniteStateMachineDisabled?this.phiniteStateMachine.disable():this.phiniteStateMachine.doTransition({type:j.Initial,to:r.id})}return l()(e,[{key:"destroy",value:function(){this.phiniteStateMachine.destroy(),delete this.phiniteStateMachine}}]),e}(),vt=function(){function e(t,n){h()(this,e),this.maxHealth=void 0,this.currentHealth=void 0,this.onDeathListeners=void 0,this.onDamageListeners=void 0,this.maxHealth=n.maxHealth,this.currentHealth=this.maxHealth,this.onDeathListeners=[],this.onDamageListeners=[]}return l()(e,[{key:"decreaseHealth",value:function(e){var t=this;this.currentHealth-=e,this.currentHealth<=0?this.onDeathListeners.forEach(function(e){return e()}):this.onDamageListeners.forEach(function(e){return e(t.currentHealth)})}},{key:"onDamage",value:function(e){this.onDamageListeners.push(e)}},{key:"onDeath",value:function(e){this.onDeathListeners.push(e)}},{key:"destroy",value:function(){delete this.maxHealth,delete this.currentHealth,delete this.onDeathListeners,delete this.onDamageListeners}}]),e}(),yt=function(){function e(t,n,i){h()(this,e),this.entities1Config=void 0,this.entities2Config=void 0,this.onHit=void 0,this.entities1Config=t,this.entities2Config=n,this.onHit=i}return l()(e,[{key:"update",value:function(e){var t=this.entities1Config.entityFetcher(e),n=this.entities2Config.entityFetcher(e),i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value,h=c.getComponent(De).getAttachmentsByType(this.entities1Config.boxType).filter(function(e){return e.isEnabled()}),u=!0,l=!1,d=void 0;try{for(var p,f=n[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var v=p.value,y=v.getComponent(De).getAttachmentsByType(this.entities2Config.boxType).filter(function(e){return e.isEnabled()});this.doBoxesOverlap(h,y)&&this.onHit(c,v)}}catch(e){l=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw d}}}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}}},{key:"doBoxesOverlap",value:function(e,t){var n=!1,i=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value;if(n)break;var h=!0,u=!1,l=void 0;try{for(var d,p=t[Symbol.iterator]();!(h=(d=p.next()).done);h=!0){var f=d.value;if(n)break;n=c.overlaps(f)}}catch(e){u=!0,l=e}finally{try{h||null==p.return||p.return()}finally{if(u)throw l}}}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}}]),e}(),mt=function(){function e(t,n,i){h()(this,e);var o=i.getComponent(vt),r=i.getComponent(ft).phiniteStateMachine;o.onDamage(function(){r.doTransition({to:"enemy-stun"})}),o.onDeath(function(){r.doTransition({to:"enemy-dead"})})}return l()(e,[{key:"destroy",value:function(){}}]),e}(),gt=1,bt=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{entityFetcher:function(e){return e.getEntities("arrow").filter(function(e){return"arrow-flying"===e.getComponent(ft).phiniteStateMachine.currentState.id})},boxType:"hitbox"},{entityFetcher:function(e){return e.getEntities(mt).filter(function(e){return e.getComponent(ft).phiniteStateMachine.isEnabled()})},boxType:"hurtbox"},function(e,t){e.getComponent(ft).phiniteStateMachine.doTransition({to:"arrow-disabled"}),t.getComponent(vt).decreaseHealth(gt)}))}return m()(t,e),t}(yt),Ct=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{entityFetcher:function(e){return e.getEntities("arrow").filter(function(e){return"arrow-flying"===e.getComponent(ft).phiniteStateMachine.currentState.id})},boxType:"hitbox"},{entityFetcher:function(e){return e.getEntities("barrel").filter(function(e){return"barrel-idle"===e.getComponent(ft).phiniteStateMachine.currentState.id})},boxType:"hurtbox"},function(e,t){t.getComponent(ft).phiniteStateMachine.doTransition({to:"barrel-destroyed"})}))}return m()(t,e),t}(yt),kt={preload:"preload",title:"title",exploration:"exploration",hud:"hud",death:"death",newGame:"newGame",continueGame:"continueGame",prefabTest:"prefabTest"},xt=function(){function e(t){h()(this,e),this.scene=void 0,this.healthListenerCleanupFn=void 0,this.scene=t}return l()(e,[{key:"start",value:function(e){var t=this;this.healthListenerCleanupFn=this.scene.persistence.adventurer.onChange("health",function(e){e<=0&&(t.scene.scene.stop(kt.hud),t.scene.scene.pause(kt.exploration),t.scene.scene.launch(kt.death))})}},{key:"stop",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn(),delete this.healthListenerCleanupFn}}]),e}(),wt=function(){function e(t,n,i){h()(this,e),this.scene=void 0,this.identifierA=void 0,this.identifierB=void 0,this.listeners=void 0,this.scene=t,this.identifierA=n,this.identifierB=i,this.listeners=[]}return l()(e,[{key:"start",value:function(e){var t=this,n=e.getEntities(this.identifierA),i=e.getEntities(this.identifierB);this.validateEntities(n),this.validateEntities(i);var o=this.scene.controls.action,r=!0,s=!1,a=void 0;try{for(var c,h=function(){var e=c.value,n=!0,r=!1,s=void 0;try{for(var a,h=function(){var n=a.value,i=function(){e.getComponent(Ve).interactionTracker.getEntityIds("active").includes(n.id)&&t.onInteraction&&t.onInteraction(e,n)},r=o.onPress(i);t.listeners.push({control:"action",listener:i,listenerCancelFn:r})},u=i[Symbol.iterator]();!(n=(a=u.next()).done);n=!0)h()}catch(e){r=!0,s=e}finally{try{n||null==u.return||u.return()}finally{if(r)throw s}}},u=n[Symbol.iterator]();!(r=(c=u.next()).done);r=!0)h()}catch(e){s=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(s)throw a}}}},{key:"stop",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this.listeners[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.listenerCancelFn()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"update",value:function(e){var t=e.getEntities(this.identifierA),n=e.getEntities(this.identifierB),i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var c=s.value,h=c.getComponent(Ve).interactionTracker,u=this.getInteractingEntityBs(h,n,"entering"),l=!0,d=!1,p=void 0;try{for(var f,v=u[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var y=f.value;this.onEnter&&this.onEnter(c,y)}}catch(e){d=!0,p=e}finally{try{l||null==v.return||v.return()}finally{if(d)throw p}}var m=this.getInteractingEntityBs(h,n,"exiting"),g=!0,b=!1,C=void 0;try{for(var k,x=m[Symbol.iterator]();!(g=(k=x.next()).done);g=!0){var w=k.value;this.onExit&&this.onExit(c,w)}}catch(e){b=!0,C=e}finally{try{g||null==x.return||x.return()}finally{if(b)throw C}}}}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}}},{key:"destroy",value:function(){this.listeners=[]}},{key:"validateEntities",value:function(e){if(!e.every(function(e){return e.hasComponent(Ve)}))throw new Error("BaseInteractionSystem::ENTITY_MISSING_INTERACTION_COMPONENT")}},{key:"getInteractingEntityBs",value:function(e,t,n){var i=e.getEntityIds(n);return t.filter(function(e){return i.includes(e.id)})}}]),e}(),Pt=n(109),Et=n.n(Pt);!function(e){e.TOP="top",e.LEFT="left"}(dt||(dt={}));var St=10,Tt=(ut={},Et()(ut,dt.TOP,"indicator-down"),Et()(ut,dt.LEFT,"indicator-right"),ut),At=(lt={},Et()(lt,dt.TOP,"indicator-down"),Et()(lt,dt.LEFT,"indicator-right"),lt),Mt=function(){function e(t,n,i){h()(this,e),this.sprite=void 0,this.side=void 0;var o=n.x,r=n.y;this.side=i,this.sprite=t.add.sprite(o,r,Tt[i]),this.sprite.setDepth(n.depth),i===dt.TOP?(this.sprite.setOrigin(.5,1),this.sprite.y=r-n.height*n.scaleY/2-St):i===dt.LEFT&&(this.sprite.setOrigin(1,.5),this.sprite.x=o-n.width*n.scaleX/2-St)}return l()(e,[{key:"show",value:function(){this.sprite.visible=!0,this.sprite.active=!0,this.sprite.anims.play(At[this.side])}},{key:"hide",value:function(){this.sprite.visible=!1,this.sprite.active=!1,this.sprite.anims.stop()}},{key:"destroy",value:function(){this.sprite.destroy()}}]),e}(),It=function(){function e(t,n,i){h()(this,e),this.indicator=void 0;var o=n.indicatorSide||dt.TOP,r=i.getComponent(b).sprite;this.indicator=new Mt(t,r,o),this.indicator.hide()}return l()(e,[{key:"destroy",value:function(){this.indicator.destroy()}}]),e}(),Ot=function(){function e(t,n){h()(this,e),this.toAreaKey=void 0,this.toMarker=void 0,this.toAreaKey=n.toAreaKey,this.toMarker=n.toMarker}return l()(e,[{key:"destroy",value:function(){delete this.toAreaKey,delete this.toMarker}}]),e}(),jt=function(e){function t(e){var n;return h()(this,t),(n=p()(this,v()(t).call(this,e,Ye,Ot))).explorationScene=void 0,n.explorationScene=e,n}return m()(t,e),l()(t,[{key:"onEnter",value:function(e,t){t.getComponent(It).indicator.show()}},{key:"onInteraction",value:function(e,t){var n=t.getComponent(Ot);this.explorationScene.transferToArea(n.toAreaKey,n.toMarker)}},{key:"onExit",value:function(e,t){t.getComponent(It).indicator.hide()}}]),t}(wt),Dt=function(){function e(t,n,i){h()(this,e),this.scene=void 0,this.conversation=void 0,this.entityY=void 0,this.conversationBoxSprite=void 0,this.conversationProgressIndex=void 0,this.conversationKey=void 0,this.scene=t,this.conversationKey=n.conversationKey,this.conversation=[];var o=i.getComponent(b).sprite;this.entityY=o.y,this.conversationProgressIndex=0,this.conversationBoxSprite=t.add.ninePatch(o.x,o.y,0,0,"conversation-box",null,{top:6,left:15,right:15,bottom:12}),this.conversationBoxSprite.alpha=0,this.conversationBoxSprite.setDepth(C.depthFor("notifications"))}return l()(e,[{key:"startConversation",value:function(){this.loadConversation(),this.conversationBoxSprite.alpha=1,this.conversationProgressIndex=0,this.updateConversationText()}},{key:"continueConversation",value:function(){this.hasMoreConversation()?this.conversationProgressIndex+=1:this.stopConversation(),this.updateConversationText()}},{key:"stopConversation",value:function(){this.conversationBoxSprite.alpha=0}},{key:"hasMoreConversation",value:function(){return this.conversationProgressIndex<this.conversation.length-1}},{key:"destroy",value:function(){this.conversationBoxSprite.destroy()}},{key:"loadConversation",value:function(){var e=this.scene.persistence.progression.conversations.getCurrentConversationId(this.conversationKey);this.conversation=this.scene.cache.json.get("conversations")[e]}},{key:"updateConversationText",value:function(){var e=this.scene.add.bitmapText(0,0,"compass-24-conversation",this.conversation[this.conversationProgressIndex]);e.setMaxWidth(300),e.setOrigin(.5);var t=e.getTextBounds().local;if(this.conversationBoxSprite.resize(t.width+50,t.height+50),this.conversationBoxSprite.add(e),this.hasMoreConversation()){var n=this.scene.add.sprite(this.conversationBoxSprite.width/2-5,-this.conversationBoxSprite.height/2-2,"indicator-right");n.setOrigin(1,0),n.anims.play("indicator-right"),this.conversationBoxSprite.add(n)}this.conversationBoxSprite.y=this.entityY-this.conversationBoxSprite.height/2-40}}]),e}(),Ft=function(e){function t(e){var n;return h()(this,t),(n=p()(this,v()(t).call(this,e,Ye,"npc"))).interacting=void 0,n.interacting=!1,n}return m()(t,e),l()(t,[{key:"onEnter",value:function(e,t){t.getComponent(It).indicator.show()}},{key:"onInteraction",value:function(e,t){var n=t.getComponent(Dt);this.interacting?this.interacting&&n.hasMoreConversation()?n.continueConversation():(this.interacting=!1,n.stopConversation(),this.scene.persistence.progression.conversations.markCurrentConversationComplete(n.conversationKey),this.scene.persistence.save()):(this.interacting=!0,t.getComponent(It).indicator.hide(),n.startConversation())}},{key:"onExit",value:function(e,t){if(this.interacting){var n=t.getComponent(Dt);n.hasMoreConversation()||(this.scene.persistence.progression.conversations.markCurrentConversationComplete(n.conversationKey),this.scene.persistence.save()),n.stopConversation(),this.interacting=!1}t.getComponent(It).indicator.hide()}}]),t}(wt),Lt=function(){function e(t,n){h()(this,e),this.isTextboxShowing=void 0,this.signs=void 0,this.textboxSprite=void 0,this.textboxShowTween=void 0,this.textboxHideTween=void 0,this.signs=t.cache.json.get("signs"),this.isTextboxShowing=!1;var i=t.cameras.main.width/2;this.textboxSprite=t.add.ninePatch(i,-100,400,100,"textbox",null,{top:10,bottom:10,left:10,right:10}),this.textboxSprite.setDepth(C.depthFor("notifications")).setScrollFactor(0);var o=t.add.bitmapText(0,0,"compass-24",this.signs[n.signId].message);o.setOrigin(.5),this.textboxSprite.add(o),this.textboxShowTween=t.tweens.add({targets:this.textboxSprite,y:75,duration:300,ease:Phaser.Math.Easing.Quadratic.Out}).pause(),this.textboxHideTween=t.tweens.add({targets:[this.textboxSprite],y:-100,duration:300,ease:Phaser.Math.Easing.Quadratic.In}).pause()}return l()(e,[{key:"showTextbox",value:function(){this.isTextboxShowing=!0,this.textboxHideTween.pause(),this.textboxShowTween.restart()}},{key:"hideTextbox",value:function(){this.isTextboxShowing=!1,this.textboxShowTween.pause(),this.textboxHideTween.restart()}},{key:"destroy",value:function(){this.textboxShowTween.remove(),this.textboxHideTween.remove(),this.textboxSprite.destroy(),delete this.textboxShowTween,delete this.textboxHideTween,delete this.textboxSprite}}]),e}(),Nt=function(e){function t(e){return h()(this,t),p()(this,v()(t).call(this,e,Ye,"sign"))}return m()(t,e),l()(t,[{key:"onEnter",value:function(e,t){t.getComponent(It).indicator.show()}},{key:"onInteraction",value:function(e,t){t.getComponent(Lt).isTextboxShowing?t.getComponent(Lt).hideTextbox():t.getComponent(Lt).showTextbox()}},{key:"onExit",value:function(e,t){t.getComponent(It).indicator.hide(),t.getComponent(Lt).isTextboxShowing&&t.getComponent(Lt).hideTextbox()}}]),t}(wt),Bt=1,Rt=500,Ht=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{entityFetcher:function(e){return e.getEntities(Ye).filter(function(e){return!e.getComponent(de).isInvulnerable})},boxType:"hurtbox"},{entityFetcher:function(e){return e.getEntities(mt)},boxType:"hurtbox"},function(e,t){e.getComponent(de).makeInvulnerableFor(Rt),e.getComponent(Ye).decreaseHealth(Bt)}))}return m()(t,e),t}(yt),Gt=function(){function e(){h()(this,e)}return l()(e,[{key:"update",value:function(e){var t=e.getEntities(De),n=!0,i=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value,c=!0,h=!1,u=void 0;try{for(var l,d=a.getComponent(De).attachments[Symbol.iterator]();!(c=(l=d.next()).done);c=!0){l.value.syncToSprite(a.getComponent(b).sprite)}}catch(e){h=!0,u=e}finally{try{c||null==d.return||d.return()}finally{if(h)throw u}}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}}]),e}(),Kt=function(){function e(t,n){h()(this,e),this.boundsFrames=void 0,this.boundsFrames=t.cache.json.get(n.boundsKey)}return l()(e,[{key:"destroy",value:function(){delete this.boundsFrames}}]),e}(),_t=function(){function e(){h()(this,e)}return l()(e,[{key:"update",value:function(e){e.getEntities(Kt).forEach(function(e){var t=e.getComponent(b).sprite.frame.texture.key,n=e.getComponent(b).sprite.frame.name,i=e.getComponent(Kt).boundsFrames.find(function(e){return e.key===t&&e.frame===n});if(i){var o=i.bounds,r={x:o.offset.x,y:o.offset.y};e.getComponent(b).sprite.flipX&&(r.x=e.getComponent(b).sprite.width-o.offset.x-o.size.width),e.getComponent(b).sprite.flipY&&(r.y=e.getComponent(b).sprite.height-o.offset.y-o.size.height);var s={x:e.getComponent(b).sprite.displayWidth*e.getComponent(b).sprite.originX/e.getComponent(b).sprite.scale,y:e.getComponent(b).sprite.displayHeight*e.getComponent(b).sprite.originY/e.getComponent(b).sprite.scale};Phaser.Math.RotateAround(r,s.x,s.y,e.getComponent(b).sprite.rotation),e.getComponent(te).body.setSize(o.size.width,o.size.height),e.getComponent(te).body.setOffset(r.x,r.y)}else e.getComponent(te).body.setSize(e.getComponent(b).sprite.width,e.getComponent(b).sprite.height),e.getComponent(te).body.setOffset(0,0);e.getComponent(te).body.updateBounds()})}}]),e}(),zt=function(){function e(){h()(this,e)}return l()(e,[{key:"update",value:function(e){e.getEntities(Le).filter(function(e){return e.getComponent(Le).enabled}).forEach(function(e){var t=e.getComponent(b).sprite.frame.texture.key,n=e.getComponent(b).sprite.frame.name,i=e.getComponent(Le).hitboxFrames.find(function(e){return e.key===t&&e.frame===n});if(i&&i.hitboxes)for(var o=e.getComponent(De).getAttachmentsByType("hitbox"),r=0;r<o.length;r++){var s=i.hitboxes[r],a=o[r];s?(a.enable(),a.setConfig({shape:"rectangle",offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):a.disable()}})}}]),e}(),Xt=function(){function e(){h()(this,e)}return l()(e,[{key:"update",value:function(e){e.getEntities(He).filter(function(e){return e.getComponent(He).enabled}).forEach(function(e){var t=e.getComponent(b).sprite.frame.texture.key,n=e.getComponent(b).sprite.frame.name,i=e.getComponent(He).hurtboxFrames.find(function(e){return e.key===t&&e.frame===n});if(i&&i.hurtboxes)for(var o=e.getComponent(De).getAttachmentsByType("hurtbox"),r=0;r<o.length;r++){var s=i.hurtboxes[r],a=o[r];s?(a.enable(),a.setConfig({shape:"rectangle",offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):a.disable()}})}}]),e}(),Vt=function(){function e(){h()(this,e)}return l()(e,[{key:"update",value:function(e){e.getEntities(ft).forEach(function(e){e.getComponent(ft).phiniteStateMachine.update()})}}]),e}(),Yt=function(){function e(){h()(this,e)}return l()(e,[{key:"update",value:function(e){var t=e.getEntities(Ve),n=!0,i=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value,c=this.getIntersectingInteractionIds(a,t);a.getComponent(Ve).interactionTracker.update(c)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}},{key:"getIntersectingInteractionIds",value:function(e,t){return t.filter(function(t){return t.id!==e.id}).filter(function(t){var n=e.getComponent(De).getAttachmentsByType("interaction")[0],i=t.getComponent(De).getAttachmentsByType("interaction")[0];return n.overlaps(i)}).map(function(e){return e.id})}}]),e}(),Wt={components:[{component:b,data:{texture:"adventurer-core",frame:0}},{component:te,data:{maxVelocityX:350,collideWorldBounds:!0}},Ye,{component:De,data:{attachmentDebug:!1}},{component:He,data:{hurtboxesKey:"adventurer-hurtboxes",debug:!1}},{component:Kt,data:{boundsKey:"adventurer-bounds"}},{component:Ve,data:{interactionRadius:30,debug:!1}},{component:ft,data:{stateSet:"adventurer",initialStateId:"adventurer-stand"}},{component:ae},de,ue]},Ut={components:[{component:b,data:{texture:"arrow",frame:0}},te,{component:De,data:{attachmentDebug:!1}},{component:Le,data:{hitboxesKey:"arrow-hitboxes",debug:!1}},{component:ft,data:{stateSet:"arrow",initialStateId:"arrow-disabled"}},{component:Kt,data:{boundsKey:"arrow-bounds"}}]},Jt={components:[De,{component:b,data:{texture:"barrel",frame:0}},{component:He,data:{hurtboxesKey:"barrel-hurtboxes",debug:!1}},{component:ft,data:{stateSet:"barrel",initialStateId:"barrel-idle"}}]},Zt={components:[{component:b,data:{texture:"doors",frame:1}},Ot,It,{component:De,data:{attachmentDebug:!1}},{component:Ve,data:{interactionRadius:40,debug:!1}}]},qt=function(){function e(t,n){h()(this,e),this.name=void 0,this.name=n.name}return l()(e,[{key:"destroy",value:function(){delete this.name}}]),e}(),Qt={components:[{component:b,data:{texture:"enemy",frame:0}},te,{component:De,data:{attachmentDebug:!1}},{component:ft,data:{stateSet:"enemy",initialStateId:"enemy-idle"}},{component:He,data:{hurtboxesKey:"enemy-hurtboxes",debug:!1}},{component:Le,data:{hitboxesKey:"enemy-hitboxes",debug:!1}},{component:vt,data:{maxHealth:2}},{component:Ve,data:{interactionRadius:220,debug:!1}},mt,nt,ue,qt]},$t={components:[{component:b,data:{texture:"knight",frame:0}},te,{component:Kt,data:{boundsKey:"knight-bounds"}},{component:Dt,data:{conversationKey:"knight"}},qt,De,It,{component:Ve,data:{interactionRadius:50,debug:!1}}]},en={components:[b,ft,{component:De,data:{attachmentDebug:!1}},{component:Ve,data:{interactionRadius:70,debug:!1}},It,Dt,function(){function e(t,n){h()(this,e),this.npcId=void 0,this.npcId=n.npcId}return l()(e,[{key:"destroy",value:function(){delete this.npcId}}]),e}()]},tn=function(){function e(t,n,i){h()(this,e),this.scene=void 0,this.text=void 0,this.targetSprite=void 0,this.scene=t,this.targetSprite=i.getComponent(b).sprite,this.text=t.add.dynamicBitmapText(0,0,"compass-24",""),this.text.setOrigin(.5,.5),this.text.setDepth(C.depthFor("notifications")),this.hide()}return l()(e,[{key:"say",value:function(e,t,n){var i=this,o=this.targetSprite.getTopCenter();this.text.setText(e),this.text.setPosition(o.x,o.y-40),this.scene.time.delayedCall(t,function(){i.text.setVisible(!1),n()}),this.show()}},{key:"shout",value:function(e,t,n){var i=this;this.text.setDisplayCallback(function(e){return e.x=Phaser.Math.Between(e.x-0,e.x+0),e.y=Phaser.Math.Between(e.y-1,e.y+1),e}),this.say(e,t,function(){i.text.setDisplayCallback(function(){}),n()})}},{key:"destroy",value:function(){this.text.destroy(),delete this.scene,delete this.text,delete this.targetSprite}},{key:"hide",value:function(){this.text.setActive(!1),this.text.setVisible(!1)}},{key:"show",value:function(){this.text.setActive(!0),this.text.setVisible(!0)}}]),e}(),nn={components:[{component:b,data:{texture:"sheep-walk",frame:0}},te,{component:ft,data:{stateSet:"sheep",initialStateId:"sheep-idle"}},{component:nt,data:{zoneBoundaryName:"sheepBounds"}},{component:De,data:{attachmentDebug:!0}},{component:Ve,data:{debug:!1,shapeConfig:{shape:"rectangle",width:40,height:100,offsetY:-30}}},tn]},on={components:[{component:b,data:{texture:"core-tileset-spritesheet",frame:1128}},{component:De,data:{attachmentDebug:!1}},{component:Ve,data:{interactionRadius:30,debug:!1}},It,Lt]},rn=n(30),sn=n.n(rn),an=n(43),cn=n.n(an),hn=function(){function e(t){h()(this,e),this.scriptActions=void 0,this.scriptActions=t}return l()(e,[{key:"run",value:function(){var e=cn()(sn.a.mark(function e(){var t,n,i,o,r,s;return sn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,i=void 0,e.prev=3,o=this.scriptActions[Symbol.iterator]();case 5:if(t=(r=o.next()).done){e.next=12;break}return s=r.value,e.next=9,s.run();case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,i=e.t0;case 18:e.prev=18,e.prev=19,t||null==o.return||o.return();case 21:if(e.prev=21,!n){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:return e.abrupt("return",Promise.resolve());case 27:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}));return function(){return e.apply(this,arguments)}}()}]),e}(),un=function(){function e(t){return h()(this,e),this.prologue=void 0,this.epilogue=void 0,this.script=void 0,this.script=t,this.prologue=function(){},this.epilogue=function(){},this}return l()(e,[{key:"setPrologue",value:function(e){return this.prologue=e,this}},{key:"setEpilogue",value:function(e){return this.epilogue=e,this}},{key:"run",value:function(){var e=cn()(sn.a.mark(function e(){return sn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.prologue();case 2:return e.next=4,this.script.run();case 4:return e.next=6,this.epilogue();case 6:return e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),ln=function(){function e(t){h()(this,e),this.runFn=void 0,this.runFn=t}return l()(e,[{key:"run",value:function(){var e=cn()(sn.a.mark(function e(){return sn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runFn());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),dn=function(){function e(t,n){h()(this,e),this.scene=void 0,this.adventurer=void 0,this.scene=t,this.adventurer=n}return l()(e,[{key:"disablePhSM",value:function(){var e=this;return new ln(function(){return e.adventurer.getComponent(ft).phiniteStateMachine.disable(),Promise.resolve()})}},{key:"enablePhSM",value:function(){var e=this;return new ln(function(){return e.adventurer.getComponent(ft).phiniteStateMachine.enable(),Promise.resolve()})}},{key:"faceRight",value:function(){var e=this;return new ln(function(){return e.adventurer.getComponent(b).sprite.flipX=!1,Promise.resolve()})}},{key:"walk",value:function(e){var t=this;return new ln(function(){return new Promise(function(n){var i=t.adventurer.getComponent(b).sprite;i.flipX=e<0,i.anims.play("adventurer-run"),t.scene.tweens.add({targets:i,props:{x:i.x+e},duration:500,onComplete:function(){i.anims.play("adventurer-stand"),n()}})})})}}]),e}(),pn=function(){function e(t,n){h()(this,e),this.scene=void 0,this.sheep=void 0,this.scene=t,this.sheep=n}return l()(e,[{key:"disablePhSM",value:function(){var e=this;return new ln(function(){return e.sheep.getComponent(ft).phiniteStateMachine.disable(),Promise.resolve()})}},{key:"enablePhSM",value:function(){var e=this;return new ln(function(){return e.sheep.getComponent(ft).phiniteStateMachine.enable(),Promise.resolve()})}},{key:"faceLeft",value:function(){var e=this;return new ln(function(){return e.sheep.getComponent(b).sprite.flipX=!0,Promise.resolve()})}},{key:"shout",value:function(e){var t=this;return new ln(function(){return new Promise(function(n){t.sheep.getComponent(tn).shout(e,900,n)})})}}]),e}();function fn(e){e.phecs.phEntities.getEntities(ft).forEach(function(e){e.getComponent(ft).phiniteStateMachine.disable()})}function vn(e){e.phecs.phEntities.getEntities(ft).forEach(function(e){e.getComponent(ft).phiniteStateMachine.enable()})}var yn,mn,gn=function(e){function t(e){return h()(this,t),p()(this,v()(t).call(this,e,Ye,"sheep"))}return m()(t,e),l()(t,[{key:"onEnter",value:function(e,t){var n=this,i=new dn(this.scene,e),o=new pn(this.scene,t),r=new hn([o.faceLeft(),o.shout("BAAAAH!"),i.walk(-100)]);new un(r).setPrologue(cn()(sn.a.mark(function e(){var i;return sn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=t.getComponent(b).sprite,n.scene.cameras.main.stopFollow(),n.scene.cameras.main.zoomTo(2,200),n.scene.cameras.main.pan(i.x,i.y,200),fn(n.scene);case 5:case"end":return e.stop()}},e)}))).setEpilogue(cn()(sn.a.mark(function t(){var i;return sn.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=e.getComponent(b).sprite,n.scene.cameras.main.pan(i.x,i.y,300),n.scene.cameras.main.zoomTo(1,300),n.scene.cameras.main.startFollow(i),vn(n.scene);case 5:case"end":return t.stop()}},t)}))).run()}}]),t}(wt),bn=function(){function e(t,n){h()(this,e),this.scene=void 0,this.enemy=void 0,this.scene=t,this.enemy=n}return l()(e,[{key:"disablePhSM",value:function(){var e=this;return new ln(function(){return e.enemy.getComponent(ft).phiniteStateMachine.disable(),Promise.resolve()})}},{key:"enablePhSM",value:function(){var e=this;return new ln(function(){return e.enemy.getComponent(ft).phiniteStateMachine.enable(),Promise.resolve()})}},{key:"faceLeft",value:function(){var e=this;return new ln(function(){return e.enemy.getComponent(b).sprite.flipX=!0,Promise.resolve()})}},{key:"die",value:function(){var e=this;return new ln(function(){return e.enemy.getComponent(ft).phiniteStateMachine.doTransition({to:"enemy-dead"}),Promise.resolve()})}}]),e}(),Cn=function(){function e(t,n){h()(this,e),this.scene=void 0,this.knight=void 0,this.scene=t,this.knight=n}return l()(e,[{key:"walkTo",value:function(e,t){var n=this;return new ln(function(){return new Promise(function(i){var o=n.knight.getComponent(b).sprite;o.flipX=e>o.x,o.anims.play("knight-run"),n.scene.tweens.add({targets:o,props:{x:e},duration:t,onComplete:function(){o.anims.play("knight-ready"),i()}})})})}},{key:"swing",value:function(){var e=this;return new ln(function(){return new Promise(function(t){var n=e.knight.getComponent(b).sprite;n.anims.play("knight-attack"),n.on(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,t)})})}},{key:"idle",value:function(){var e=this;return new ln(function(){return e.knight.getComponent(b).sprite.anims.play("knight-idle"),Promise.resolve()})}}]),e}(),kn=75,xn=400;function wn(e){return new Promise(function(t){yn=e.add.rectangle(0,-kn,e.cameras.main.width,kn,0,1).setDepth(C.depthFor("notifications")).setOrigin(0,0).setScrollFactor(0),mn=e.add.rectangle(0,e.cameras.main.height,e.cameras.main.width,kn,0,1).setDepth(C.depthFor("notifications")).setOrigin(0,0).setScrollFactor(0),e.tweens.timeline({duration:xn,onComplete:t,tweens:[{offset:0,targets:e.cameras.main,props:{zoom:1.2}},{offset:0,targets:yn,props:{y:"+=".concat(kn)}},{offset:0,targets:mn,props:{y:"-=".concat(kn)}}]})})}function Pn(e){return new Promise(function(t){e.tweens.timeline({duration:xn,onComplete:function(){yn.destroy(),mn.destroy(),t()},tweens:[{offset:0,targets:e.cameras.main,props:{zoom:1}},{offset:0,targets:yn,props:{y:"-=".concat(kn)}},{offset:0,targets:mn,props:{y:"+=".concat(kn)}}]})})}function En(e,t){return new Promise(function(n){e.cameras.main.stopFollow(),e.cameras.main.pan(t.x,t.y,400,Phaser.Math.Easing.Quadratic.InOut,!1,function(e,i){1===i&&(e.startFollow(t),n())})})}var Sn=function(){function e(t){h()(this,e),this.scene=void 0,this.isPlaying=void 0,this.scene=t,this.isPlaying=!1}return l()(e,[{key:"update",value:function(e){if(!this.isPlaying){var t=e.getEntities("adventurer")[0].getComponent(b).sprite;Object.values(this.scene.areaManager.zones).filter(function(e){return e.data.cutsceneTrigger}).find(function(e){return e.shape.contains(t.x,t.y)})&&(this.isPlaying=!0,this.playCutscene(e))}}},{key:"playCutscene",value:function(e){var t=this,n=e.getEntities("adventurer")[0],i=e.getEntities("enemy").find(function(e){return"enemyActor1"===e.getComponent(qt).name}),o=e.getEntities("enemy").find(function(e){return"enemyActor2"===e.getComponent(qt).name}),r=e.getEntities("knight").find(function(e){return"knightActor"===e.getComponent(qt).name});if(!(n&&i&&o&&r))throw new Error("KnightForestCutsceneSystem::ACTOR_NOT_FOUND");var s=new bn(this.scene,i),a=new bn(this.scene,o),c=new Cn(this.scene,r),h=new hn([c.walkTo(3710,600),c.swing(),s.die(),c.walkTo(3870,1200),c.swing(),a.die(),c.walkTo(3800,600),c.idle()]);new un(h).setPrologue(cn()(sn.a.mark(function e(){return sn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return fn(t.scene),n=t.scene,i=r.getComponent(b).sprite,En(n,i),e.next=4,wn(t.scene);case 4:case"end":return e.stop()}var n,i},e)}))).setEpilogue(cn()(sn.a.mark(function e(){return sn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.scene,o=n.getComponent(b).sprite,En(i,o),e.next=3,Pn(t.scene);case 3:vn(t.scene);case 4:case"end":return e.stop()}var i,o},e)}))).run()}}]),e}(),Tn={"woollards-farm":[{progressionRestriction:{type:"conversation",name:"oldMan",index:0},system:gn}],"woollards-house":[],forest:[{progressionRestriction:{type:"conversation",name:"knight",index:0},system:function(e){function t(e){var n;return h()(this,t),(n=p()(this,v()(t).call(this,e,Ye,"knight"))).interacting=void 0,n.interacting=!1,n}return m()(t,e),l()(t,[{key:"onEnter",value:function(e,t){t.getComponent(It).indicator.show()}},{key:"onInteraction",value:function(e,t){var n=t.getComponent(Dt);if(this.interacting)if(this.interacting&&n.hasMoreConversation())n.continueConversation();else{this.interacting=!1,n.stopConversation(),this.scene.persistence.progression.conversations.markCurrentConversationComplete(n.conversationKey),this.scene.persistence.save();var i=this.scene.phecs.phEntities.getEntities("knight").find(function(e){return"knightActor"===e.getComponent(qt).name});if(!i)throw new Error("KnightForestCutsceneSystem::ACTOR_NOT_FOUND");i.getComponent(It).indicator.hide();var o=new Cn(this.scene,i),r=new hn([o.walkTo(4100,1100)]);new un(r).run()}else this.interacting=!0,t.getComponent(It).indicator.hide(),n.startConversation()}},{key:"onExit",value:function(e,t){if(this.interacting){var n=t.getComponent(Dt);n.hasMoreConversation()||(this.scene.persistence.progression.conversations.markCurrentConversationComplete(n.conversationKey),this.scene.persistence.save()),n.stopConversation(),this.interacting=!1}t.getComponent(It).indicator.hide()}}]),t}(wt)},{progressionRestriction:{type:"conversation",name:"knight",index:0},system:Sn}],town:[]},An=function(e){return Tn[e].map(function(e){return e.system})},Mn=function(e,t){return Tn[e].filter(function(e){return!t.areCompleted([e.progressionRestriction])}).map(function(e){return e.system})},In=[Gt,_t,zt,Xt,Vt,Yt,Q,bt,Ct,xt,jt,Ft,Nt,Ht],On=function(e){function t(){var e;return h()(this,t),(e=p()(this,v()(t).call(this,{key:kt.exploration}))).isLoadingArea=void 0,e.backgroundMusic=void 0,e.isLoadingArea=!1,e}return m()(t,e),l()(t,[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(e){this.phecs.phSystems.registerSystems(In),this.registerPrefabs(),this.transferToArea(e.areaKey,e.markerName),this.scene.launch(kt.hud)}},{key:"registerPrefabs",value:function(){this.phecs.phEntities.registerPrefab("adventurer",Wt),this.phecs.phEntities.registerPrefab("arrow",Ut),this.phecs.phEntities.registerPrefab("barrel",Jt),this.phecs.phEntities.registerPrefab("door",Zt),this.phecs.phEntities.registerPrefab("enemy",Qt),this.phecs.phEntities.registerPrefab("knight",$t),this.phecs.phEntities.registerPrefab("npc",en),this.phecs.phEntities.registerPrefab("sheep",nn),this.phecs.phEntities.registerPrefab("sign",on)}},{key:"transferToArea",value:function(e,t){this.isLoadingArea||(this.isLoadingArea=!0,this.cameras.main.fadeOut(0),this.loadNewArea(e,t))}},{key:"loadNewArea",value:function(e,t){var n=this;return new Promise(function(i,o){n.time.delayedCall(0,function(){n.cameras.main.fadeOut(300,0,0,0,function(o,r){if(1===r){n.controls.stop(),n.phecs.reset(),n.areaManager.currentAreaKey&&n.phecs.phSystems.removeSystems(An(n.areaManager.currentAreaKey)),n.areaManager.unload(),n.areaManager.load(e),n.phecs.phSystems.registerSystems(Mn(e,n.persistence.progression));var s=n.areaManager.map,c=n.areaManager.tileset,h=n.phecs.phEntities.createPrefab("adventurer",{},C.depthFor("adventurer")),u=g(s.properties);t?n.areaManager.placeEntityAtMarker(h,t):u.startingMarker&&n.areaManager.placeEntityAtMarker(h,u.startingMarker);var l=n.areaManager.getCollisionMap();Object.entries(l).forEach(function(e){var t=a()(e,2),i=t[0];t[1].forEach(function(e){var t=n.phecs.phEntities.getEntities(i),o=n.areaManager.getTileLayer(e);if(null==o)throw new Error("Layer does not exist for collision map: ".concat(e));var r=!0,s=!1,a=void 0;try{for(var c,h=t[Symbol.iterator]();!(r=(c=h.next()).done);r=!0){var u=c.value.getComponent(b).sprite;n.physics.add.collider(u,o)}}catch(e){s=!0,a=e}finally{try{r||null==h.return||h.return()}finally{if(s)throw a}}})}),n.controls.start(),n.phecs.start(),n.physics.world.setBounds(0,0,s.width*c.tileWidth,s.height*c.tileHeight),n.persistence.location.areaKey=e,t&&(n.persistence.location.markerName=t),n.persistence.save();var d=n.calculateCameraBounds(s,c),p=d.x,f=d.y,v=d.width,y=d.height;n.cameras.main.setBounds(p,f,v,y),n.cameras.main.startFollow(h.getComponent(b).sprite,!0),n.cameras.main.fadeIn(300),n.sfx.playMusicForArea(e),n.isLoadingArea=!1,i()}})})})}},{key:"shutdown",value:function(){this.backgroundMusic&&(this.backgroundMusic.stop(),this.backgroundMusic.destroy()),this.phecs.shutdown(),this.areaManager.unload()}},{key:"calculateCameraBounds",value:function(e,t){var n=0,i=0,o=e.width*t.tileWidth,r=e.height*t.tileHeight;return o<800&&(n-=(800-o)/2),r<450&&(i-=(450-r)/2),{x:n,y:i,width:o,height:r}}}]),t}(q),jn=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{key:kt.death}))}return m()(t,e),l()(t,[{key:"create",value:function(){var e=this;this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY-24,"compass-72","You died").setOrigin(.5),this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY+32,"compass-24","Try again?").setOrigin(.5),this.input.keyboard.once(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,function(){e.cameras.main.fadeOut(1e3,0,0,0,function(t,n){1===n&&(e.scene.stop(kt.exploration),e.scene.stop(kt.hud),e.scene.stop(kt.death),e.scene.start(kt.continueGame))})})}}]),t}(q),Dn={components:[{component:b,data:{texture:"adventurer-core",frame:0}},{component:Kt,data:{boundsKey:"adventurer-bounds"}},te]},Fn=function(e){function t(){var e;return h()(this,t),(e=p()(this,v()(t).call(this,{key:kt.prefabTest}))).knight=void 0,e}return m()(t,e),l()(t,[{key:"create",value:function(){this.phecs.phEntities.registerPrefab("adventurer",Dn),this.phecs.phSystems.registerSystems([_t]);this.add.text(300,50,"Frame ".concat(21));var e=this.phecs.phEntities.createPrefab("adventurer",{},1,150,200);e.getComponent(b).sprite.setScale(4),e.getComponent(b).sprite.setFrame(21),e.getComponent(te).body.allowGravity=!1,this.phecs.start(),this.cameras.main.setBackgroundColor("#777777")}}]),t}(q),Ln=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{key:kt.preload}))}return m()(t,e),l()(t,[{key:"preload",value:function(){this.load.audio("farm",["assets/music/farm.ogg","assets/music/farm.mp3"]),this.load.audio("forest",["assets/music/forest.ogg","assets/music/forest.mp3"]),this.load.image("title-screen","assets/backgrounds/title-screen.png"),this.load.image("vignette-effect","assets/backgrounds/vignette-effect.png"),this.load.image("green-hills-1","assets/backgrounds/green-hills/1.png"),this.load.image("green-hills-2","assets/backgrounds/green-hills/2.png"),this.load.image("green-hills-3","assets/backgrounds/green-hills/3.png"),this.load.image("green-hills-4","assets/backgrounds/green-hills/4.png"),this.load.bitmapFont("compass-72","assets/fonts/compass-72.png","assets/fonts/compass-72.xml"),this.load.bitmapFont("compass-72-title","assets/fonts/compass-72-title.png","assets/fonts/compass-72-title.xml"),this.load.bitmapFont("compass-24","assets/fonts/compass-24.png","assets/fonts/compass-24.xml"),this.load.bitmapFont("compass-24-conversation","assets/fonts/compass-24-conversation.png","assets/fonts/compass-24-conversation.xml"),this.load.bitmapFont("compass-18","assets/fonts/compass-18.png","assets/fonts/compass-18.xml"),this.load.spritesheet("old-lady","assets/sprites/npcs/old-lady.png",{frameWidth:41,frameHeight:66}),this.load.animation("old-lady-animations","assets/animations/old-lady.json"),this.load.spritesheet("old-man","assets/sprites/npcs/old-man.png",{frameWidth:47,frameHeight:66}),this.load.animation("old-man-animations","assets/animations/old-man.json"),this.load.spritesheet("adventurer-core","assets/sprites/adventurer/adventurer-core.png",{frameWidth:100,frameHeight:74}),this.load.spritesheet("adventurer-bow","assets/sprites/adventurer/adventurer-bow.png",{frameWidth:100,frameHeight:74}),this.load.animation("adventurer-animations","assets/animations/adventurer.json"),this.load.json("adventurer-hurtboxes","assets/hurtboxes/adventurer.json"),this.load.json("adventurer-bounds","assets/bounds/adventurer.json"),this.load.image("arrow","assets/sprites/projectiles/arrow.png"),this.load.json("arrow-bounds","assets/bounds/arrow.json"),this.load.json("arrow-hitboxes","assets/hitboxes/arrow.json"),this.load.spritesheet("sheep-walk","assets/sprites/sheep/sheep-walk.png",{frameWidth:40,frameHeight:34}),this.load.animation("sheep-animations","assets/animations/sheep.json"),this.load.spritesheet("enemy","assets/sprites/enemy/enemy.png",{frameWidth:32,frameHeight:32}),this.load.animation("enemy-animations","assets/animations/enemy.json"),this.load.json("enemy-hurtboxes","assets/hurtboxes/enemy.json"),this.load.json("enemy-hitboxes","assets/hitboxes/enemy.json"),this.load.spritesheet("knight","assets/sprites/knight/knight.png",{frameWidth:84,frameHeight:84}),this.load.json("knight-bounds","assets/bounds/knight.json"),this.load.animation("knight-animations","assets/animations/knight.json"),this.load.spritesheet("indicator-down","assets/sprites/indicators/indicator-down.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("indicator-right","assets/sprites/indicators/indicator-right.png",{frameWidth:32,frameHeight:32}),this.load.animation("indicator-animations","assets/animations/indicators.json"),this.load.spritesheet("doors","assets/sprites/doors/doors.png",{frameWidth:64,frameHeight:82}),this.load.spritesheet("barrel","assets/sprites/barrel/barrel.png",{frameWidth:128,frameHeight:76}),this.load.animation("barrel-animations","assets/animations/barrel.json"),this.load.json("barrel-hurtboxes","assets/hurtboxes/barrel.json"),this.load.spritesheet("core-tileset-spritesheet","assets/tilesets/core-tileset.png",{frameHeight:32,frameWidth:32}),this.load.image("core-tileset","assets/tilesets/core-tileset.png"),this.load.tilemapTiledJSON("woollards-farm","assets/tilemaps/woollards-farm.json"),this.load.tilemapTiledJSON("woollards-house","assets/tilemaps/woollards-house.json"),this.load.tilemapTiledJSON("forest","assets/tilemaps/forest.json"),this.load.tilemapTiledJSON("town","assets/tilemaps/town.json"),this.load.image("textbox","assets/sprites/conversations/textbox.png"),this.load.json("signs","assets/signs.json"),this.load.image("conversation-box","assets/sprites/conversations/conversation-box.png"),this.load.json("conversations","assets/conversations.json"),this.load.spritesheet("healthbar","assets/sprites/ui/healthbar.png",{frameWidth:124,frameHeight:22})}},{key:"create",value:function(){this.scene.start(kt.title)}}]),t}(q),Nn={5:0,4:1,3:2,2:3,1:4},Bn=function(e){function t(){var e;return h()(this,t),(e=p()(this,v()(t).call(this,{key:kt.hud}))).healthListenerCleanupFn=void 0,e}return m()(t,e),l()(t,[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(){var e=this.add.sprite(80,25,"healthbar",0);this.healthListenerCleanupFn=this.persistence.adventurer.onChange("health",function(t){e.setFrame(Nn[t])})}},{key:"shutdown",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn()}}]),t}(q),Rn=function(){function e(t,n){h()(this,e),this.bitmapText=void 0,this.bitmapText=t.add.bitmapText(n.x,n.y,n.font,n.text),n.origin&&this.bitmapText.setOrigin(n.origin)}return l()(e,[{key:"destroy",value:function(){this.bitmapText.destroy()}}]),e}(),Hn=function(){function e(t,n,i){h()(this,e),this.indicator=void 0;var o=n.indicatorSide||dt.TOP,r=i.getComponent(Rn).bitmapText;this.indicator=new Mt(t,r,o),this.indicator.hide()}return l()(e,[{key:"destroy",value:function(){this.indicator.destroy()}}]),e}(),Gn=function(){function e(t,n,i){h()(this,e),this.callback=void 0,this.disabled=void 0,this.callback=n.menuActionCallback,this.disabled=n.menuActionDisabled}return l()(e,[{key:"destroy",value:function(){delete this.callback}}]),e}(),Kn=function(){function e(t){h()(this,e),this.scene=void 0,this.selectedIndex=void 0,this.menuOptions=void 0,this.scene=t,this.selectedIndex=0,this.menuOptions=[]}return l()(e,[{key:"start",value:function(e){var t=this;this.menuOptions=e.getEntities("menuButton"),this.scene.controls.up.onPress(function(){return t.changeMenuSelector("up")}),this.scene.controls.down.onPress(function(){return t.changeMenuSelector("down")}),this.scene.controls.action.onPress(function(){return t.selectMenuOption()}),this.scene.controls.shoot.onPress(function(){return t.selectMenuOption()}),this.selectFirstEnabledIndicatorPosition()}},{key:"selectFirstEnabledIndicatorPosition",value:function(){var e=this.menuOptions.findIndex(function(e){return!e.getComponent(Gn).disabled});this.updateIndicatorPosition(e)}},{key:"changeMenuSelector",value:function(e){var t="up"===e?-1:1,n=0,i=this.selectedIndex,o=this.selectedIndex;do{if(n++,o=Phaser.Math.Wrap(this.selectedIndex+t,0,this.menuOptions.length),n===this.menuOptions.length){o=i;break}}while(this.menuOptions[o].getComponent(Gn).disabled);o!=i&&this.updateIndicatorPosition(o)}},{key:"updateIndicatorPosition",value:function(e){this.menuOptions[this.selectedIndex].getComponent(Hn).indicator.hide(),this.selectedIndex=e,this.menuOptions[this.selectedIndex].getComponent(Hn).indicator.show()}},{key:"selectMenuOption",value:function(){this.menuOptions[this.selectedIndex].getComponent(Gn).callback()}}]),e}(),_n=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{key:kt.title}))}return m()(t,e),l()(t,[{key:"init",value:function(){this.phecs.phEntities.registerPrefab("menuTitle",{components:[Rn]}),this.phecs.phEntities.registerPrefab("menuButton",{components:[Rn,Hn,Gn]}),this.phecs.phSystems.registerSystems([Kn])}},{key:"create",value:function(){this.add.image(0,0,"title-screen").setOrigin(0,0),this.add.image(0,0,"vignette-effect").setOrigin(0,0).setAlpha(.1),this.phecs.phEntities.createPrefab("menuTitle",{x:400,y:160,origin:.5,font:"compass-72-title",text:"Archer Adventure"}),this.createMenuButtons(),this.phecs.start(),this.controls.start()}},{key:"createMenuButtons",value:function(){var e=this,t=[{text:"Continue Game",menuActionDisabled:!this.persistence.hasSaveGame(),menuActionCallback:function(){e.phecs.stop(),e.scene.stop(),e.scene.start(kt.continueGame)}},{text:"New Game",menuActionCallback:function(){e.phecs.stop(),e.scene.stop(),e.scene.start(kt.newGame)}}],n=250;t.map(function(t){var i=e.phecs.phEntities.createPrefab("menuButton",{x:400,y:n,origin:.5,font:"compass-24",text:t.text,indicatorSide:dt.LEFT,menuActionDisabled:t.menuActionDisabled,menuActionCallback:t.menuActionCallback});t.menuActionDisabled&&(i.getComponent(Rn).bitmapText.alpha=.5),n+=40})}}]),t}(q),zn=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{key:kt.newGame}))}return m()(t,e),l()(t,[{key:"create",value:function(){this.persistence.resetSaveGame(),this.persistence.adventurer.maxHealth=5,this.persistence.adventurer.health=5,this.persistence.location.areaKey="woollards-farm",this.persistence.location.markerName="adventurerStart",this.persistence.save(),this.scene.start(kt.continueGame)}}]),t}(q),Xn=function(e){function t(){return h()(this,t),p()(this,v()(t).call(this,{key:kt.continueGame}))}return m()(t,e),l()(t,[{key:"create",value:function(){this.persistence.load(),this.persistence.adventurer.health=this.persistence.adventurer.maxHealth;var e={areaKey:this.persistence.location.areaKey,markerName:this.persistence.location.markerName};this.scene.start(kt.exploration,e)}}]),t}(q),Vn={width:800,height:450,plugins:{global:[{key:"NinePatchPlugin",plugin:i.NinePatchPlugin,start:!0},{key:"ParallaxSpritePlugin",plugin:H,start:!0},{key:"PersistencePlugin",plugin:X,mapping:"persistence",start:!0}],scene:[{key:"Phecs",plugin:Z,mapping:"phecs"},{key:"Sfx",plugin:B,mapping:"sfx"},{key:"Controls",plugin:F,mapping:"controls"},{key:"AreaManager",plugin:I,mapping:"areaManager"}]},scene:[Ln,_n,zn,Xn,On,Bn,jn,Fn],pixelArt:!0,physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1100}}}};new Phaser.Game(Vn)}});