!function(e){function t(t){for(var o,a,s=t[0],u=t[1],c=t[2],f=0,p=[];f<s.length;f++)a=s[f],r[a]&&p.push(r[a][0]),r[a]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);for(l&&l(t);p.length;)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,s=1;s<n.length;s++){var u=n[s];0!==r[u]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={0:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;i.push([1457,1]),n()}({1457:function(e,t,n){"use strict";n.r(t);n(28);var o=n(534),r=function(e){return Array.isArray(e)?e.reduce(function(e,t){return e[t.name]=t.value,e},{}):e||{}};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="sprite")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i;var a=n.x,s=n.y,u=n.texture,c=n.frame;this.sprite=t.add.sprite(a,s,u,c),this.sprite.y-=this.sprite.height*this.sprite.originY,n.scale&&this.sprite.setScale(n.scale),n.depth&&this.sprite.setDepth(n.depth)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.sprite.destroy(),delete this.sprite}}])&&i(t.prototype,n),o&&i(t,o),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){function t(e,n){var o,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=!(i=l(t).call(this,e,n))||"object"!==s(i)&&"function"!=typeof i?f(r):i,h(f(o),"map",void 0),h(f(o),"tileset",void 0),h(f(o),"tileLayers",void 0),h(f(o),"objects",void 0),h(f(o),"markers",void 0),h(f(o),"zones",void 0),h(f(o),"currentAreaKey",void 0),h(f(o),"areaMap",void 0),h(f(o),"backgroundSets",void 0),h(f(o),"adventurer",void 0),h(f(o),"background",void 0),o.tileLayers=[],o.objects={},o.markers={},o.zones={},o.currentAreaKey="",o.areaMap={},o.backgroundSets={},o}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,Phaser.Plugins.ScenePlugin),n=t,(o=[{key:"registerArea",value:function(e,t,n,o){this.areaMap[e]={mapKey:t,tilesetName:n,tilesetKey:o}}},{key:"registerBackgroundSet",value:function(e,t){this.backgroundSets[e]=t}},{key:"load",value:function(e){this.currentAreaKey=e;var t=this.areaMap[e],n=this.scene.make.tilemap({key:t.mapKey}),o=n.addTilesetImage(t.tilesetName,t.tilesetKey);this.map=n,this.tileset=o,this.tileLayers=[],this.objects={},this.loadMarkers(),this.loadZones(),this.createBackground(r(this.map.properties)),this.createTileLayers(this.map.layers.map(function(e){return e.name})),this.createObjectLayers(this.map.objects.map(function(e){return e.name}))}},{key:"unload",value:function(){this.currentAreaKey="",this.objects={},this.markers={},this.zones={},this.tileLayers.forEach(function(e){return e.destroy()}),this.tileLayers=[],delete this.tileset,this.map&&this.map.destroy(),this.background&&this.background.destroy()}},{key:"placeEntityAtMarker",value:function(e,t){var n=this.markers[t],o=e.getComponent(a).sprite;e.getComponent(a).sprite.setPosition(n.x,n.y-o.height*o.originY)}},{key:"getTileLayer",value:function(e){return this.tileLayers.find(function(t){return t.layer.name===e})}},{key:"getZone",value:function(e){return this.zones[e]}},{key:"getCollisionMap",value:function(){return r(this.map.properties).entityLayerCollisions.split(",").reduce(function(e,t){var n=u(t.split(":"),2),o=n[0],r=n[1];return e[o]=e[o]||[],e[o].push(r),e},{})}},{key:"loadMarkers",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){r(t.properties).marker&&(e.markers[t.name]={x:t.x,y:t.y})})})}},{key:"loadZones",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){r(t.properties).zone&&(e.zones[t.name]={x:t.x,y:t.y,width:t.width,height:t.height})})})}},{key:"createTileLayers",value:function(e){var t=this;e.forEach(function(e){return t.createTileLayer(e)})}},{key:"createTileLayer",value:function(e){var t=this.map.createStaticLayer(e,this.tileset),n=r(t.layer.properties);n.collides&&(t.forEachTile(function(e){e.setCollision(!0,!0,!0,!0,!1)},this,0,0,t.width,t.height,{isNotEmpty:!0}),t.calculateFacesWithin(0,0,t.width,t.height)),t.setDepth(n.depth),this.tileLayers.push(t)}},{key:"createObjectLayers",value:function(e){var t=this;e.forEach(function(e){return t.createObjects(e)})}},{key:"createObjects",value:function(e){var t=this,n=this.map.getObjectLayer(e),o=r(n.properties),i=n.objects;this.objects[e]=[];var a=this.scene;i.forEach(function(n){var r=null;n.type&&(r=a.phecs.phEntities.createPrefab(n.type,n.properties,o.depth,n.x,n.y)),t.objects[e].push(r)})}},{key:"createBackground",value:function(e){if(e.backgroundSet){var t=this.backgroundSets[e.backgroundSet].map(function(e){return{key:e}});this.background=this.scene.add.parallaxSprite(t),this.background.scrollWithCamera(this.scene.cameras.main)}else e.backgroundColor&&this.scene.cameras.main.setBackgroundColor("#".concat(e.backgroundColor))}}])&&c(n.prototype,o),i&&c(n,i),t}();function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,"type",void 0),v(this,"id",void 0),v(this,"components",void 0),this.type=t,this.id=this.generateUuid(),this.components=[]}var t,n,o;return t=e,(n=[{key:"getComponent",value:function(e){var t=this.components.find(function(t){return t instanceof e});if(t)return t;throw new Error("BaseEntity::NO_COMPONENT_".concat(d(e)))}},{key:"hasComponent",value:function(e){return this.components.some(function(t){return t instanceof e})}},{key:"generateUuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}])&&b(t.prototype,n),o&&b(t,o),e}();function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){C(e,t,n[t])})}return e}function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),C(this,"scene",void 0),C(this,"prefabs",void 0),C(this,"entitiesById",void 0),C(this,"entities",void 0),this.scene=t,this.prefabs={},this.entitiesById={},this.entities=[]}var t,n,o;return t=e,(n=[{key:"registerPrefab",value:function(e,t){this.prefabs[e]=t}},{key:"createPrefab",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=this.scene,s=new m(e),u=this.prefabs[e],c=g({x:o,y:i,depth:n},r(t));return this.getComponentDefinitions(u).forEach(function(e){var t=new e.component(a,g({},c,e.data),s);s.components.push(t)}),this.entitiesById[s.id]=s,this.entities.push(s),s}},{key:"getEntityById",value:function(e){return this.entitiesById[e]}},{key:"getEntities",value:function(e){if("string"==typeof e)return this.getEntitiesByType(e);if("function"==typeof e)return this.getEntitiesByComponent(e);throw new Error("Phecs.EntityManager::BAD_ENTITY_IDENTIFIER::".concat(e))}},{key:"destroy",value:function(){this.entities.forEach(function(e){e.components.forEach(function(e){return e.destroy()})}),this.entitiesById={},this.entities=[]}},{key:"getComponentDefinitions",value:function(e){return e.components.map(function(e){return"function"==typeof e?{component:e}:e})}},{key:"getEntitiesByComponent",value:function(e){return this.entities.filter(function(t){return t.hasComponent(e)})}},{key:"getEntitiesByType",value:function(e){return this.entities.filter(function(t){return t.type===e})}}])&&w(t.prototype,n),o&&w(t,o),e}();function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),O(this,"scene",void 0),O(this,"systems",void 0),this.scene=t,this.systems=[]}var t,n,o;return t=e,(n=[{key:"start",value:function(e){this.systems.forEach(function(t){t.start&&t.start(e)})}},{key:"stop",value:function(e){this.systems.forEach(function(t){t.stop&&t.stop(e)})}},{key:"update",value:function(e){this.systems.forEach(function(t){t.update&&t.update(e)})}},{key:"destroy",value:function(){this.systems.forEach(function(e){e.destroy&&e.destroy()}),this.systems=[]}},{key:"registerSystems",value:function(e){var t=this;e.forEach(function(e){t.systems.push(new e(t.scene))})}}])&&x(t.prototype,n),o&&x(t,o),e}();function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(e){function t(e,n){var o,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=!(i=j(t).call(this,e,n))||"object"!==P(i)&&"function"!=typeof i?T(r):i,I(T(o),"phEntities",void 0),I(T(o),"phSystems",void 0),o.phEntities=new k(e),o.phSystems=new E(e),o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,Phaser.Plugins.ScenePlugin),n=t,(o=[{key:"start",value:function(){this.phSystems.start(this.phEntities),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"stop",value:function(){this.phSystems.stop(this.phEntities),this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"update",value:function(){this.phSystems.update(this.phEntities)}},{key:"destroy",value:function(){this.phEntities.destroy()}},{key:"reset",value:function(){this.stop(),this.destroy()}},{key:"shutdown",value:function(){this.stop(),this.destroy(),this.phSystems.destroy()}}])&&S(n.prototype,o),r&&S(n,r),t}();function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=function(e){function t(e,n){var o,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=!(i=N(t).call(this,e,n))||"object"!==K(i)&&"function"!=typeof i?Y(r):i,L(Y(o),"states",void 0),L(Y(o),"sets",void 0),o.states={},o.sets={},o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,Phaser.Plugins.ScenePlugin),n=t,(o=[{key:"destroy",value:function(){this.states={},this.sets={}}},{key:"registerSets",value:function(e){var t=this;e.forEach(function(e){return t.addSet(e.id,e.states)})}},{key:"getState",value:function(e){return this.states[e]}},{key:"getSet",value:function(e){var t=this;return this.sets[e].map(function(e){return t.states[e]})}},{key:"addSet",value:function(e,t){var n=this;t.forEach(function(e){n.states[e.id]=e}),this.sets[e]=t.map(function(e){return e.id})}}])&&D(n.prototype,o),r&&D(n,r),t}();function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(){function e(t,n,o,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),W(this,"scene",void 0),W(this,"layers",void 0),this.scene=t,o=o||t.cameras.main.centerX,r=r||t.cameras.main.centerY,i=i||t.cameras.main.width,a=a||t.cameras.main.height;var s=n.length;this.layers=n.map(function(e,n){var u=t.add.tileSprite(o,r,i,a,e.key);return u.setScrollFactor(0),{tileSprite:u,scrollFactor:(n+1)/s*.2}})}var t,n,o;return t=e,(n=[{key:"scrollWithCamera",value:function(e){var t=this;this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,function(){return t.setOffset(e.scrollX)})}},{key:"setOffset",value:function(e){this.layers.forEach(function(t){t.tileSprite.setTilePosition(t.scrollFactor*e)})}},{key:"destroy",value:function(){this.layers.forEach(function(e){e.tileSprite.destroy()})}}])&&B(t.prototype,n),o&&B(t,o),e}();function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function X(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var G=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=X(this,U(t).call(this,e)),e.registerGameObject("parallaxSprite",n.createParallaxSprite),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(t,Phaser.Plugins.BasePlugin),n=t,(o=[{key:"createParallaxSprite",value:function(e,t,n,o,r){return new F(this.scene,e,t,n,o,r)}}])&&z(n.prototype,o),r&&z(n,r),t}();function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ee,te=function(e){function t(){var e,n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return o=this,n=!(r=(e=Z(t)).call.apply(e,[this].concat(a)))||"object"!==J(r)&&"function"!=typeof r?Q(o):r,$(Q(n),"phecs",void 0),$(Q(n),"areaManager",void 0),$(Q(n),"stateRegistrar",void 0),$(Q(n),"persistence",void 0),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(t,Phaser.Scene),t}(),ne={maxVelocity:350,horizontalAcceleration:800,horizontalDeceleration:2e3,slideVelocityThreshold:250,slideDeceleration:350,shortJumpVelocity:-350,jumpVelocity:-425,aerialMaxHorizontalVelocity:250,aerialHorizontalAcceleration:300,aerialHorizontalFrictionAcceleration:150};function oe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}!function(e){e[e.Initial=0]="Initial",e[e.Input=1]="Input",e[e.Conditional=2]="Conditional",e[e.Timer=3]="Timer"}(ee||(ee={}));var re=function(){function e(t,n,o){var r,i,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s=void 0,(i="body")in(r=this)?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s,t.physics.add.existing(o.getComponent(a).sprite);var u=o.getComponent(a).sprite;this.body=u.body,this.body.setSize(u.width,u.height),this.body.updateBounds(),n.maxVelocityX&&(this.body.maxVelocity.x=n.maxVelocityX)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.body.destroy(),delete this.body}}])&&oe(t.prototype,n),o&&oe(t,o),e}(),ie={transitions:[{type:ee.Conditional,condition:function(e){return!e.getComponent(re).body.blocked.down},to:function(e){return e.getComponent(re).body.velocity.y=100,e.getComponent(re).body.velocity.x>0?"adventurer-fall-right":e.getComponent(re).body.velocity.x<0?"adventurer-fall-left":"adventurer-fall"}}]};function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function se(e,t){var n=[e.onEnter,t.onEnter].filter(Boolean),o=[e.onUpdate,t.onUpdate].filter(Boolean),r=[e.onLeave,t.onLeave].filter(Boolean),i=[e.transitions,t.transitions].filter(Boolean).flat(),a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){ae(e,t,n[t])})}return e}({},e.data,t.data);return{id:e.id||t.id,transitions:i,data:a,onEnter:function(e,t){return n.forEach(function(n){return n(e,t)})},onUpdate:function(e,t){return o.forEach(function(n){return n(e,t)})},onLeave:function(e,t){return r.forEach(function(n){return n(e,t)})}}}var ue=se(ie,{onEnter:function(e){!function(e){e.getComponent(re).body.acceleration.x=e.getComponent(re).body.velocity.x<0?ne.horizontalDeceleration:-ne.horizontalDeceleration}(e)},onUpdate:function(e){!function(e){Phaser.Math.Within(e.getComponent(re).body.velocity.x,0,100)&&(e.getComponent(re).body.acceleration.x=0,e.getComponent(re).body.velocity.x=0)}(e)}}),ce={health:"adventurer.health"};function le(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pe=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),fe(this,"scene",void 0),fe(this,"controls",void 0),fe(this,"codes",void 0),this.scene=t,this.controls=t.input.keyboard.addKeys({up:Phaser.Input.Keyboard.KeyCodes.UP,down:Phaser.Input.Keyboard.KeyCodes.DOWN,left:Phaser.Input.Keyboard.KeyCodes.LEFT,right:Phaser.Input.Keyboard.KeyCodes.RIGHT,action:Phaser.Input.Keyboard.KeyCodes.F,attack:Phaser.Input.Keyboard.KeyCodes.SPACE}),this.codes={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",action:"f",attack:" "}}var t,n,o;return t=e,(n=[{key:"decreaseHealth",value:function(e){this.scene.persistence.update(ce.health,function(t){return t-e})}},{key:"destroy",value:function(){delete this.controls}}])&&le(t.prototype,n),o&&le(t,o),e}(),he=se(ue,{id:"adventurer-stand",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand")},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-run-right"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-run-left"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.down},to:"adventurer-crouch"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.up},to:"adventurer-jump-prep"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-stand-draw"}]});function ye(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var be=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),de(this,"scene",void 0),de(this,"entity",void 0),de(this,"states",void 0),de(this,"triggerCancelers",void 0),de(this,"currentState",void 0),this.scene=t,this.entity=n,this.states=o,this.currentState={id:"dummy",transitions:[]},this.triggerCancelers=[]}var t,n,o;return t=e,(n=[{key:"update",value:function(){this.currentState.onUpdate&&this.currentState.onUpdate(this.entity,this.currentState.data||{})}},{key:"doTransition",value:function(e){this.cancelTransitionTriggers(),this.currentState.onLeave&&this.currentState.onLeave(this.entity,this.currentState.data||{});var t="string"==typeof e.to?e.to:e.to(this.entity);this.currentState=this.states.find(function(e){return e.id===t}),e.onTransition&&e.type!==ee.Initial&&e.onTransition(this.entity),this.currentState.onEnter&&this.currentState.onEnter(this.entity,this.currentState.data||{}),this.registerTransitionTriggers()}},{key:"destroy",value:function(){this.cancelTransitionTriggers()}},{key:"cancelTransitionTriggers",value:function(){this.triggerCancelers.forEach(function(e){return e()}),this.triggerCancelers=[]}},{key:"registerTransitionTriggers",value:function(){var e=this;this.currentState.transitions.forEach(function(t){switch(t.type){case ee.Input:e.registerInputTransitionTrigger(t);break;case ee.Conditional:e.registerConditionalTransitionTrigger(t);break;case ee.Timer:e.registerTimerTransitionTrigger(t)}})}},{key:"registerInputTransitionTrigger",value:function(e){var t=this,n=function(n){var o="string"==typeof e.key?e.key:e.key(t.entity);n.key===o&&t.doTransition(e)};this.scene.input.keyboard.on(e.event,n),this.triggerCancelers.push(function(){return t.scene.input.keyboard.off(e.event,n)})}},{key:"registerConditionalTransitionTrigger",value:function(e){var t=this,n=function(){e.condition(t.entity)&&t.doTransition(e)};this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,n),this.triggerCancelers.push(function(){return t.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,n)})}},{key:"registerTimerTransitionTrigger",value:function(e){var t=this,n="number"==typeof e.delay?e.delay:e.delay(),o=this.scene.time.delayedCall(n,function(){t.doTransition(e)});this.triggerCancelers.push(function(){return o.remove()})}}])&&ye(t.prototype,n),o&&ye(t,o),e}();function ve(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var me=function(){function e(t,n,o){var r,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(i="phiniteStateMachine")in(r=this)?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a;var s=t,u=s.stateRegistrar.getSet(n.stateSet),c=s.stateRegistrar.getState(n.initialStateId);this.phiniteStateMachine=new be(t,o,u),this.phiniteStateMachine.doTransition({type:ee.Initial,to:c.id})}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.phiniteStateMachine.destroy(),delete this.phiniteStateMachine}}])&&ve(t.prototype,n),o&&ve(t,o),e}();function ge(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ce=3,ke=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),we(this,"shotPower",void 0),we(this,"shotChargeRate",void 0),we(this,"minShotPower",void 0),we(this,"maxShotPower",void 0),we(this,"arrows",void 0),we(this,"entity",void 0);var r=t;this.entity=o,this.minShotPower=300,this.maxShotPower=700,this.shotChargeRate=15,this.shotPower=this.minShotPower,this.arrows=[];for(var i=0;i<Ce;i++){var s=r.phecs.phEntities.createPrefab("arrow",{},o.getComponent(a).sprite.depth,0,0);s.getComponent(me).phiniteStateMachine.doTransition({to:"arrow-disabled"}),this.arrows.push(s)}}var t,n,o;return t=e,(n=[{key:"shootArrow",value:function(){var e=this.getAvailableArrow();e.getComponent(a).sprite.x=this.entity.getComponent(a).sprite.x,e.getComponent(a).sprite.y=this.entity.getComponent(a).sprite.y,e.getComponent(me).phiniteStateMachine.doTransition({to:"arrow-flying"});var t=Phaser.Math.Clamp(this.shotPower,this.minShotPower,this.maxShotPower);this.entity.getComponent(a).sprite.flipX&&(t*=-1),e.getComponent(re).body.setVelocity(t,0),e.getComponent(re).body.setGravityY(-500),this.shotPower=this.minShotPower}},{key:"getAvailableArrow",value:function(){var e=this.arrows.filter(function(e){return"arrow-disabled"===e.getComponent(me).phiniteStateMachine.currentState.id}),t=this.arrows.filter(function(e){return"arrow-hit"===e.getComponent(me).phiniteStateMachine.currentState.id});if(e.length)return e[0];if(t.length)return t[0];throw new Error("ShootsArrows::shootArrow::NO_AVAILABLE_ARROWS")}},{key:"destroy",value:function(){this.arrows=[]}}])&&ge(t.prototype,n),o&&ge(t,o),e}(),xe=se(ue,{id:"adventurer-stand-draw",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand-draw",!0)},onUpdate:function(e){e.getComponent(ke).shotPower+=e.getComponent(ke).shotChargeRate},transitions:[{type:ee.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:"adventurer-stand-hold"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_UP,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-stand-shoot"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]}),Oe=se(ue,{id:"adventurer-stand-hold",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand-hold",!0)},onUpdate:function(e){e.getComponent(ke).shotPower+=e.getComponent(ke).shotChargeRate},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_UP,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-stand-shoot"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]}),Ee=se(ue,{id:"adventurer-stand-shoot",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand-shoot")},onLeave:function(e){e.getComponent(ke).shootArrow()},transitions:[{type:ee.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(pe).controls;return t.right.isDown?"adventurer-run-right":t.left.isDown?"adventurer-run-left":"adventurer-stand"}}]}),Pe=se(ue,{onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-crouch")},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_UP,key:function(e){return e.getComponent(pe).codes.down},to:function(e){var t=e.getComponent(pe).controls;return t.left.isDown?"adventurer-run-left":t.right.isDown?"adventurer-run-right":"adventurer-stand"}}]}),Se=se(Pe,{id:"adventurer-crouch",transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-crouch-left"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-crouch-right"}]}),je=se(Pe,{id:"adventurer-crouch-left",onEnter:function(e){e.getComponent(a).sprite.flipX=!0},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-crouch-right"}]}),Te=se(Pe,{id:"adventurer-crouch-right",onEnter:function(e){e.getComponent(a).sprite.flipX=!1},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-crouch-left"}]}),_e=se(ie,{onEnter:function(e){e.getComponent(a).sprite.flipX=!1,e.getComponent(a).sprite.anims.play("adventurer-run")},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-stand-draw"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.down},to:function(e){return Math.abs(e.getComponent(re).body.velocity.x)<ne.slideVelocityThreshold?"adventurer-crouch":"adventurer-slide"}},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.up},to:"adventurer-jump-prep"}]});function Ie(e,t){"left"===t?e.getComponent(re).body.acceleration.x=-ne.horizontalAcceleration:"right"===t&&(e.getComponent(re).body.acceleration.x=ne.horizontalAcceleration),function(e){Phaser.Math.Within(e.getComponent(re).body.velocity.x,0,5)||(e.getComponent(re).body.velocity.x+=.5*e.getComponent(re).body.velocity.x*-1)}(e)}var Ae=se(_e,{id:"adventurer-run-right",onEnter:function(e){e.getComponent(a).sprite.flipX=!1,e.getComponent(a).sprite.anims.play("adventurer-run"),Ie(e,"right")},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_UP,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-stand"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-run-left"}]}),Ke=se(_e,{id:"adventurer-run-left",onEnter:function(e){e.getComponent(a).sprite.flipX=!0,e.getComponent(a).sprite.anims.play("adventurer-run"),Ie(e,"left")},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_UP,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-stand"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-run-right"}]}),De=se(ie,{id:"adventurer-slide",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-slide"),e.getComponent(re).body.velocity.x>0?e.getComponent(re).body.acceleration.x=-1*ne.slideDeceleration:e.getComponent(re).body.acceleration.x=ne.slideDeceleration},onUpdate:function(e){Phaser.Math.Within(e.getComponent(re).body.velocity.x,0,5)&&(e.getComponent(re).body.acceleration.x=0)},transitions:[{type:ee.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(pe).controls;return t.left.isDown?"adventurer-run-left":t.right.isDown?"adventurer-run-right":t.down.isDown?"adventurer-crouch":"adventurer-stand"}},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.up},to:"adventurer-jump-prep"}]}),Ne={id:"adventurer-jump-prep",onEnter:function(e){e.getComponent(re).body.acceleration.x=0,e.getComponent(a).sprite.anims.play("adventurer-jump-prep")},transitions:[{type:ee.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(pe).controls;return t.right.isDown?"adventurer-jump-right":t.left.isDown?"adventurer-jump-left":e.getComponent(re).body.velocity.x>0?"adventurer-jump-right":e.getComponent(re).body.velocity.x<0?"adventurer-jump-left":"adventurer-jump"},onTransition:function(e){e.getComponent(pe).controls.up.isDown?e.getComponent(re).body.velocity.y=ne.jumpVelocity:e.getComponent(re).body.velocity.y=ne.shortJumpVelocity}}]};var Ye={onUpdate:function(e,t){var n=e.getComponent(re).body,o=e.getComponent(pe).controls;o.left.isDown||o.right.isDown?function(e,t){var n=e.getComponent(re).body,o=e.getComponent(pe).controls;o.left.isDown&&n.velocity.x>t?n.acceleration.x=-1*ne.aerialHorizontalAcceleration:o.right.isDown&&n.velocity.x<t&&(n.acceleration.x=ne.aerialHorizontalAcceleration)}(e,t.targetAerialHorizontalVelocity):function(e){var t=e.getComponent(re).body;t.velocity.x>0?t.acceleration.x=-1*ne.aerialHorizontalFrictionAcceleration:t.velocity.x<0?t.acceleration.x=ne.aerialHorizontalFrictionAcceleration:t.acceleration.x=0}(e),Phaser.Math.Within(t.targetAerialHorizontalVelocity,n.velocity.x,5)&&(n.acceleration.x=0,n.velocity.x=t.targetAerialHorizontalVelocity)}},Me=se(Ye,{onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-jump-rise")},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-air-draw"}]}),Le=se(Me,{id:"adventurer-jump",data:{targetAerialHorizontalVelocity:0},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-jump-left"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-jump-right"},{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.velocity.y>1},to:"adventurer-fall"}]}),Re=se(Me,{id:"adventurer-jump-left",data:{targetAerialHorizontalVelocity:-1*ne.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(a).sprite.flipX=!0},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-jump-right"},{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.velocity.y>0},to:"adventurer-fall-left"}]}),Be=se(Me,{id:"adventurer-jump-right",data:{targetAerialHorizontalVelocity:ne.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(a).sprite.flipX=!1},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-jump-left"},{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.velocity.y>0},to:"adventurer-fall-right"}]}),We=se(Ye,{onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-fall")},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-air-draw"},{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.blocked.down},to:function(e){var t=e.getComponent(pe).controls;return t.down.isDown?Math.abs(e.getComponent(re).body.velocity.x)<ne.slideVelocityThreshold?"adventurer-crouch":"adventurer-slide":t.left.isDown?"adventurer-run-left":t.right.isDown?"adventurer-run-right":"adventurer-stand"}}]}),Fe=[he,xe,Oe,Ee,Se,je,Te,Ae,Ke,De,Ne,Le,Re,Be,se(We,{id:"adventurer-fall",data:{horizontalMaxVelocity:0},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-fall-left"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-fall-right"}]}),se(We,{id:"adventurer-fall-left",data:{targetAerialHorizontalVelocity:-1*ne.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(a).sprite.flipX=!0},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-fall-right"}]}),se(We,{id:"adventurer-fall-right",data:{targetAerialHorizontalVelocity:ne.aerialMaxHorizontalVelocity},onEnter:function(e,t){e.getComponent(a).sprite.flipX=!1},transitions:[{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-fall-left"}]}),se(Ye,{id:"adventurer-air-draw",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-air-draw",!0)},onUpdate:function(e){e.getComponent(ke).shotPower+=e.getComponent(ke).shotChargeRate},transitions:[{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.blocked.down},to:"adventurer-stand-hold"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_UP,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-air-shoot"},{type:ee.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:"adventurer-air-hold"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-air-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-air-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]}),se(Ye,{id:"adventurer-air-hold",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-air-hold",!0)},onUpdate:function(e){e.getComponent(ke).shotPower+=e.getComponent(ke).shotChargeRate},transitions:[{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.blocked.down},to:"adventurer-stand-hold"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_UP,key:function(e){return e.getComponent(pe).codes.attack},to:"adventurer-air-shoot"},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.left},to:"adventurer-air-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:ee.Input,event:Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,key:function(e){return e.getComponent(pe).codes.right},to:"adventurer-air-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]}),se(Ye,{id:"adventurer-air-shoot",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-air-shoot")},transitions:[{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.blocked.down},to:"adventurer-stand-shoot"},{type:ee.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){return e.getComponent(re).body.velocity.y<0?"adventurer-jump":"adventurer-fall"},onTransition:function(e){e.getComponent(ke).shootArrow()}}]})],He={id:"arrow-flying",transitions:[{type:ee.Conditional,condition:function(e){return!e.getComponent(re).body.blocked.none},to:"arrow-hit"}],onEnter:function(e){e.getComponent(a).sprite.active=!0,e.getComponent(a).sprite.visible=!0,e.getComponent(re).body.enable=!0,e.getComponent(re).body.allowGravity=!0,e.getComponent(re).body.setVelocity(400,0)},onUpdate:function(e){if(e.getComponent(re).body.blocked.none){var t=Math.atan2(e.getComponent(re).body.velocity.y,e.getComponent(re).body.velocity.x);e.getComponent(a).sprite.rotation=t}}},ze={id:"arrow-hit",transitions:[],onEnter:function(e){e.getComponent(re).body.setVelocity(0,0),e.getComponent(re).body.allowGravity=!1}};function Xe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ve=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ue(this,"type",void 0),Ue(this,"properties",void 0),Ue(this,"shape",void 0),Ue(this,"config",void 0),Ue(this,"enabled",void 0),Ue(this,"debugRect",void 0),this.type=t,this.config=n,this.properties=o,this.enabled=!0,this.shape=new Phaser.Geom.Rectangle(0,0,n.width,n.height),r&&i&&(this.debugRect=i.add.rectangle(this.shape.x,this.shape.y,this.shape.width,this.shape.height,255,.5),this.debugRect.fillColor=255,this.debugRect.setDepth(5))}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.shape.x=0,this.shape.y=0,this.shape.width=0,this.shape.height=0,this.debugRect&&(this.debugRect.x=this.shape.x,this.debugRect.y=this.shape.y,this.debugRect.width=this.shape.width,this.debugRect.height=this.shape.height)}},{key:"isEnabled",value:function(){return!0===this.enabled}},{key:"overlaps",value:function(e){return Phaser.Geom.Rectangle.Overlaps(this.shape,e.shape)}},{key:"setConfig",value:function(e){this.config=e}},{key:"syncToSprite",value:function(e){if(this.enabled){var t=e.scaleX,n=e.scaleY,o=(e.flipX?-1*this.config.offsetX:this.config.offsetX)*t,r=(e.flipY?-1*this.config.offsetY:this.config.offsetY)*n,i=t*this.config.width,a=n*this.config.height,s=e.getCenter(),u=new Phaser.Geom.Point(s.x+o,s.y+r);Phaser.Math.RotateAround(u,s.x,s.y,e.rotation),u.x-=i/2,u.y-=a/2,this.shape.x=u.x,this.shape.y=u.y,this.shape.width=i,this.shape.height=a}this.debugRect&&(this.debugRect.x=this.shape.x,this.debugRect.y=this.shape.y,this.debugRect.width=this.shape.width,this.debugRect.height=this.shape.height)}},{key:"destroy",value:function(){this.debugRect&&this.debugRect.destroy()}}])&&Xe(t.prototype,n),o&&Xe(t,o),e}();function Ge(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ze=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Je(this,"attachments",void 0),Je(this,"scene",void 0),Je(this,"data",void 0),this.scene=t,this.data=n,this.attachments=[]}var t,n,o;return t=e,(n=[{key:"createAttachment",value:function(e,t){var n=new Ve(e,t,{},this.data.attachmentDebug,this.scene);return this.attachments.push(n),n}},{key:"getAttachmentsByType",value:function(e){return this.attachments.filter(function(t){return t.type===e})}},{key:"destroy",value:function(){this.attachments.forEach(function(e){return e.destroy()}),delete this.attachments,delete this.getAttachmentsByType,delete this.createAttachment}}])&&Ge(t.prototype,n),o&&Ge(t,o),e}();function Qe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $e=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),qe(this,"hitboxFrames",void 0),qe(this,"enabled",void 0),qe(this,"entity",void 0),this.entity=o,this.hitboxFrames=t.cache.json.get(n.hitboxesKey).frames,this.enabled=!0;for(var r=this.hitboxFrames.map(function(e){return e.hitboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),i=0;i<r;i++)o.getComponent(Ze).createAttachment("hitbox",{offsetX:0,offsetY:0,width:0,height:0})}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(Ze).getAttachmentsByType("hitbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hitboxFrames}}])&&Qe(t.prototype,n),o&&Qe(t,o),e}(),et=[He,ze,{id:"arrow-disabled",transitions:[],onEnter:function(e){e.getComponent(a).sprite.active=!1,e.getComponent(a).sprite.visible=!1,e.getComponent(re).body.enable=!1,e.getComponent(re).body.allowGravity=!1,e.getComponent($e).disable()},onLeave:function(e){e.getComponent(a).sprite.active=!0,e.getComponent(a).sprite.visible=!0,e.getComponent(re).body.enable=!0,e.getComponent(re).body.allowGravity=!0,e.getComponent($e).enable()}}];function tt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function nt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ot(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var rt=function(){function e(){var t,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=void 0,(n="entities")in(t=this)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,this.entities={}}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=this;new Set([].concat(nt(Object.keys(this.entities)),nt(e))).forEach(function(n){var o=t.entities[n];null!=o&&"inactive"!==o||!e.includes(n)?"entering"===o?t.entities[n]="active":"active"!==o||e.includes(n)?"exiting"===o&&(t.entities[n]="inactive"):t.entities[n]="exiting":t.entities[n]="entering"})}},{key:"getEntityIds",value:function(e){return Object.entries(this.entities).filter(function(t){var n=tt(t,2);n[0];return n[1]===e}).map(function(e){return tt(e,1)[0]})}},{key:"destroy",value:function(){this.entities={}}}])&&ot(t.prototype,n),o&&ot(t,o),e}();function it(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function at(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var st=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),at(this,"interactionControl",void 0),at(this,"interactionCircle",void 0),at(this,"interactionTracker",void 0),at(this,"debugInteractionCircle",void 0),this.interactionControl=n.interactionControl;var o=new Phaser.Geom.Circle(n.x,n.y,n.interactionRadius);if(n.interactionDebug){var r=t.add.circle(n.x,n.y,n.interactionRadius,65280,.5);r.setOrigin(.5,.5),this.debugInteractionCircle=r}this.interactionTracker=new rt,this.interactionCircle=o}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.debugInteractionCircle&&this.debugInteractionCircle.destroy(),this.interactionTracker.destroy(),delete this.interactionControl,delete this.interactionCircle,delete this.interactionTracker,delete this.debugInteractionCircle}}])&&it(t.prototype,n),o&&it(t,o),e}();function ut(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ct=function(){function e(t){var n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=void 0,(o="scene")in(n=this)?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,this.scene=t}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.scene}}])&&ut(t.prototype,n),o&&ut(t,o),e}(),lt={id:"enemy-idle",onEnter:function(e){e.getComponent(re).body.velocity.x=0,e.getComponent(a).sprite.anims.play("enemy-idle")},transitions:[{type:ee.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:ee.Conditional,condition:function(e){var t=e.getComponent(st).interactionTracker.getEntityIds("active"),n=e.getComponent(ct).scene,o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;if(n.phecs.phEntities.getEntityById(u).hasComponent(pe))return!0}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return!1},to:"enemy-track-adventurer"}]};function ft(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ht=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),pt(this,"hurtboxFrames",void 0),pt(this,"enabled",void 0),pt(this,"entity",void 0),this.entity=o,this.hurtboxFrames=t.cache.json.get(n.hurtboxesKey).frames,this.enabled=!0;for(var r=this.hurtboxFrames.map(function(e){return e.hurtboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),i=0;i<r;i++)o.getComponent(Ze).createAttachment("hurtbox",{offsetX:0,offsetY:0,width:0,height:0})}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(Ze).getAttachmentsByType("hurtbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hurtboxFrames}}])&&ft(t.prototype,n),o&&ft(t,o),e}(),yt={id:"enemy-dead",onEnter:function(e){var t=e.getComponent(a).sprite;t.anims.stop(),e.getComponent(re).body.enable=!1,e.getComponent(ht).disable(),e.getComponent(ct).scene.tweens.add({targets:[t],props:{alpha:0},duration:100,yoyo:!0,repeat:1,onComplete:function(){t.active=!1,t.visible=!1}})},transitions:[]},dt={id:"enemy-stun",onEnter:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(re).body;t.anims.stop(),n.allowGravity=!1,n.velocity.x=0,n.velocity.y=0,e.getComponent(ct).scene.tweens.timeline({tweens:[{targets:t,props:{alpha:.5},duration:100,completeDelay:300},{targets:t,props:{alpha:1},duration:100}]})},onLeave:function(e){e.getComponent(re).body.allowGravity=!0},transitions:[{type:ee.Conditional,condition:function(e){var t=e.getComponent(a).sprite;return!e.getComponent(ct).scene.tweens.isTweening(t)},to:function(e){return e.getComponent(re).body.blocked.down?"enemy-idle":"enemy-fall"}}]},bt=-350,vt=60,mt=30,gt={id:"enemy-jump",onEnter:function(e){e.getComponent(a).sprite.anims.play("enemy-jump"),e.getComponent(re).body.velocity.y=bt},transitions:[{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.velocity.y<=0},to:"enemy-fall"}]},wt={id:"enemy-track-adventurer",onEnter:function(e){e.getComponent(a).sprite.anims.play("enemy-jump")},onUpdate:function(e){var t=e.getComponent(ct).scene.phecs.phEntities.getEntities(pe)[0].getComponent(a).sprite,n=e.getComponent(a).sprite,o=e.getComponent(re).body;n.x<t.x?(o.velocity.x=vt,n.flipX=!1):n.x>t.x&&(o.velocity.x=-vt,n.flipX=!0)},transitions:[{type:ee.Timer,delay:1e3,to:"enemy-jump-prep"},{type:ee.Conditional,condition:function(e){var t=e.getComponent(ct).scene,n=e.getComponent(st).interactionTracker.getEntityIds("active"),o=t.phecs.phEntities.getEntities(pe)[0].id;return!n.includes(o)},to:"enemy-idle"}]},Ct={id:"enemy-fall",onEnter:function(e){e.getComponent(a).sprite.anims.play("enemy-jump")},transitions:[{type:ee.Conditional,condition:function(e){return e.getComponent(re).body.blocked.down},to:"enemy-idle"}]};function kt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var xt=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="zone")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i;var a=t.areaManager.getZone(n.zoneBoundaryName);if(null==a)throw new Error("ZoneBoundaryComponent::ZONE_NOT_FOUND");this.zone=new Phaser.Geom.Rectangle(a.x,a.y,a.width,a.height)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.zone}}])&&kt(t.prototype,n),o&&kt(t,o),e}(),Ot={id:"enemy-wander",onEnter:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(re).body;n.velocity.x=Phaser.Math.RND.pick([-1,1])*mt,n.velocity.x<0?t.flipX=!0:t.flipX=!1},onUpdate:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(re).body,o=e.getComponent(xt).zone;Phaser.Geom.Rectangle.ContainsRect(o,t.getBounds())||(n.velocity.x*=-1)},transitions:[{type:ee.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(e){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:ee.Conditional,condition:function(e){var t=e.getComponent(st).interactionTracker.getEntityIds("active"),n=e.getComponent(ct).scene,o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;if(n.phecs.phEntities.getEntityById(u).hasComponent(pe))return!0}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return!1},to:"enemy-track-adventurer"}]},Et=[lt,dt,yt,{id:"enemy-jump-prep",onEnter:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(ct).scene;t.anims.stop(),n.tweens.timeline({tweens:[{targets:t,props:{scaleY:.8,scaleX:1.2},duration:100,completeDelay:100},{targets:t,props:{scaleY:1,scaleX:1},duration:100}]})},transitions:[{type:ee.Timer,delay:300,to:"enemy-jump"}]},gt,Ct,wt,Ot],Pt=[{id:"old-lady-idle",onEnter:function(e){e.getComponent(a).sprite.anims.play("old-lady-idle")},transitions:[]}],St=[{id:"old-man-idle",onEnter:function(e){e.getComponent(a).sprite.anims.play("old-man-idle")},transitions:[]}],jt=[{id:"sheep-walk-left",onEnter:function(e){e.getComponent(a).sprite.anims.play("sheep-walk"),e.getComponent(a).sprite.flipX=!0,e.getComponent(re).body.velocity.x=-50},transitions:[{type:ee.Conditional,condition:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(xt).zone;return t.x<n.x},to:"sheep-walk-right"}]},{id:"sheep-walk-right",onEnter:function(e){e.getComponent(a).sprite.anims.play("sheep-walk"),e.getComponent(a).sprite.flipX=!1,e.getComponent(re).body.velocity.x=50},transitions:[{type:ee.Conditional,condition:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(xt).zone;return t.x+t.width>n.x+n.width},to:"sheep-walk-left"}]}];function Tt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var It=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_t(this,"maxHealth",void 0),_t(this,"currentHealth",void 0),_t(this,"onDeathListeners",void 0),_t(this,"onDamageListeners",void 0),this.maxHealth=n.maxHealth,this.currentHealth=this.maxHealth,this.onDeathListeners=[],this.onDamageListeners=[]}var t,n,o;return t=e,(n=[{key:"decreaseHealth",value:function(e){var t=this;this.currentHealth-=e,this.currentHealth<=0?this.onDeathListeners.forEach(function(e){return e()}):this.onDamageListeners.forEach(function(e){return e(t.currentHealth)})}},{key:"onDamage",value:function(e){this.onDamageListeners.push(e)}},{key:"onDeath",value:function(e){this.onDeathListeners.push(e)}},{key:"destroy",value:function(){delete this.maxHealth,delete this.currentHealth,delete this.onDeathListeners,delete this.onDamageListeners}}])&&Tt(t.prototype,n),o&&Tt(t,o),e}();function At(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Dt=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Kt(this,"entities1Config",void 0),Kt(this,"entities2Config",void 0),Kt(this,"onHit",void 0),this.entities1Config=t,this.entities2Config=n,this.onHit=o}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=this.entities1Config.entityFetcher(e),n=this.entities2Config.entityFetcher(e),o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value,c=u.getComponent(Ze).getAttachmentsByType(this.entities1Config.boxType).filter(function(e){return e.isEnabled()}),l=!0,f=!1,p=void 0;try{for(var h,y=n[Symbol.iterator]();!(l=(h=y.next()).done);l=!0){var d=h.value,b=d.getComponent(Ze).getAttachmentsByType(this.entities2Config.boxType).filter(function(e){return e.isEnabled()});this.doBoxesOverlap(c,b)&&this.onHit(u,d)}}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"doBoxesOverlap",value:function(e,t){var n=!1,o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;if(n)break;var c=!0,l=!1,f=void 0;try{for(var p,h=t[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var y=p.value;if(n)break;n=u.overlaps(y)}}catch(e){l=!0,f=e}finally{try{c||null==h.return||h.return()}finally{if(l)throw f}}}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}}])&&At(t.prototype,n),o&&At(t,o),e}();function Nt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Yt=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=o.getComponent(It),i=o.getComponent(me).phiniteStateMachine;r.onDamage(function(){i.doTransition({to:"enemy-stun"})}),r.onDeath(function(){i.doTransition({to:"enemy-dead"})})}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){}}])&&Nt(t.prototype,n),o&&Nt(t,o),e}();function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lt(e,t){return!t||"object"!==Mt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rt(e){return(Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bt(e,t){return(Bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wt=1,Ft=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Lt(this,Rt(t).call(this,{entityFetcher:function(e){return e.getEntities("arrow").filter(function(e){return"arrow-flying"===e.getComponent(me).phiniteStateMachine.currentState.id})},boxType:"hitbox"},{entityFetcher:function(e){return e.getEntities(Yt)},boxType:"hurtbox"},function(e,t){e.getComponent(me).phiniteStateMachine.doTransition({to:"arrow-disabled"}),t.getComponent(It).decreaseHealth(Wt)}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bt(e,t)}(t,Dt),t}(),Ht={preload:"preload",title:"title",exploration:"exploration",hud:"hud",death:"death",prefabTest:"prefabTest"};function zt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ut=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Xt(this,"scene",void 0),Xt(this,"healthListenerCleanupFn",void 0),this.scene=t}var t,n,o;return t=e,(n=[{key:"start",value:function(e){var t=this;this.healthListenerCleanupFn=this.scene.persistence.onChange(ce.health,function(e){e<=0&&(t.scene.scene.stop(Ht.hud),t.scene.scene.pause(Ht.exploration),t.scene.scene.launch(Ht.death,{respawnAreaKey:t.scene.areaManager.currentAreaKey}))})}},{key:"stop",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn(),delete this.healthListenerCleanupFn}}])&&zt(t.prototype,n),o&&zt(t,o),e}();function Vt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jt,Zt,Qt,qt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Gt(this,"identifierA",void 0),Gt(this,"identifierB",void 0),Gt(this,"listeners",void 0),this.identifierA=t,this.identifierB=n,this.listeners=[]}var t,n,o;return t=e,(n=[{key:"start",value:function(e){var t=this,n=e.getEntities(this.identifierA),o=e.getEntities(this.identifierB),r=!0,i=!1,a=void 0;try{for(var s,u=function(){var e=s.value;if(!e.hasComponent(pe))return"break";var n=e.getComponent(pe).controls,r=!0,i=!1,a=void 0;try{for(var u,c=function(){var o=u.value,r=n[o.getComponent(st).interactionControl],i=function(){o.getComponent(st).interactionTracker.getEntityIds("active").includes(e.id)&&t.onInteraction&&t.onInteraction(o)};r.on(Phaser.Input.Keyboard.Events.DOWN,i),t.listeners.push({key:r,listener:i})},l=o[Symbol.iterator]();!(r=(u=l.next()).done);r=!0)c()}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}},c=n[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){if("break"===u())break}}catch(e){i=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}}},{key:"stop",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,r=this.listeners[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var i=o.value;i.key.off(Phaser.Input.Keyboard.Events.DOWN,i.listener)}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"update",value:function(e){var t=e.getEntities(this.identifierA),n=e.getEntities(this.identifierB),o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value.getComponent(st).interactionTracker,c=this.getInteractingEntityBs(u,n,"entering"),l=!0,f=!1,p=void 0;try{for(var h,y=c[Symbol.iterator]();!(l=(h=y.next()).done);l=!0){var d=h.value;this.onEnter&&this.onEnter(d)}}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}var b=this.getInteractingEntityBs(u,n,"exiting"),v=!0,m=!1,g=void 0;try{for(var w,C=b[Symbol.iterator]();!(v=(w=C.next()).done);v=!0){var k=w.value;this.onExit&&this.onExit(k)}}catch(e){m=!0,g=e}finally{try{v||null==C.return||C.return()}finally{if(m)throw g}}}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"destroy",value:function(){this.listeners=[]}},{key:"getInteractingEntityBs",value:function(e,t,n){var o=e.getEntityIds(n);return t.filter(function(e){return o.includes(e.id)})}}])&&Vt(t.prototype,n),o&&Vt(t,o),e}();function $t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function en(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.TOP="top",e.LEFT="left"}(Qt||(Qt={}));var tn=10,nn=(en(Jt={},Qt.TOP,"indicator-down"),en(Jt,Qt.LEFT,"indicator-right"),Jt),on=(en(Zt={},Qt.TOP,"indicator-down"),en(Zt,Qt.LEFT,"indicator-right"),Zt),rn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),en(this,"sprite",void 0),en(this,"side",void 0);var r=n.x,i=n.y;this.side=o,this.sprite=t.add.sprite(r,i,nn[o]),this.sprite.setDepth(n.depth),o===Qt.TOP?(this.sprite.setOrigin(.5,1),this.sprite.y=i-n.height*n.scaleY/2-tn):o===Qt.LEFT&&(this.sprite.setOrigin(1,.5),this.sprite.x=r-n.width*n.scaleX/2-tn)}var t,n,o;return t=e,(n=[{key:"show",value:function(){this.sprite.visible=!0,this.sprite.active=!0,this.sprite.anims.play(on[this.side])}},{key:"hide",value:function(){this.sprite.visible=!1,this.sprite.active=!1,this.sprite.anims.stop()}},{key:"destroy",value:function(){this.sprite.destroy()}}])&&$t(t.prototype,n),o&&$t(t,o),e}();function an(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var sn=function(){function e(t,n,o){var r,i,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s=void 0,(i="indicator")in(r=this)?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s;var u=n.indicatorSide||Qt.TOP,c=o.getComponent(a).sprite;this.indicator=new rn(t,c,u),this.indicator.hide()}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.indicator.destroy()}}])&&an(t.prototype,n),o&&an(t,o),e}();function un(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ln=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),cn(this,"toAreaKey",void 0),cn(this,"toMarker",void 0),this.toAreaKey=n.toAreaKey,this.toMarker=n.toMarker}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.toAreaKey,delete this.toMarker}}])&&un(t.prototype,n),o&&un(t,o),e}();function fn(e){return(fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function hn(e){return(hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bn=function(e){function t(e){var n,o,r,i,a,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(r=hn(t).call(this,pe,ln))||"object"!==fn(r)&&"function"!=typeof r?yn(o):r,i=yn(n),s=void 0,(a="scene")in i?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s,n.scene=e,n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(t,qt),n=t,(o=[{key:"onEnter",value:function(e){e.getComponent(sn).indicator.show()}},{key:"onInteraction",value:function(e){var t=e.getComponent(ln);this.scene.loadNewArea(t.toAreaKey,t.toMarker)}},{key:"onExit",value:function(e){e.getComponent(sn).indicator.hide()}}])&&pn(n.prototype,o),r&&pn(n,r),t}();function vn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),mn(this,"scene",void 0),mn(this,"conversation",void 0),mn(this,"entityY",void 0),mn(this,"conversationBoxSprite",void 0),mn(this,"conversationProgressIndex",void 0),this.scene=t,this.conversation=t.cache.json.get("conversations")[n.conversationKey];var r=o.getComponent(a).sprite;this.entityY=r.y,this.conversationProgressIndex=0,this.conversationBoxSprite=t.add.ninePatch(r.x,r.y,0,0,"conversation-box",null,{top:6,left:15,right:15,bottom:12}),this.stopConversation()}var t,n,o;return t=e,(n=[{key:"startConversation",value:function(){this.conversationBoxSprite.alpha=1,this.conversationProgressIndex=0,this.updateConversationText()}},{key:"continueConversation",value:function(){this.hasMoreConversation()?this.conversationProgressIndex+=1:this.stopConversation(),this.updateConversationText()}},{key:"stopConversation",value:function(){this.conversationBoxSprite.alpha=0}},{key:"hasMoreConversation",value:function(){return this.conversationProgressIndex<this.conversation.length-1}},{key:"destroy",value:function(){this.conversationBoxSprite.destroy()}},{key:"updateConversationText",value:function(){var e=this.scene.add.bitmapText(0,0,"compass-24-conversation",this.conversation[this.conversationProgressIndex]);e.setMaxWidth(300),e.setOrigin(.5);var t=e.getTextBounds().local;this.conversationBoxSprite.resize(t.width+50,t.height+50),this.conversationBoxSprite.add(e),this.conversationBoxSprite.y=this.entityY-this.conversationBoxSprite.height/2-40}}])&&vn(t.prototype,n),o&&vn(t,o),e}();function wn(e){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function kn(e){return(kn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function On(e,t){return(On=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var En=function(e){function t(e){var n,o,r,i,a,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(r=kn(t).call(this,pe,e))||"object"!==wn(r)&&"function"!=typeof r?xn(o):r,i=xn(n),s=void 0,(a="interacting")in i?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s,n.interacting=!1,n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&On(e,t)}(t,qt),n=t,(o=[{key:"onEnter",value:function(e){e.getComponent(sn).indicator.show()}},{key:"onInteraction",value:function(e){var t=e.getComponent(gn);this.interacting?this.interacting&&t.hasMoreConversation()?t.continueConversation():(this.interacting=!1,t.stopConversation()):(this.interacting=!0,e.getComponent(sn).indicator.hide(),t.startConversation())}},{key:"onExit",value:function(e){this.interacting&&(e.getComponent(gn).stopConversation(),this.interacting=!1),e.getComponent(sn).indicator.hide()}}])&&Cn(n.prototype,o),r&&Cn(n,r),t}();function Pn(e){return(Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sn(e,t){return!t||"object"!==Pn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jn(e){return(jn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tn(e,t){return(Tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Sn(this,jn(t).call(this,"old-lady"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tn(e,t)}(t,En),t}();function In(e){return(In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function An(e,t){return!t||"object"!==In(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kn(e){return(Kn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dn(e,t){return(Dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Nn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),An(this,Kn(t).call(this,"old-man"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dn(e,t)}(t,En),t}();function Yn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ln=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Mn(this,"isTextboxShowing",void 0),Mn(this,"signs",void 0),Mn(this,"textboxSprite",void 0),Mn(this,"textboxShowTween",void 0),Mn(this,"textboxHideTween",void 0),this.signs=t.cache.json.get("signs"),this.isTextboxShowing=!1;var o=t.cameras.main.width/2;this.textboxSprite=t.add.ninePatch(o,-100,400,100,"textbox",null,{top:10,bottom:10,left:10,right:10}),this.textboxSprite.setDepth(10).setScrollFactor(0);var r=t.add.bitmapText(0,0,"compass-24",this.signs[n.signId].message);r.setOrigin(.5),this.textboxSprite.add(r),this.textboxShowTween=t.tweens.add({targets:this.textboxSprite,y:75,duration:300,ease:Phaser.Math.Easing.Quadratic.Out}).pause(),this.textboxHideTween=t.tweens.add({targets:[this.textboxSprite],y:-100,duration:300,ease:Phaser.Math.Easing.Quadratic.In}).pause()}var t,n,o;return t=e,(n=[{key:"showTextbox",value:function(){this.isTextboxShowing=!0,this.textboxHideTween.pause(),this.textboxShowTween.restart()}},{key:"hideTextbox",value:function(){this.isTextboxShowing=!1,this.textboxShowTween.pause(),this.textboxHideTween.restart()}},{key:"destroy",value:function(){this.textboxShowTween.remove(),this.textboxHideTween.remove(),this.textboxSprite.destroy(),delete this.textboxShowTween,delete this.textboxHideTween,delete this.textboxSprite}}])&&Yn(t.prototype,n),o&&Yn(t,o),e}();function Rn(e){return(Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Wn(e,t){return!t||"object"!==Rn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fn(e){return(Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hn(e,t){return(Hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Wn(this,Fn(t).call(this,pe,"sign"))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hn(e,t)}(t,qt),n=t,(o=[{key:"onEnter",value:function(e){e.getComponent(sn).indicator.show()}},{key:"onInteraction",value:function(e){e.getComponent(Ln).isTextboxShowing?e.getComponent(Ln).hideTextbox():e.getComponent(Ln).showTextbox()}},{key:"onExit",value:function(e){e.getComponent(sn).indicator.hide(),e.getComponent(Ln).isTextboxShowing&&e.getComponent(Ln).hideTextbox()}}])&&Bn(n.prototype,o),r&&Bn(n,r),t}();function Xn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Vn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Un(this,"isInvulnerable",void 0),Un(this,"scene",void 0),Un(this,"sprite",void 0),this.scene=t,this.isInvulnerable=!1,this.sprite=o.getComponent(a).sprite}var t,n,o;return t=e,(n=[{key:"makeInvulnerable",value:function(){var e=this;this.isInvulnerable=!0,this.sprite.alpha=.5;var t=this.scene.time.delayedCall(500,function(){e.sprite.alpha=1,e.isInvulnerable=!1,t.destroy()})}},{key:"destroy",value:function(){delete this.isInvulnerable}}])&&Xn(t.prototype,n),o&&Xn(t,o),e}();function Gn(e){return(Gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jn(e,t){return!t||"object"!==Gn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zn(e){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qn(e,t){return(Qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qn=1,$n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Jn(this,Zn(t).call(this,{entityFetcher:function(e){return e.getEntities(pe).filter(function(e){return!e.getComponent(Vn).isInvulnerable})},boxType:"hurtbox"},{entityFetcher:function(e){return e.getEntities(Yt)},boxType:"hurtbox"},function(e,t){e.getComponent(Vn).makeInvulnerable(),e.getComponent(pe).decreaseHealth(qn)}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qn(e,t)}(t,Dt),t}();function eo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var to=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=e.getEntities(Ze),n=!0,o=!1,r=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value,c=!0,l=!1,f=void 0;try{for(var p,h=u.getComponent(Ze).attachments[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){p.value.syncToSprite(u.getComponent(a).sprite)}}catch(e){l=!0,f=e}finally{try{c||null==h.return||h.return()}finally{if(l)throw f}}}}catch(e){o=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}}}])&&eo(t.prototype,n),o&&eo(t,o),e}();function no(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var oo=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="boundsFrames")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.boundsFrames=t.cache.json.get(n.boundsKey)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.boundsFrames}}])&&no(t.prototype,n),o&&no(t,o),e}();function ro(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var io=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities(oo).forEach(function(e){var t=e.getComponent(a).sprite.frame.texture.key,n=e.getComponent(a).sprite.frame.name,o=e.getComponent(oo).boundsFrames.find(function(e){return e.key===t&&e.frame===n});if(o){var r=o.bounds,i={x:r.offset.x,y:r.offset.y};e.getComponent(a).sprite.flipX&&(i.x=e.getComponent(a).sprite.width-r.offset.x-r.size.width),e.getComponent(a).sprite.flipY&&(i.y=e.getComponent(a).sprite.height-r.offset.y-r.size.height);var s={x:e.getComponent(a).sprite.displayWidth*e.getComponent(a).sprite.originX/e.getComponent(a).sprite.scale,y:e.getComponent(a).sprite.displayHeight*e.getComponent(a).sprite.originY/e.getComponent(a).sprite.scale};Phaser.Math.RotateAround(i,s.x,s.y,e.getComponent(a).sprite.rotation),e.getComponent(re).body.setSize(r.size.width,r.size.height),e.getComponent(re).body.setOffset(i.x,i.y)}else e.getComponent(re).body.setSize(e.getComponent(a).sprite.width,e.getComponent(a).sprite.height),e.getComponent(re).body.setOffset(0,0);e.getComponent(re).body.updateBounds()})}}])&&ro(t.prototype,n),o&&ro(t,o),e}();function ao(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var so=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"stop",value:function(e){e.getEntities(pe).forEach(function(e){Object.values(e.getComponent(pe).controls).forEach(function(e){e.removeAllListeners()})})}}])&&ao(t.prototype,n),o&&ao(t,o),e}();function uo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var co=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities($e).filter(function(e){return e.getComponent($e).enabled}).forEach(function(e){var t=e.getComponent(a).sprite.frame.texture.key,n=e.getComponent(a).sprite.frame.name,o=e.getComponent($e).hitboxFrames.find(function(e){return e.key===t&&e.frame===n});if(o&&o.hitboxes)for(var r=e.getComponent(Ze).getAttachmentsByType("hitbox"),i=0;i<r.length;i++){var s=o.hitboxes[i],u=r[i];s?(u.enable(),u.setConfig({offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):u.disable()}})}}])&&uo(t.prototype,n),o&&uo(t,o),e}();function lo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var fo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities(ht).filter(function(e){return e.getComponent(ht).enabled}).forEach(function(e){var t=e.getComponent(a).sprite.frame.texture.key,n=e.getComponent(a).sprite.frame.name,o=e.getComponent(ht).hurtboxFrames.find(function(e){return e.key===t&&e.frame===n});if(o&&o.hurtboxes)for(var r=e.getComponent(Ze).getAttachmentsByType("hurtbox"),i=0;i<r.length;i++){var s=o.hurtboxes[i],u=r[i];s?(u.enable(),u.setConfig({offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):u.disable()}})}}])&&lo(t.prototype,n),o&&lo(t,o),e}();function po(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ho=function(){function e(t){var n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=void 0,(o="scene")in(n=this)?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,this.scene=t}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=e.getEntities(st),n=!0,o=!1,r=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;this.syncInteractionCircleToEntity(s),this.syncDebugCircle(s)}}catch(e){o=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}var u=!0,c=!1,l=void 0;try{for(var f,p=t[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value,y=this.getIntersectingInteractionIds(h,t);h.getComponent(st).interactionTracker.update(y)}}catch(e){c=!0,l=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw l}}}},{key:"syncInteractionCircleToEntity",value:function(e){var t=e.getComponent(a).sprite;e.getComponent(st).interactionCircle.setPosition(t.x,t.y)}},{key:"getIntersectingInteractionIds",value:function(e,t){return t.filter(function(t){return t.id!==e.id}).filter(function(t){var n=e.getComponent(st).interactionCircle,o=t.getComponent(st).interactionCircle;return Phaser.Geom.Intersects.CircleToCircle(n,o)}).map(function(e){return e.id})}},{key:"syncDebugCircle",value:function(e){var t=e.getComponent(st).debugInteractionCircle;if(t){var n=e.getComponent(a).sprite,o=this.scene.input.activePointer.positionToCamera(this.scene.cameras.main);t.setPosition(n.x,n.y),Phaser.Geom.Intersects.CircleToCircle(e.getComponent(st).interactionCircle,new Phaser.Geom.Circle(o.x,o.y,1))?t.setFillStyle(16711680,.5):t.setFillStyle(65280,.5)}}}])&&po(t.prototype,n),o&&po(t,o),e}();function yo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var bo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities(me).forEach(function(e){e.getComponent(me).phiniteStateMachine.update()})}}])&&yo(t.prototype,n),o&&yo(t,o),e}(),vo={components:[{component:a,data:{texture:"adventurer-core",frame:0}},{component:re,data:{maxVelocityX:350}},pe,{component:Ze,data:{attachmentDebug:!1}},{component:ht,data:{hurtboxesKey:"adventurer-hurtboxes"}},{component:oo,data:{boundsKey:"adventurer-bounds"}},{component:st,data:{interactionRadius:30,interactionDebug:!1}},{component:me,data:{stateSet:"adventurer",initialStateId:"adventurer-stand"}},{component:ke},Vn]},mo={components:[{component:a,data:{texture:"arrow",frame:0}},re,{component:Ze,data:{attachmentDebug:!1}},{component:$e,data:{hitboxesKey:"arrow-hitboxes"}},{component:me,data:{stateSet:"arrow",initialStateId:"arrow-disabled"}},{component:oo,data:{boundsKey:"arrow-bounds"}}]},go={components:[{component:a,data:{texture:"doors",frame:1,depth:2}},ln,sn,{component:st,data:{interactionControl:"action",interactionRadius:40}}]},wo={components:[{component:a,data:{texture:"enemy",frame:0}},re,{component:Ze,data:{attachmentDebug:!1}},{component:me,data:{stateSet:"enemy",initialStateId:"enemy-idle"}},{component:ht,data:{hurtboxesKey:"enemy-hurtboxes"}},{component:$e,data:{hitboxesKey:"enemy-hitboxes"}},{component:It,data:{maxHealth:2}},{component:st,data:{interactionRadius:220,interactionDebug:!1}},Yt,{component:xt,data:{zoneBoundaryName:"enemyBounds"}},{component:ct}]},Co={components:[{component:a,data:{texture:"old-lady"}},{component:me,data:{stateSet:"old-lady",initialStateId:"old-lady-idle"}},{component:st,data:{interactionRadius:70,interactionControl:"action",interactionDebug:!1}},sn,gn]},ko={components:[{component:a,data:{texture:"old-man"}},{component:me,data:{stateSet:"old-man",initialStateId:"old-man-idle"}},{component:st,data:{interactionRadius:50,interactionControl:"action",interactionDebug:!1}},sn,gn]},xo={components:[{component:a,data:{texture:"sheep-walk",frame:0,depth:0}},re,{component:me,data:{stateSet:"sheep",initialStateId:"sheep-walk-right"}},{component:xt,data:{zoneBoundaryName:"sheepBounds"}}]},Oo={components:[{component:a,data:{texture:"core-tileset-spritesheet",frame:1128}},{component:st,data:{interactionRadius:30,interactionControl:"action",interactionDebug:!1}},sn,Ln]};function Eo(e){return(Eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Po(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function So(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function jo(e){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function To(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _o(e,t){return(_o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Io=function(e){function t(){var e,n,o,r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=jo(t).call(this,{key:Ht.exploration}))||"object"!==Eo(o)&&"function"!=typeof o?To(n):o,r=To(e),a=void 0,(i="isLoadingArea")in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,e.isLoadingArea=!1,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_o(e,t)}(t,te),n=t,(o=[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(e){var t=this;this.registerStateSets(),this.registerAreas(),this.registerBackgroundSets(),this.registerSystems(),this.registerPrefabs(),this.loadData(),this.cameras.main.fadeOut(0),this.loadNewArea(e.areaKey).then(function(){t.cameras.main.fadeIn(1e3),t.scene.launch(Ht.hud)})}},{key:"registerStateSets",value:function(){this.stateRegistrar.registerSets([{id:"adventurer",states:Fe},{id:"arrow",states:et},{id:"enemy",states:Et},{id:"sheep",states:jt},{id:"old-lady",states:Pt},{id:"old-man",states:St}])}},{key:"registerAreas",value:function(){this.areaManager.registerArea("woollards-farm","woollards-farm","core-tileset","core-tileset"),this.areaManager.registerArea("woollards-house","woollards-house","core-tileset","core-tileset")}},{key:"registerBackgroundSets",value:function(){this.areaManager.registerBackgroundSet("green-hills",["green-hills-1","green-hills-2","green-hills-3","green-hills-4"])}},{key:"registerSystems",value:function(){this.phecs.phSystems.registerSystems([Ft,Ut,bn,_n,Nn,zn,$n,to,io,so,co,fo,ho,bo])}},{key:"registerPrefabs",value:function(){this.phecs.phEntities.registerPrefab("adventurer",vo),this.phecs.phEntities.registerPrefab("arrow",mo),this.phecs.phEntities.registerPrefab("door",go),this.phecs.phEntities.registerPrefab("enemy",wo),this.phecs.phEntities.registerPrefab("old-lady",Co),this.phecs.phEntities.registerPrefab("old-man",ko),this.phecs.phEntities.registerPrefab("sheep",xo),this.phecs.phEntities.registerPrefab("sign",Oo)}},{key:"loadData",value:function(){this.persistence.set(ce.health,5)}},{key:"loadNewArea",value:function(e,t){var n=this;return new Promise(function(o,i){n.isLoadingArea?i():(n.isLoadingArea=!0,n.time.delayedCall(0,function(){n.phecs.reset(),n.areaManager.unload(),n.areaManager.load(e);var i=n.areaManager.map,s=n.areaManager.tileset,u=n.phecs.phEntities.createPrefab("adventurer",{},2),c=r(i.properties);t?n.areaManager.placeEntityAtMarker(u,t):c.startingMarker&&n.areaManager.placeEntityAtMarker(u,c.startingMarker),c.entityLayerCollisions&&c.entityLayerCollisions.split(",").forEach(function(e){var t=Po(e.split(":"),2),o=t[0],r=t[1],i=n.phecs.phEntities.getEntities(o),s=n.areaManager.getTileLayer(r);if(null==s)throw new Error("Layer does not exist for collision pair: ".concat(e));var u=!0,c=!1,l=void 0;try{for(var f,p=i[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value.getComponent(a).sprite;n.physics.add.collider(h,s)}}catch(e){c=!0,l=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw l}}}),n.phecs.start();var l=n.calcCameraBounds(i,s),f=l.x,p=l.y,h=l.width,y=l.height;n.cameras.main.setBounds(f,p,h,y),n.cameras.main.startFollow(u.getComponent(a).sprite,!0),n.isLoadingArea=!1,o()},[],null))})}},{key:"shutdown",value:function(){this.phecs.shutdown(),this.areaManager.unload()}},{key:"calcCameraBounds",value:function(e,t){var n=0,o=0,r=e.width*t.tileWidth,i=e.height*t.tileHeight;return r<800&&(n-=(800-r)/2),i<450&&(o-=(450-i)/2),{x:n,y:o,width:r,height:i}}}])&&So(n.prototype,o),i&&So(n,i),t}();function Ao(e){return(Ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ko(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Do(e,t){return!t||"object"!==Ao(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function No(e){return(No=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yo(e,t){return(Yo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Do(this,No(t).call(this,{key:Ht.death}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yo(e,t)}(t,Phaser.Scene),n=t,(o=[{key:"create",value:function(e){var t=this;this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY-24,"compass-72","You died").setOrigin(.5),this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY+32,"compass-24","Try again?").setOrigin(.5),this.input.keyboard.once(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,function(){t.cameras.main.fadeOut(1e3,0,0,0,function(n,o){1===o&&(t.scene.stop(Ht.exploration),t.scene.stop(Ht.hud),t.scene.stop(Ht.death),t.scene.start(Ht.exploration,{areaKey:e.respawnAreaKey}))})})}}])&&Ko(n.prototype,o),r&&Ko(n,r),t}();function Lo(e){return(Lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ro(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Bo(e){return(Bo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fo(e,t){return(Fo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ho(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zo=function(e){function t(){var e,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=Bo(t).call(this,{key:Ht.prefabTest}))||"object"!==Lo(o)&&"function"!=typeof o?Wo(n):o,Ho(Wo(e),"centerDebugCircle",void 0),Ho(Wo(e),"enemy",void 0),e}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fo(e,t)}(t,te),n=t,(o=[{key:"create",value:function(){this.phecs.phEntities.registerPrefab("arrow",mo),this.phecs.phSystems.registerSystems([to,ho,io,so,fo,co]),this.stateRegistrar.registerSets([{id:"arrow",states:et}]);var e=0,t=this.add.text(200,50,"Frame ".concat(e)),n=this.phecs.phEntities.createPrefab("arrow",{},5,0,0);n.getComponent(a).sprite.x=150,n.getComponent(a).sprite.y=200,n.getComponent(a).sprite.setFrame(e),n.getComponent(re).body.allowGravity=!1,n.getComponent(a).sprite.anims.stop(),this.centerDebugCircle=this.add.circle(0,0,10,65280),this.centerDebugCircle.setDepth(100),this.input.keyboard.on("keydown",function(o){switch(o.key){case"ArrowUp":e++;break;case"ArrowDown":e--}n.getComponent(a).sprite.setFrame(e),t.setText("Frame ".concat(e))}),console.log(n),this.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,function(e){"ArrowLeft"===e.key?n.getComponent(re).body.acceleration.x=-600:"ArrowRight"===e.key?n.getComponent(re).body.acceleration.x=600:" "===e.key&&(n.getComponent(re).body.acceleration.x=0,n.getComponent(re).body.velocity.x=0)}),this.phecs.start(),this.cameras.main.setBackgroundColor("#cccccc"),this.enemy=n,this.events.on(Phaser.Scenes.Events.POST_UPDATE,this.myUpdate,this)}},{key:"myUpdate",value:function(){var e=this.enemy.getComponent(a).sprite.getCenter();this.centerDebugCircle.setPosition(e.x,e.y)}}])&&Ro(n.prototype,o),r&&Ro(n,r),t}();function Xo(e){return(Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Uo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Vo(e,t){return!t||"object"!==Xo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Go(e){return(Go=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jo(e,t){return(Jo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Vo(this,Go(t).call(this,{key:Ht.preload}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jo(e,t)}(t,te),n=t,(o=[{key:"preload",value:function(){this.load.image("title-screen","/assets/backgrounds/title-screen.png"),this.load.image("vignette-effect","/assets/backgrounds/vignette-effect.png"),this.load.image("green-hills-1","/assets/backgrounds/green-hills/1.png"),this.load.image("green-hills-2","/assets/backgrounds/green-hills/2.png"),this.load.image("green-hills-3","/assets/backgrounds/green-hills/3.png"),this.load.image("green-hills-4","/assets/backgrounds/green-hills/4.png"),this.load.bitmapFont("compass-72","/assets/fonts/compass-72.png","/assets/fonts/compass-72.xml"),this.load.bitmapFont("compass-72-title","/assets/fonts/compass-72-title.png","/assets/fonts/compass-72-title.xml"),this.load.bitmapFont("compass-24","/assets/fonts/compass-24.png","/assets/fonts/compass-24.xml"),this.load.bitmapFont("compass-24-conversation","/assets/fonts/compass-24-conversation.png","/assets/fonts/compass-24-conversation.xml"),this.load.bitmapFont("compass-18","/assets/fonts/compass-18.png","/assets/fonts/compass-18.xml"),this.load.spritesheet("old-lady","/assets/sprites/npcs/old-lady.png",{frameWidth:41,frameHeight:66}),this.load.animation("old-lady-animations","/assets/animations/old-lady.json"),this.load.spritesheet("old-man","/assets/sprites/npcs/old-man.png",{frameWidth:47,frameHeight:66}),this.load.animation("old-man-animations","/assets/animations/old-man.json"),this.load.spritesheet("adventurer-core","/assets/sprites/adventurer/adventurer-core.png",{frameWidth:100,frameHeight:74}),this.load.spritesheet("adventurer-bow","/assets/sprites/adventurer/adventurer-bow.png",{frameWidth:100,frameHeight:74}),this.load.animation("adventurer-animations","/assets/animations/adventurer.json"),this.load.json("adventurer-hurtboxes","/assets/hurtboxes/adventurer.json"),this.load.json("adventurer-bounds","/assets/bounds/adventurer.json"),this.load.image("arrow","/assets/sprites/projectiles/arrow.png"),this.load.json("arrow-bounds","/assets/bounds/arrow.json"),this.load.json("arrow-hitboxes","/assets/hitboxes/arrow.json"),this.load.spritesheet("sheep-walk","/assets/sprites/sheep/sheep-walk.png",{frameWidth:40,frameHeight:34}),this.load.animation("sheep-animations","/assets/animations/sheep.json"),this.load.spritesheet("enemy","/assets/sprites/enemy/enemy.png",{frameWidth:32,frameHeight:32}),this.load.animation("enemy-animations","/assets/animations/enemy.json"),this.load.json("enemy-hurtboxes","/assets/hurtboxes/enemy.json"),this.load.json("enemy-hitboxes","/assets/hitboxes/enemy.json"),this.load.spritesheet("indicator-down","/assets/sprites/indicators/indicator-down.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("indicator-right","/assets/sprites/indicators/indicator-right.png",{frameWidth:32,frameHeight:32}),this.load.animation("indicator-animations","/assets/animations/indicators.json"),this.load.spritesheet("doors","/assets/sprites/doors/doors.png",{frameWidth:64,frameHeight:82}),this.load.spritesheet("core-tileset-spritesheet","/assets/tilesets/core-tileset.png",{frameHeight:32,frameWidth:32}),this.load.image("core-tileset","/assets/tilesets/core-tileset.png"),this.load.tilemapTiledJSON("woollards-farm","/assets/tilemaps/woollards-farm.json"),this.load.tilemapTiledJSON("woollards-house","/assets/tilemaps/woollards-house.json"),this.load.image("textbox","/assets/sprites/conversations/textbox.png"),this.load.json("signs","/assets/signs.json"),this.load.image("conversation-box","/assets/sprites/conversations/conversation-box.png"),this.load.json("conversations","/assets/conversations.json"),this.load.spritesheet("healthbar","/assets/sprites/ui/healthbar.png",{frameWidth:124,frameHeight:22})}},{key:"create",value:function(){this.scene.start(Ht.exploration,{areaKey:"woollards-farm"})}}])&&Uo(n.prototype,o),r&&Uo(n,r),t}();function Qo(e){return(Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function $o(e){return($o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function er(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tr(e,t){return(tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nr={5:0,4:1,3:2,2:3,1:4},or=function(e){function t(){var e,n,o,r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=$o(t).call(this,{key:Ht.hud}))||"object"!==Qo(o)&&"function"!=typeof o?er(n):o,r=er(e),a=void 0,(i="healthListenerCleanupFn")in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,e}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tr(e,t)}(t,te),n=t,(o=[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(){var e=this.add.sprite(80,25,"healthbar",0);this.healthListenerCleanupFn=this.persistence.onChange(ce.health,function(t){e.setFrame(nr[t])})}},{key:"shutdown",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn()}}])&&qo(n.prototype,o),r&&qo(n,r),t}();function rr(e){return(rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ir(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ar(e){return(ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ur(e,t){return(ur=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function cr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var lr=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(r=ar(t).call(this,e))||"object"!==rr(r)&&"function"!=typeof r?sr(o):r,cr(sr(n),"data",void 0),cr(sr(n),"onChangeListeners",void 0),n.data={},n.onChangeListeners={},n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ur(e,t)}(t,Phaser.Plugins.BasePlugin),n=t,(o=[{key:"get",value:function(e){return this.data[e]}},{key:"update",value:function(e,t){var n=t(this.data[e]);this.set(e,n)}},{key:"set",value:function(e,t){this.data[e]=t,(this.onChangeListeners[e]||[]).forEach(function(e){return e(t)})}},{key:"onChange",value:function(e,t){var n=this;return this.onChangeListeners[e]=this.onChangeListeners[e]||[],this.onChangeListeners[e].push(t),function(){var o=n.onChangeListeners[e].findIndex(function(e){return e==t});n.onChangeListeners[e].splice(o,1)}}}])&&ir(n.prototype,o),r&&ir(n,r),t}();function fr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var pr=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="bitmapText")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.bitmapText=t.add.bitmapText(n.x,n.y,n.font,n.text),n.origin&&this.bitmapText.setOrigin(n.origin)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.bitmapText.destroy()}}])&&fr(t.prototype,n),o&&fr(t,o),e}();function hr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var yr=function(){function e(t,n,o){var r,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(i="indicator")in(r=this)?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a;var s=n.indicatorSide||Qt.TOP,u=o.getComponent(pr).bitmapText;this.indicator=new rn(t,u,s),this.indicator.hide()}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.indicator.destroy()}}])&&hr(t.prototype,n),o&&hr(t,o),e}();function dr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var br=function(){function e(t,n,o){var r,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(i="callback")in(r=this)?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,this.callback=n.menuActionCallback}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.callback}}])&&dr(t.prototype,n),o&&dr(t,o),e}();function vr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function mr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),mr(this,"scene",void 0),mr(this,"selectedIndex",void 0),mr(this,"menuOptions",void 0),this.scene=t,this.selectedIndex=0,this.menuOptions=[]}var t,n,o;return t=e,(n=[{key:"start",value:function(e){this.menuOptions=e.getEntities("menuButton"),this.scene.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.keyboardListener,this),this.updateIndicator(this.selectedIndex)}},{key:"stop",value:function(){this.scene.input.keyboard.off(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.keyboardListener,this)}},{key:"keyboardListener",value:function(e){"ArrowDown"===e.key?this.updateIndicator(Phaser.Math.Wrap(this.selectedIndex-1,0,this.menuOptions.length)):"ArrowUp"===e.key?this.updateIndicator(Phaser.Math.Wrap(this.selectedIndex-1,0,this.menuOptions.length)):" "!==e.key&&"f"!==e.key||this.selectMenuOption()}},{key:"updateIndicator",value:function(e){this.menuOptions[this.selectedIndex].getComponent(yr).indicator.hide(),this.selectedIndex=e,this.menuOptions[this.selectedIndex].getComponent(yr).indicator.show()}},{key:"selectMenuOption",value:function(){this.menuOptions[this.selectedIndex].getComponent(br).callback()}}])&&vr(t.prototype,n),o&&vr(t,o),e}();function wr(e){return(wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function kr(e,t){return!t||"object"!==wr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xr(e){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Or(e,t){return(Or=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Er=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),kr(this,xr(t).call(this,{key:Ht.title}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Or(e,t)}(t,te),n=t,(o=[{key:"init",value:function(){this.phecs.phEntities.registerPrefab("menuTitle",{components:[pr]}),this.phecs.phEntities.registerPrefab("menuButton",{components:[pr,yr,br]}),this.phecs.phSystems.registerSystems([gr])}},{key:"create",value:function(){var e=this;this.add.image(0,0,"title-screen").setOrigin(0,0),this.add.image(0,0,"vignette-effect").setOrigin(0,0).setAlpha(.1);var t=this.phecs.phEntities.createPrefab("menuTitle",{x:400,y:160,origin:.5,font:"compass-72-title",text:"Archer Adventure"});t.getComponent(pr).bitmapText.alpha=0;var n=this.phecs.phEntities.createPrefab("menuButton",{x:400,y:250,origin:.5,font:"compass-24",text:"Start",indicatorSide:Qt.LEFT,menuActionCallback:function(){e.phecs.stop(),e.scene.stop(),e.scene.start(Ht.exploration,{areaKey:"woollards-farm"})}});n.getComponent(pr).bitmapText.alpha=0;var o=this.phecs.phEntities.createPrefab("menuButton",{x:400,y:290,origin:.5,font:"compass-24",text:"Options",indicatorSide:Qt.LEFT,menuActionCallback:function(){}});o.getComponent(pr).bitmapText.alpha=0,this.tweens.timeline({tweens:[{targets:[t.getComponent(pr).bitmapText],props:{alpha:1},duration:1e3},{targets:[n.getComponent(pr).bitmapText,o.getComponent(pr).bitmapText],props:{alpha:1},duration:500,onComplete:function(){e.phecs.start()}}]})}}])&&Cr(n.prototype,o),r&&Cr(n,r),t}(),Pr={width:800,height:450,plugins:{global:[{key:"NinePatchPlugin",plugin:o.NinePatchPlugin,start:!0},{key:"ParallaxSpritePlugin",plugin:G,start:!0},{key:"PersistencePlugin",plugin:lr,mapping:"persistence",start:!0}],scene:[{key:"StateRegistrar",plugin:R,mapping:"stateRegistrar"},{key:"Phecs",plugin:A,mapping:"phecs"},{key:"AreaManager",plugin:y,mapping:"areaManager"}]},scene:[Zo,Er,Io,or,Mo,zo],pixelArt:!0,physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1100}}}};new Phaser.Game(Pr)}});