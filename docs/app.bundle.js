!function(e){function t(t){for(var o,a,s=t[0],c=t[1],u=t[2],f=0,p=[];f<s.length;f++)a=s[f],r[a]&&p.push(r[a][0]),r[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(l&&l(t);p.length;)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={0:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([1457,1]),n()}({1457:function(e,t,n){"use strict";n.r(t);n(31);var o=n(534),r=function(e){return Array.isArray(e)?e.reduce(function(e,t){return e[t.name]=t.value,e},{}):e||{}};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="sprite")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i;var a=n.x,s=n.y,c=n.texture,u=n.frame;this.sprite=t.add.sprite(a,s,c,u),this.sprite.y-=this.sprite.height*this.sprite.originY,n.scale&&this.sprite.setScale(n.scale),n.depth&&this.sprite.setDepth(n.depth)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.sprite.destroy(),delete this.sprite}}])&&i(t.prototype,n),o&&i(t,o),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){function t(e,n){var o,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=!(i=l(t).call(this,e,n))||"object"!==s(i)&&"function"!=typeof i?f(r):i,h(f(o),"map",void 0),h(f(o),"tileset",void 0),h(f(o),"tileLayers",void 0),h(f(o),"objects",void 0),h(f(o),"markers",void 0),h(f(o),"zones",void 0),h(f(o),"currentAreaKey",void 0),h(f(o),"areaMap",void 0),h(f(o),"backgroundSets",void 0),h(f(o),"adventurer",void 0),h(f(o),"background",void 0),o.tileLayers=[],o.objects={},o.markers={},o.zones={},o.currentAreaKey="",o.areaMap={},o.backgroundSets={},o}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,Phaser.Plugins.ScenePlugin),n=t,(o=[{key:"registerArea",value:function(e,t,n,o){this.areaMap[e]={mapKey:t,tilesetName:n,tilesetKey:o}}},{key:"registerBackgroundSet",value:function(e,t){this.backgroundSets[e]=t}},{key:"load",value:function(e){this.currentAreaKey=e;var t=this.areaMap[e],n=this.scene.make.tilemap({key:t.mapKey}),o=n.addTilesetImage(t.tilesetName,t.tilesetKey);this.map=n,this.tileset=o,this.tileLayers=[],this.objects={},this.loadMarkers(),this.loadZones(),this.createBackground(r(this.map.properties)),this.createTileLayers(this.map.layers.map(function(e){return e.name})),this.createObjectLayers(this.map.objects.map(function(e){return e.name}))}},{key:"unload",value:function(){this.currentAreaKey="",this.objects={},this.markers={},this.zones={},this.tileLayers.forEach(function(e){return e.destroy()}),this.tileLayers=[],delete this.tileset,this.map&&this.map.destroy(),this.background&&this.background.destroy()}},{key:"placeEntityAtMarker",value:function(e,t){var n=this.markers[t],o=e.getComponent(a).sprite;e.getComponent(a).sprite.setPosition(n.x,n.y-o.height*o.originY)}},{key:"getTileLayer",value:function(e){return this.tileLayers.find(function(t){return t.layer.name===e})}},{key:"getZone",value:function(e){return this.zones[e]}},{key:"getCollisionMap",value:function(){return r(this.map.properties).entityLayerCollisions.split(",").reduce(function(e,t){var n=c(t.split(":"),2),o=n[0],r=n[1];return e[o]=e[o]||[],e[o].push(r),e},{})}},{key:"loadMarkers",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){r(t.properties).marker&&(e.markers[t.name]={x:t.x,y:t.y})})})}},{key:"loadZones",value:function(){var e=this;this.map.objects.forEach(function(t){t.objects.forEach(function(t){r(t.properties).zone&&(e.zones[t.name]={x:t.x,y:t.y,width:t.width,height:t.height})})})}},{key:"createTileLayers",value:function(e){var t=this;e.forEach(function(e){return t.createTileLayer(e)})}},{key:"createTileLayer",value:function(e){var t=this.map.createStaticLayer(e,this.tileset),n=r(t.layer.properties);n.collides&&(t.forEachTile(function(e){e.setCollision(!0,!0,!0,!0,!1)},this,0,0,t.width,t.height,{isNotEmpty:!0}),t.calculateFacesWithin(0,0,t.width,t.height)),t.setDepth(n.depth),this.tileLayers.push(t)}},{key:"createObjectLayers",value:function(e){var t=this;e.forEach(function(e){return t.createObjects(e)})}},{key:"createObjects",value:function(e){var t=this,n=this.map.getObjectLayer(e),o=r(n.properties),i=n.objects;this.objects[e]=[];var a=this.scene;i.forEach(function(n){var r=null;n.type&&(r=a.phecs.phEntities.createPrefab(n.type,n.properties,o.depth,n.x,n.y)),t.objects[e].push(r)})}},{key:"createBackground",value:function(e){if(e.backgroundSet){var t=this.backgroundSets[e.backgroundSet].map(function(e){return{key:e}});this.background=this.scene.add.parallaxSprite(t),this.background.scrollWithCamera(this.scene.cameras.main)}else e.backgroundColor&&this.scene.cameras.main.setBackgroundColor("#".concat(e.backgroundColor))}}])&&u(n.prototype,o),i&&u(n,i),t}();function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,"type",void 0),m(this,"id",void 0),m(this,"components",void 0),this.type=t,this.id=d(),this.components=[]}var t,n,o;return t=e,(n=[{key:"getComponent",value:function(e){var t=this.components.find(function(t){return t instanceof e});if(t)return t;throw new Error("BaseEntity::NO_COMPONENT_".concat(b(e)))}},{key:"hasComponent",value:function(e){return this.components.some(function(t){return t instanceof e})}}])&&v(t.prototype,n),o&&v(t,o),e}();function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){P(e,t,n[t])})}return e}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,"scene",void 0),P(this,"prefabs",void 0),P(this,"entitiesById",void 0),P(this,"entities",void 0),this.scene=t,this.prefabs={},this.entitiesById={},this.entities=[]}var t,n,o;return t=e,(n=[{key:"registerPrefab",value:function(e,t){this.prefabs[e]=t}},{key:"createPrefab",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=this.scene,s=new g(e),c=this.prefabs[e],u=w({x:o,y:i,depth:n},r(t));return this.getComponentDefinitions(c).forEach(function(e){var t=new e.component(a,w({},u,e.data),s);s.components.push(t)}),this.entitiesById[s.id]=s,this.entities.push(s),s}},{key:"getEntityById",value:function(e){return this.entitiesById[e]}},{key:"getEntities",value:function(e){if("string"==typeof e)return this.getEntitiesByType(e);if("function"==typeof e)return this.getEntitiesByComponent(e);throw new Error("Phecs.EntityManager::BAD_ENTITY_IDENTIFIER::".concat(e))}},{key:"destroy",value:function(){this.entities.forEach(function(e){e.components.forEach(function(e){return e.destroy()})}),this.entitiesById={},this.entities=[]}},{key:"getComponentDefinitions",value:function(e){return e.components.map(function(e){return"function"==typeof e?{component:e}:e})}},{key:"getEntitiesByComponent",value:function(e){return this.entities.filter(function(t){return t.hasComponent(e)})}},{key:"getEntitiesByType",value:function(e){return this.entities.filter(function(t){return t.type===e})}}])&&C(t.prototype,n),o&&C(t,o),e}();function k(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),O(this,"scene",void 0),O(this,"systems",void 0),this.scene=t,this.systems=[]}var t,n,o;return t=e,(n=[{key:"start",value:function(e){this.systems.forEach(function(t){t.start&&t.start(e)})}},{key:"stop",value:function(e){this.systems.forEach(function(t){t.stop&&t.stop(e)})}},{key:"update",value:function(e){this.systems.forEach(function(t){t.update&&t.update(e)})}},{key:"destroy",value:function(){this.systems.forEach(function(e){e.destroy&&e.destroy()}),this.systems=[]}},{key:"registerSystems",value:function(e){var t=this;e.forEach(function(e){t.systems.push(new e(t.scene))})}}])&&k(t.prototype,n),o&&k(t,o),e}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=function(e){function t(e,n){var o,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=!(i=T(t).call(this,e,n))||"object"!==E(i)&&"function"!=typeof i?_(r):i,I(_(o),"phEntities",void 0),I(_(o),"phSystems",void 0),o.phEntities=new x(e),o.phSystems=new S(e),o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,Phaser.Plugins.ScenePlugin),n=t,(o=[{key:"start",value:function(){this.phSystems.start(this.phEntities),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"stop",value:function(){this.phSystems.stop(this.phEntities),this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.update,this)}},{key:"update",value:function(){this.phSystems.update(this.phEntities)}},{key:"destroy",value:function(){this.phEntities.destroy()}},{key:"reset",value:function(){this.stop(),this.destroy()}},{key:"shutdown",value:function(){this.stop(),this.destroy(),this.phSystems.destroy()}}])&&j(n.prototype,o),r&&j(n,r),t}();function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=function(e){function t(e,n){var o,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=!(i=D(t).call(this,e,n))||"object"!==M(i)&&"function"!=typeof i?B(r):i,F(B(o),"states",void 0),F(B(o),"sets",void 0),o.states={},o.sets={},o}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,Phaser.Plugins.ScenePlugin),n=t,(o=[{key:"destroy",value:function(){this.states={},this.sets={}}},{key:"registerSets",value:function(e){var t=this;e.forEach(function(e){return t.addSet(e.id,e.states)})}},{key:"getState",value:function(e){return this.states[e]}},{key:"getSet",value:function(e){var t=this;return this.sets[e].map(function(e){return t.states[e]})}},{key:"addSet",value:function(e,t){var n=this;t.forEach(function(e){n.states[e.id]=e}),this.sets[e]=t.map(function(e){return e.id})}}])&&L(n.prototype,o),r&&L(n,r),t}();function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var K=function(){function e(t,n,o,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),X(this,"scene",void 0),X(this,"layers",void 0),this.scene=t,o=o||t.cameras.main.centerX,r=r||t.cameras.main.centerY,i=i||t.cameras.main.width,a=a||t.cameras.main.height;var s=n.length;this.layers=n.map(function(e,n){var c=t.add.tileSprite(o,r,i,a,e.key);return c.setScrollFactor(0),{tileSprite:c,scrollFactor:(n+1)/s*.2}})}var t,n,o;return t=e,(n=[{key:"scrollWithCamera",value:function(e){var t=this;this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,function(){return t.setOffset(e.scrollX)})}},{key:"setOffset",value:function(e){this.layers.forEach(function(t){t.tileSprite.setTilePosition(t.scrollFactor*e)})}},{key:"destroy",value:function(){this.layers.forEach(function(e){e.tileSprite.destroy()})}}])&&N(t.prototype,n),o&&N(t,o),e}();function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function U(e,t){return!t||"object"!==Y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var J=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=U(this,V(t).call(this,e)),e.registerGameObject("parallaxSprite",n.createParallaxSprite),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(t,Phaser.Plugins.BasePlugin),n=t,(o=[{key:"createParallaxSprite",value:function(e,t,n,o,r){return new K(this.scene,e,t,n,o,r)}}])&&G(n.prototype,o),r&&G(n,r),t}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ne(e,t,n){return t&&te(e.prototype,t),n&&te(e,n),e}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var re=function(){function e(){ee(this,e),oe(this,"onPressListeners",void 0),oe(this,"onReleaseListeners",void 0),oe(this,"isPressed",void 0),this.onPressListeners=[],this.onReleaseListeners=[],this.isPressed=!1}return ne(e,[{key:"onPress",value:function(e,t){var n=this,o=d();return this.onPressListeners.push({id:o,context:t,callback:e}),function(){var e=n.onPressListeners.findIndex(function(e){return e.id===o});n.onPressListeners.splice(e,1)}}},{key:"onRelease",value:function(e,t){var n=this,o=d();return this.onReleaseListeners.push({id:o,context:t,callback:e}),function(){var e=n.onReleaseListeners.findIndex(function(e){return e.id===o});n.onReleaseListeners.splice(e,1)}}},{key:"press",value:function(){if(!this.isPressed){var e=!0,t=!1,n=void 0;try{for(var o,r=this.onPressListeners[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var i=o.value;i.callback.call(i.context)}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}this.isPressed=!0}},{key:"release",value:function(){if(this.isPressed){var e=!0,t=!1,n=void 0;try{for(var o,r=this.onReleaseListeners[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var i=o.value;i.callback.call(i.context)}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}this.isPressed=!1}},{key:"destroy",value:function(){this.onPressListeners=[],this.onReleaseListeners=[]}}]),e}(),ie=function(e){function t(e,n){var o,r,i;return ee(this,t),r=this,o=!(i=Q(t).call(this,e,n))||"object"!==Z(i)&&"function"!=typeof i?q(r):i,oe(q(o),"left",void 0),oe(q(o),"right",void 0),oe(q(o),"up",void 0),oe(q(o),"down",void 0),oe(q(o),"action",void 0),oe(q(o),"shoot",void 0),o.left=new re,o.right=new re,o.up=new re,o.down=new re,o.action=new re,o.shoot=new re,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(t,Phaser.Plugins.ScenePlugin),ne(t,[{key:"start",value:function(){this.startListening(),this.scene.events.once(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this)}},{key:"stop",value:function(){this.scene.events.off(Phaser.Scenes.Events.SHUTDOWN,this.shutdown,this),this.shutdown()}},{key:"startListening",value:function(){this.scene.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.onPress,this),this.scene.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_UP,this.onRelease,this)}},{key:"shutdown",value:function(){this.scene.input.keyboard.off(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,this.onPress,this),this.scene.input.keyboard.off(Phaser.Input.Keyboard.Events.ANY_KEY_UP,this.onRelease,this),this.left.destroy(),this.right.destroy(),this.up.destroy(),this.down.destroy(),this.action.destroy(),this.shoot.destroy()}},{key:"onPress",value:function(e){switch(e.code){case"ArrowLeft":this.left.press();break;case"ArrowRight":this.right.press();break;case"ArrowUp":this.up.press();break;case"ArrowDown":this.down.press();break;case"KeyF":this.action.press();break;case"Space":this.shoot.press()}}},{key:"onRelease",value:function(e){switch(e.code){case"ArrowLeft":this.left.release();break;case"ArrowRight":this.right.release();break;case"ArrowUp":this.up.release();break;case"ArrowDown":this.down.release();break;case"KeyF":this.action.release();break;case"Space":this.shoot.release()}}}]),t}();function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fe,pe=function(e){function t(){var e,n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return o=this,n=!(r=(e=se(t)).call.apply(e,[this].concat(a)))||"object"!==ae(r)&&"function"!=typeof r?ce(o):r,le(ce(n),"phecs",void 0),le(ce(n),"areaManager",void 0),le(ce(n),"stateRegistrar",void 0),le(ce(n),"persistence",void 0),le(ce(n),"controls",void 0),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(t,Phaser.Scene),t}(),he={maxVelocity:350,horizontalAcceleration:800,horizontalDeceleration:2e3,slideVelocityThreshold:250,slideDeceleration:350,shortJumpVelocity:-350,jumpVelocity:-425,aerialMaxHorizontalVelocity:250,aerialHorizontalAcceleration:300,aerialHorizontalFrictionAcceleration:150};function ye(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}!function(e){e[e.Initial=0]="Initial",e[e.PressControl=1]="PressControl",e[e.ReleaseControl=2]="ReleaseControl",e[e.Conditional=3]="Conditional",e[e.Timer=4]="Timer"}(fe||(fe={}));var de=function(){function e(t,n,o){var r,i,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s=void 0,(i="body")in(r=this)?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s,t.physics.add.existing(o.getComponent(a).sprite);var c=o.getComponent(a).sprite;this.body=c.body,this.body.setSize(c.width,c.height),this.body.updateBounds(),n.maxVelocityX&&(this.body.maxVelocity.x=n.maxVelocityX)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.body.destroy(),delete this.body}}])&&ye(t.prototype,n),o&&ye(t,o),e}(),be={transitions:[{type:fe.Conditional,condition:function(e){return!e.getComponent(de).body.blocked.down},to:function(e){return e.getComponent(de).body.velocity.y=100,e.getComponent(de).body.velocity.x>0?"adventurer-fall-right":e.getComponent(de).body.velocity.x<0?"adventurer-fall-left":"adventurer-fall"}}]};function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function me(e,t){var n=[e.onEnter,t.onEnter].filter(Boolean),o=[e.onUpdate,t.onUpdate].filter(Boolean),r=[e.onLeave,t.onLeave].filter(Boolean),i=[e.transitions,t.transitions].filter(Boolean).flat(),a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){ve(e,t,n[t])})}return e}({},e.data,t.data);return{id:e.id||t.id,transitions:i,data:a,onEnter:function(e,t){return n.forEach(function(n){return n(e,t)})},onUpdate:function(e,t){return o.forEach(function(n){return n(e,t)})},onLeave:function(e,t){return r.forEach(function(n){return n(e,t)})}}}var ge=me(be,{onEnter:function(e){!function(e){e.getComponent(de).body.acceleration.x=e.getComponent(de).body.velocity.x<0?he.horizontalDeceleration:-he.horizontalDeceleration}(e)},onUpdate:function(e){!function(e){Phaser.Math.Within(e.getComponent(de).body.velocity.x,0,100)&&(e.getComponent(de).body.acceleration.x=0,e.getComponent(de).body.velocity.x=0)}(e)}}),we=me(ge,{id:"adventurer-stand",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand")},transitions:[{type:fe.PressControl,control:"right",to:"adventurer-run-right"},{type:fe.PressControl,control:"left",to:"adventurer-run-left"},{type:fe.PressControl,control:"down",to:"adventurer-crouch"},{type:fe.PressControl,control:"up",to:"adventurer-jump-prep"},{type:fe.PressControl,control:"shoot",to:"adventurer-stand-draw"}]});function Ce(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var xe=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Pe(this,"scene",void 0),Pe(this,"entity",void 0),Pe(this,"states",void 0),Pe(this,"triggerCancelers",void 0),Pe(this,"currentState",void 0),this.scene=t,this.entity=n,this.states=o,this.currentState={id:"dummy",transitions:[]},this.triggerCancelers=[]}var t,n,o;return t=e,(n=[{key:"update",value:function(){this.currentState.onUpdate&&this.currentState.onUpdate(this.entity,this.currentState.data||{})}},{key:"doTransition",value:function(e){this.cancelTransitionTriggers(),this.currentState.onLeave&&this.currentState.onLeave(this.entity,this.currentState.data||{});var t="string"==typeof e.to?e.to:e.to(this.entity);this.currentState=this.states.find(function(e){return e.id===t}),e.onTransition&&e.type!==fe.Initial&&e.onTransition(this.entity),this.currentState.onEnter&&this.currentState.onEnter(this.entity,this.currentState.data||{}),this.registerTransitionTriggers()}},{key:"destroy",value:function(){this.cancelTransitionTriggers()}},{key:"cancelTransitionTriggers",value:function(){this.triggerCancelers.forEach(function(e){return e()}),this.triggerCancelers=[]}},{key:"registerTransitionTriggers",value:function(){var e=this;this.currentState.transitions.forEach(function(t){switch(t.type){case fe.PressControl:e.registerPressControlTransitionTrigger(t);break;case fe.ReleaseControl:e.registerReleaseControlTransitionTrigger(t);break;case fe.Conditional:e.registerConditionalTransitionTrigger(t);break;case fe.Timer:e.registerTimerTransitionTrigger(t)}})}},{key:"registerPressControlTransitionTrigger",value:function(e){var t=this,n=this.scene.controls[e.control].onPress(function(){return t.doTransition(e)});this.triggerCancelers.push(n)}},{key:"registerReleaseControlTransitionTrigger",value:function(e){var t=this,n=this.scene.controls[e.control].onRelease(function(){return t.doTransition(e)});this.triggerCancelers.push(n)}},{key:"registerConditionalTransitionTrigger",value:function(e){var t=this,n=function(){e.condition(t.entity)&&t.doTransition(e)};this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,n),this.triggerCancelers.push(function(){return t.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,n)})}},{key:"registerTimerTransitionTrigger",value:function(e){var t=this,n="number"==typeof e.delay?e.delay:e.delay(),o=this.scene.time.delayedCall(n,function(){t.doTransition(e)});this.triggerCancelers.push(function(){return o.remove()})}}])&&Ce(t.prototype,n),o&&Ce(t,o),e}();function ke(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Oe=function(){function e(t,n,o){var r,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(i="phiniteStateMachine")in(r=this)?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a;var s=t,c=s.stateRegistrar.getSet(n.stateSet),u=s.stateRegistrar.getState(n.initialStateId);this.phiniteStateMachine=new xe(t,o,c),this.phiniteStateMachine.doTransition({type:fe.Initial,to:u.id})}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.phiniteStateMachine.destroy(),delete this.phiniteStateMachine}}])&&ke(t.prototype,n),o&&ke(t,o),e}();function Se(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var je=3,Te=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ee(this,"shotPower",void 0),Ee(this,"shotChargeRate",void 0),Ee(this,"minShotPower",void 0),Ee(this,"maxShotPower",void 0),Ee(this,"arrows",void 0),Ee(this,"entity",void 0);var r=t;this.entity=o,this.minShotPower=300,this.maxShotPower=700,this.shotChargeRate=15,this.shotPower=this.minShotPower,this.arrows=[];for(var i=0;i<je;i++){var s=r.phecs.phEntities.createPrefab("arrow",{},o.getComponent(a).sprite.depth,0,0);s.getComponent(Oe).phiniteStateMachine.doTransition({to:"arrow-disabled"}),this.arrows.push(s)}}var t,n,o;return t=e,(n=[{key:"shootArrow",value:function(){var e=this.getAvailableArrow();e.getComponent(a).sprite.x=this.entity.getComponent(a).sprite.x,e.getComponent(a).sprite.y=this.entity.getComponent(a).sprite.y,e.getComponent(Oe).phiniteStateMachine.doTransition({to:"arrow-flying"});var t=Phaser.Math.Clamp(this.shotPower,this.minShotPower,this.maxShotPower);this.entity.getComponent(a).sprite.flipX&&(t*=-1),e.getComponent(de).body.setVelocity(t,0),e.getComponent(de).body.setGravityY(-500),this.shotPower=this.minShotPower}},{key:"getAvailableArrow",value:function(){var e=this.arrows.filter(function(e){return"arrow-disabled"===e.getComponent(Oe).phiniteStateMachine.currentState.id}),t=this.arrows.filter(function(e){return"arrow-hit"===e.getComponent(Oe).phiniteStateMachine.currentState.id});if(e.length)return e[0];if(t.length)return t[0];throw new Error("ShootsArrows::shootArrow::NO_AVAILABLE_ARROWS")}},{key:"destroy",value:function(){this.arrows=[]}}])&&Se(t.prototype,n),o&&Se(t,o),e}(),_e=me(ge,{id:"adventurer-stand-draw",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand-draw",!0)},onUpdate:function(e){e.getComponent(Te).shotPower+=e.getComponent(Te).shotChargeRate},transitions:[{type:fe.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:"adventurer-stand-hold"},{type:fe.ReleaseControl,control:"shoot",to:"adventurer-stand-shoot"},{type:fe.PressControl,control:"left",to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:fe.PressControl,control:"right",to:"adventurer-stand-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]}),Ae=me(ge,{id:"adventurer-stand-hold",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand-hold",!0)},onUpdate:function(e){e.getComponent(Te).shotPower+=e.getComponent(Te).shotChargeRate},transitions:[{type:fe.ReleaseControl,control:"shoot",to:"adventurer-stand-shoot"},{type:fe.PressControl,control:"left",to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:fe.PressControl,control:"right",to:"adventurer-stand-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]});function Ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Re=function(){function e(t){var n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=void 0,(o="scene")in(n=this)?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,this.scene=t}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.scene}}])&&Ie(t.prototype,n),o&&Ie(t,o),e}(),Me=me(ge,{id:"adventurer-stand-shoot",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-stand-shoot")},onLeave:function(e){e.getComponent(Te).shootArrow()},transitions:[{type:fe.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(Re).scene.controls;return t.right.isPressed?"adventurer-run-right":t.left.isPressed?"adventurer-run-left":"adventurer-stand"}}]}),Le=me(ge,{onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-crouch")},transitions:[{type:fe.ReleaseControl,control:"down",to:function(e){var t=e.getComponent(Re).scene.controls;return t.left.isPressed?"adventurer-run-left":t.right.isPressed?"adventurer-run-right":"adventurer-stand"}}]}),De=me(Le,{id:"adventurer-crouch",transitions:[{type:fe.PressControl,control:"left",to:"adventurer-crouch-left"},{type:fe.PressControl,control:"right",to:"adventurer-crouch-right"}]}),Be=me(Le,{id:"adventurer-crouch-left",onEnter:function(e){e.getComponent(a).sprite.flipX=!0},transitions:[{type:fe.PressControl,control:"right",to:"adventurer-crouch-right"}]}),He=me(Le,{id:"adventurer-crouch-right",onEnter:function(e){e.getComponent(a).sprite.flipX=!1},transitions:[{type:fe.PressControl,control:"left",to:"adventurer-crouch-left"}]}),Fe=me(be,{onEnter:function(e){e.getComponent(a).sprite.flipX=!1,e.getComponent(a).sprite.anims.play("adventurer-run")},transitions:[{type:fe.PressControl,control:"shoot",to:"adventurer-stand-draw"},{type:fe.PressControl,control:"down",to:function(e){return Math.abs(e.getComponent(de).body.velocity.x)<he.slideVelocityThreshold?"adventurer-crouch":"adventurer-slide"}},{type:fe.PressControl,control:"up",to:"adventurer-jump-prep"}]});function ze(e,t){"left"===t?e.getComponent(de).body.acceleration.x=-he.horizontalAcceleration:"right"===t&&(e.getComponent(de).body.acceleration.x=he.horizontalAcceleration),function(e){Phaser.Math.Within(e.getComponent(de).body.velocity.x,0,5)||(e.getComponent(de).body.velocity.x+=.5*e.getComponent(de).body.velocity.x*-1)}(e)}var Ne=me(Fe,{id:"adventurer-run-right",onEnter:function(e){e.getComponent(a).sprite.flipX=!1,e.getComponent(a).sprite.anims.play("adventurer-run"),ze(e,"right")},transitions:[{type:fe.ReleaseControl,control:"right",to:"adventurer-stand"},{type:fe.PressControl,control:"left",to:"adventurer-run-left"}]}),Xe=me(Fe,{id:"adventurer-run-left",onEnter:function(e){e.getComponent(a).sprite.flipX=!0,e.getComponent(a).sprite.anims.play("adventurer-run"),ze(e,"left")},transitions:[{type:fe.ReleaseControl,control:"left",to:"adventurer-stand"},{type:fe.PressControl,control:"right",to:"adventurer-run-right"}]}),Ke=me(be,{id:"adventurer-slide",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-slide"),e.getComponent(de).body.velocity.x>0?e.getComponent(de).body.acceleration.x=-1*he.slideDeceleration:e.getComponent(de).body.acceleration.x=he.slideDeceleration},onUpdate:function(e){Phaser.Math.Within(e.getComponent(de).body.velocity.x,0,5)&&(e.getComponent(de).body.acceleration.x=0)},transitions:[{type:fe.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(Re).scene.controls;return t.left.isPressed?"adventurer-run-left":t.right.isPressed?"adventurer-run-right":t.down.isPressed?"adventurer-crouch":"adventurer-stand"}},{type:fe.PressControl,control:"up",to:"adventurer-jump-prep"}]}),Ye={id:"adventurer-jump-prep",onEnter:function(e){e.getComponent(de).body.acceleration.x=0,e.getComponent(a).sprite.anims.play("adventurer-jump-prep")},transitions:[{type:fe.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){var t=e.getComponent(Re).scene.controls;return t.right.isPressed?"adventurer-jump-right":t.left.isPressed?"adventurer-jump-left":e.getComponent(de).body.velocity.x>0?"adventurer-jump-right":e.getComponent(de).body.velocity.x<0?"adventurer-jump-left":"adventurer-jump"},onTransition:function(e){e.getComponent(Re).scene.controls.up.isPressed?e.getComponent(de).body.velocity.y=he.jumpVelocity:e.getComponent(de).body.velocity.y=he.shortJumpVelocity}}]};var Ge={onUpdate:function(e,t){var n=e.getComponent(de).body,o=e.getComponent(Re).scene.controls;o.left.isPressed||o.right.isPressed?function(e,t){var n=e.getComponent(de).body,o=e.getComponent(Re).scene.controls;o.left.isPressed&&n.velocity.x>t?n.acceleration.x=-1*he.aerialHorizontalAcceleration:o.right.isPressed&&n.velocity.x<t&&(n.acceleration.x=he.aerialHorizontalAcceleration)}(e,t.targetAerialHorizontalVelocity):function(e){var t=e.getComponent(de).body;t.velocity.x>0?t.acceleration.x=-1*he.aerialHorizontalFrictionAcceleration:t.velocity.x<0?t.acceleration.x=he.aerialHorizontalFrictionAcceleration:t.acceleration.x=0}(e),Phaser.Math.Within(t.targetAerialHorizontalVelocity,n.velocity.x,5)&&(n.acceleration.x=0,n.velocity.x=t.targetAerialHorizontalVelocity)}},Ue=me(Ge,{onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-jump-rise")},transitions:[{type:fe.PressControl,control:"shoot",to:"adventurer-air-draw"}]}),Ve=me(Ue,{id:"adventurer-jump",data:{targetAerialHorizontalVelocity:0},transitions:[{type:fe.PressControl,control:"left",to:"adventurer-jump-left"},{type:fe.PressControl,control:"right",to:"adventurer-jump-right"},{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.velocity.y>1},to:"adventurer-fall"}]}),We=me(Ue,{id:"adventurer-jump-left",data:{targetAerialHorizontalVelocity:-1*he.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(a).sprite.flipX=!0},transitions:[{type:fe.PressControl,control:"right",to:"adventurer-jump-right"},{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.velocity.y>0},to:"adventurer-fall-left"}]}),Je=me(Ue,{id:"adventurer-jump-right",data:{targetAerialHorizontalVelocity:he.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(a).sprite.flipX=!1},transitions:[{type:fe.PressControl,control:"left",to:"adventurer-jump-left"},{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.velocity.y>0},to:"adventurer-fall-right"}]}),Ze=me(Ge,{onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-fall")},transitions:[{type:fe.PressControl,control:"shoot",to:"adventurer-air-draw"},{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.blocked.down},to:function(e){var t=e.getComponent(Re).scene.controls;return t.down.isPressed?Math.abs(e.getComponent(de).body.velocity.x)<he.slideVelocityThreshold?"adventurer-crouch":"adventurer-slide":t.left.isPressed?"adventurer-run-left":t.right.isPressed?"adventurer-run-right":"adventurer-stand"}}]}),Qe=[we,_e,Ae,Me,De,Be,He,Ne,Xe,Ke,Ye,Ve,We,Je,me(Ze,{id:"adventurer-fall",data:{horizontalMaxVelocity:0},transitions:[{type:fe.PressControl,control:"left",to:"adventurer-fall-left"},{type:fe.PressControl,control:"right",to:"adventurer-fall-right"}]}),me(Ze,{id:"adventurer-fall-left",data:{targetAerialHorizontalVelocity:-1*he.aerialMaxHorizontalVelocity},onEnter:function(e){e.getComponent(a).sprite.flipX=!0},transitions:[{type:fe.PressControl,control:"right",to:"adventurer-fall-right"}]}),me(Ze,{id:"adventurer-fall-right",data:{targetAerialHorizontalVelocity:he.aerialMaxHorizontalVelocity},onEnter:function(e,t){e.getComponent(a).sprite.flipX=!1},transitions:[{type:fe.PressControl,control:"left",to:"adventurer-fall-left"}]}),me(Ge,{id:"adventurer-air-draw",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-air-draw",!0)},onUpdate:function(e){e.getComponent(Te).shotPower+=e.getComponent(Te).shotChargeRate},transitions:[{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.blocked.down},to:"adventurer-stand-hold"},{type:fe.ReleaseControl,control:"shoot",to:"adventurer-air-shoot"},{type:fe.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:"adventurer-air-hold"},{type:fe.PressControl,control:"left",to:"adventurer-air-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:fe.PressControl,control:"right",to:"adventurer-air-draw",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]}),me(Ge,{id:"adventurer-air-hold",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-air-hold",!0)},onUpdate:function(e){e.getComponent(Te).shotPower+=e.getComponent(Te).shotChargeRate},transitions:[{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.blocked.down},to:"adventurer-stand-hold"},{type:fe.ReleaseControl,control:"shoot",to:"adventurer-air-shoot"},{type:fe.PressControl,control:"left",to:"adventurer-air-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!0}},{type:fe.PressControl,control:"right",to:"adventurer-air-hold",onTransition:function(e){e.getComponent(a).sprite.flipX=!1}}]}),me(Ge,{id:"adventurer-air-shoot",onEnter:function(e){e.getComponent(a).sprite.anims.play("adventurer-air-shoot")},transitions:[{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.blocked.down},to:"adventurer-stand-shoot"},{type:fe.Conditional,condition:function(e){return!e.getComponent(a).sprite.anims.isPlaying},to:function(e){return e.getComponent(de).body.velocity.y<0?"adventurer-jump":"adventurer-fall"},onTransition:function(e){e.getComponent(Te).shootArrow()}}]})],qe={id:"arrow-flying",transitions:[{type:fe.Conditional,condition:function(e){return!e.getComponent(de).body.blocked.none},to:"arrow-hit"}],onEnter:function(e){e.getComponent(a).sprite.active=!0,e.getComponent(a).sprite.visible=!0,e.getComponent(de).body.enable=!0,e.getComponent(de).body.allowGravity=!0,e.getComponent(de).body.setVelocity(400,0)},onUpdate:function(e){if(e.getComponent(de).body.blocked.none){var t=Math.atan2(e.getComponent(de).body.velocity.y,e.getComponent(de).body.velocity.x);e.getComponent(a).sprite.rotation=t}}},$e={id:"arrow-hit",transitions:[],onEnter:function(e){e.getComponent(de).body.setVelocity(0,0),e.getComponent(de).body.allowGravity=!1}};function et(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nt=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),tt(this,"type",void 0),tt(this,"properties",void 0),tt(this,"shape",void 0),tt(this,"config",void 0),tt(this,"enabled",void 0),tt(this,"debugRect",void 0),this.type=t,this.config=n,this.properties=o,this.enabled=!0,this.shape=new Phaser.Geom.Rectangle(0,0,n.width,n.height),r&&i&&(this.debugRect=i.add.rectangle(this.shape.x,this.shape.y,this.shape.width,this.shape.height,255,.5),this.debugRect.fillColor=255,this.debugRect.setDepth(5))}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.shape.x=0,this.shape.y=0,this.shape.width=0,this.shape.height=0,this.debugRect&&(this.debugRect.x=this.shape.x,this.debugRect.y=this.shape.y,this.debugRect.width=this.shape.width,this.debugRect.height=this.shape.height)}},{key:"isEnabled",value:function(){return!0===this.enabled}},{key:"overlaps",value:function(e){return Phaser.Geom.Rectangle.Overlaps(this.shape,e.shape)}},{key:"setConfig",value:function(e){this.config=e}},{key:"syncToSprite",value:function(e){if(this.enabled){var t=e.scaleX,n=e.scaleY,o=(e.flipX?-1*this.config.offsetX:this.config.offsetX)*t,r=(e.flipY?-1*this.config.offsetY:this.config.offsetY)*n,i=t*this.config.width,a=n*this.config.height,s=e.getCenter(),c=new Phaser.Geom.Point(s.x+o,s.y+r);Phaser.Math.RotateAround(c,s.x,s.y,e.rotation),c.x-=i/2,c.y-=a/2,this.shape.x=c.x,this.shape.y=c.y,this.shape.width=i,this.shape.height=a}this.debugRect&&(this.debugRect.x=this.shape.x,this.debugRect.y=this.shape.y,this.debugRect.width=this.shape.width,this.debugRect.height=this.shape.height)}},{key:"destroy",value:function(){this.debugRect&&this.debugRect.destroy()}}])&&et(t.prototype,n),o&&et(t,o),e}();function ot(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var it=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),rt(this,"attachments",void 0),rt(this,"scene",void 0),rt(this,"data",void 0),this.scene=t,this.data=n,this.attachments=[]}var t,n,o;return t=e,(n=[{key:"createAttachment",value:function(e,t){var n=new nt(e,t,{},this.data.attachmentDebug,this.scene);return this.attachments.push(n),n}},{key:"getAttachmentsByType",value:function(e){return this.attachments.filter(function(t){return t.type===e})}},{key:"destroy",value:function(){this.attachments.forEach(function(e){return e.destroy()}),delete this.attachments,delete this.getAttachmentsByType,delete this.createAttachment}}])&&ot(t.prototype,n),o&&ot(t,o),e}();function at(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ct=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),st(this,"hitboxFrames",void 0),st(this,"enabled",void 0),st(this,"entity",void 0),this.entity=o,this.hitboxFrames=t.cache.json.get(n.hitboxesKey).frames,this.enabled=!0;for(var r=this.hitboxFrames.map(function(e){return e.hitboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),i=0;i<r;i++)o.getComponent(it).createAttachment("hitbox",{offsetX:0,offsetY:0,width:0,height:0})}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(it).getAttachmentsByType("hitbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hitboxFrames}}])&&at(t.prototype,n),o&&at(t,o),e}(),ut=[qe,$e,{id:"arrow-disabled",transitions:[],onEnter:function(e){e.getComponent(a).sprite.active=!1,e.getComponent(a).sprite.visible=!1,e.getComponent(de).body.enable=!1,e.getComponent(de).body.allowGravity=!1,e.getComponent(ct).disable()},onLeave:function(e){e.getComponent(a).sprite.active=!0,e.getComponent(a).sprite.visible=!0,e.getComponent(de).body.enable=!0,e.getComponent(de).body.allowGravity=!0,e.getComponent(ct).enable()}}];function lt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ft(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ht=function(){function e(){var t,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=void 0,(n="entities")in(t=this)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,this.entities={}}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=this;new Set([].concat(ft(Object.keys(this.entities)),ft(e))).forEach(function(n){var o=t.entities[n];null!=o&&"inactive"!==o||!e.includes(n)?"entering"===o?t.entities[n]="active":"active"!==o||e.includes(n)?"exiting"===o&&(t.entities[n]="inactive"):t.entities[n]="exiting":t.entities[n]="entering"})}},{key:"getEntityIds",value:function(e){return Object.entries(this.entities).filter(function(t){var n=lt(t,2);n[0];return n[1]===e}).map(function(e){return lt(e,1)[0]})}},{key:"destroy",value:function(){this.entities={}}}])&&pt(t.prototype,n),o&&pt(t,o),e}();function yt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var bt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),dt(this,"interactionCircle",void 0),dt(this,"interactionTracker",void 0),dt(this,"debugInteractionCircle",void 0);var o=new Phaser.Geom.Circle(n.x,n.y,n.interactionRadius);if(n.interactionDebug){var r=t.add.circle(n.x,n.y,n.interactionRadius,65280,.5);r.setOrigin(.5,.5),this.debugInteractionCircle=r}this.interactionTracker=new ht,this.interactionCircle=o}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.debugInteractionCircle&&this.debugInteractionCircle.destroy(),this.interactionTracker.destroy(),delete this.interactionCircle,delete this.interactionTracker,delete this.debugInteractionCircle}}])&&yt(t.prototype,n),o&&yt(t,o),e}(),vt="currentArea",mt="currentMarker",gt={maxHealth:"adventurer.maxHealth",health:"adventurer.health"};function wt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ct=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="scene")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.scene=t}var t,n,o;return t=e,(n=[{key:"decreaseHealth",value:function(e){this.scene.persistence.update(gt.health,function(t){return t-e})}},{key:"destroy",value:function(){}}])&&wt(t.prototype,n),o&&wt(t,o),e}(),Pt={id:"enemy-idle",onEnter:function(e){e.getComponent(de).body.velocity.x=0,e.getComponent(a).sprite.anims.play("enemy-idle")},transitions:[{type:fe.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:fe.Conditional,condition:function(e){var t=e.getComponent(bt).interactionTracker.getEntityIds("active"),n=e.getComponent(Re).scene,o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value;if(n.phecs.phEntities.getEntityById(c).hasComponent(Ct))return!0}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return!1},to:"enemy-track-adventurer"}]};function xt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ot=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),kt(this,"hurtboxFrames",void 0),kt(this,"enabled",void 0),kt(this,"entity",void 0),this.entity=o,this.hurtboxFrames=t.cache.json.get(n.hurtboxesKey).frames,this.enabled=!0;for(var r=this.hurtboxFrames.map(function(e){return e.hurtboxes.length}).reduce(function(e,t){return Math.max(e,t)},0),i=0;i<r;i++)o.getComponent(it).createAttachment("hurtbox",{offsetX:0,offsetY:0,width:0,height:0})}var t,n,o;return t=e,(n=[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.entity.getComponent(it).getAttachmentsByType("hurtbox").forEach(function(e){e.disable()})}},{key:"destroy",value:function(){delete this.hurtboxFrames}}])&&xt(t.prototype,n),o&&xt(t,o),e}(),St={id:"enemy-dead",onEnter:function(e){var t=e.getComponent(a).sprite;t.anims.stop(),e.getComponent(de).body.enable=!1,e.getComponent(Ot).disable(),e.getComponent(Re).scene.tweens.add({targets:[t],props:{alpha:0},duration:100,yoyo:!0,repeat:1,onComplete:function(){t.active=!1,t.visible=!1}})},transitions:[]},Et={id:"enemy-stun",onEnter:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(de).body;t.anims.stop(),n.allowGravity=!1,n.velocity.x=0,n.velocity.y=0,e.getComponent(Re).scene.tweens.timeline({tweens:[{targets:t,props:{alpha:.5},duration:100,completeDelay:300},{targets:t,props:{alpha:1},duration:100}]})},onLeave:function(e){e.getComponent(de).body.allowGravity=!0},transitions:[{type:fe.Conditional,condition:function(e){var t=e.getComponent(a).sprite;return!e.getComponent(Re).scene.tweens.isTweening(t)},to:function(e){return e.getComponent(de).body.blocked.down?"enemy-idle":"enemy-fall"}}]},jt=-350,Tt=60,_t=30,At={id:"enemy-jump",onEnter:function(e){e.getComponent(a).sprite.anims.play("enemy-jump"),e.getComponent(de).body.velocity.y=jt},transitions:[{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.velocity.y<=0},to:"enemy-fall"}]},It={id:"enemy-track-adventurer",onEnter:function(e){e.getComponent(a).sprite.anims.play("enemy-jump")},onUpdate:function(e){var t=e.getComponent(Re).scene.phecs.phEntities.getEntities(Ct)[0].getComponent(a).sprite,n=e.getComponent(a).sprite,o=e.getComponent(de).body;n.x<t.x?(o.velocity.x=Tt,n.flipX=!1):n.x>t.x&&(o.velocity.x=-Tt,n.flipX=!0)},transitions:[{type:fe.Timer,delay:1e3,to:"enemy-jump-prep"},{type:fe.Conditional,condition:function(e){var t=e.getComponent(Re).scene,n=e.getComponent(bt).interactionTracker.getEntityIds("active"),o=t.phecs.phEntities.getEntities(Ct)[0].id;return!n.includes(o)},to:"enemy-idle"}]},Rt={id:"enemy-fall",onEnter:function(e){e.getComponent(a).sprite.anims.play("enemy-jump")},transitions:[{type:fe.Conditional,condition:function(e){return e.getComponent(de).body.blocked.down},to:"enemy-idle"}]};function Mt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Lt=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="zone")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i;var a=t.areaManager.getZone(n.zoneBoundaryName);if(null==a)throw new Error("ZoneBoundaryComponent::ZONE_NOT_FOUND");this.zone=new Phaser.Geom.Rectangle(a.x,a.y,a.width,a.height)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.zone}}])&&Mt(t.prototype,n),o&&Mt(t,o),e}(),Dt={id:"enemy-wander",onEnter:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(de).body;n.velocity.x=Phaser.Math.RND.pick([-1,1])*_t,n.velocity.x<0?t.flipX=!0:t.flipX=!1},onUpdate:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(de).body,o=e.getComponent(Lt).zone;Phaser.Geom.Rectangle.ContainsRect(o,t.getBounds())||(n.velocity.x*=-1)},transitions:[{type:fe.Timer,delay:function(){return Phaser.Math.RND.between(500,1500)},to:function(e){return Phaser.Math.RND.pick(["enemy-wander","enemy-idle"])}},{type:fe.Conditional,condition:function(e){var t=e.getComponent(bt).interactionTracker.getEntityIds("active"),n=e.getComponent(Re).scene,o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value;if(n.phecs.phEntities.getEntityById(c).hasComponent(Ct))return!0}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return!1},to:"enemy-track-adventurer"}]},Bt=[Pt,Et,St,{id:"enemy-jump-prep",onEnter:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(Re).scene;t.anims.stop(),n.tweens.timeline({tweens:[{targets:t,props:{scaleY:.8,scaleX:1.2},duration:100,completeDelay:100},{targets:t,props:{scaleY:1,scaleX:1},duration:100}]})},transitions:[{type:fe.Timer,delay:300,to:"enemy-jump"}]},At,Rt,It,Dt],Ht=[{id:"old-lady-idle",onEnter:function(e){e.getComponent(a).sprite.anims.play("old-lady-idle")},transitions:[]}],Ft=[{id:"old-man-idle",onEnter:function(e){e.getComponent(a).sprite.anims.play("old-man-idle")},transitions:[]}],zt=[{id:"sheep-walk-left",onEnter:function(e){e.getComponent(a).sprite.anims.play("sheep-walk"),e.getComponent(a).sprite.flipX=!0,e.getComponent(de).body.velocity.x=-50},transitions:[{type:fe.Conditional,condition:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(Lt).zone;return t.x<n.x},to:"sheep-walk-right"}]},{id:"sheep-walk-right",onEnter:function(e){e.getComponent(a).sprite.anims.play("sheep-walk"),e.getComponent(a).sprite.flipX=!1,e.getComponent(de).body.velocity.x=50},transitions:[{type:fe.Conditional,condition:function(e){var t=e.getComponent(a).sprite,n=e.getComponent(Lt).zone;return t.x+t.width>n.x+n.width},to:"sheep-walk-left"}]}];function Nt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Kt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Xt(this,"maxHealth",void 0),Xt(this,"currentHealth",void 0),Xt(this,"onDeathListeners",void 0),Xt(this,"onDamageListeners",void 0),this.maxHealth=n.maxHealth,this.currentHealth=this.maxHealth,this.onDeathListeners=[],this.onDamageListeners=[]}var t,n,o;return t=e,(n=[{key:"decreaseHealth",value:function(e){var t=this;this.currentHealth-=e,this.currentHealth<=0?this.onDeathListeners.forEach(function(e){return e()}):this.onDamageListeners.forEach(function(e){return e(t.currentHealth)})}},{key:"onDamage",value:function(e){this.onDamageListeners.push(e)}},{key:"onDeath",value:function(e){this.onDeathListeners.push(e)}},{key:"destroy",value:function(){delete this.maxHealth,delete this.currentHealth,delete this.onDeathListeners,delete this.onDamageListeners}}])&&Nt(t.prototype,n),o&&Nt(t,o),e}();function Yt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ut=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Gt(this,"entities1Config",void 0),Gt(this,"entities2Config",void 0),Gt(this,"onHit",void 0),this.entities1Config=t,this.entities2Config=n,this.onHit=o}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=this.entities1Config.entityFetcher(e),n=this.entities2Config.entityFetcher(e),o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value,u=c.getComponent(it).getAttachmentsByType(this.entities1Config.boxType).filter(function(e){return e.isEnabled()}),l=!0,f=!1,p=void 0;try{for(var h,y=n[Symbol.iterator]();!(l=(h=y.next()).done);l=!0){var d=h.value,b=d.getComponent(it).getAttachmentsByType(this.entities2Config.boxType).filter(function(e){return e.isEnabled()});this.doBoxesOverlap(u,b)&&this.onHit(c,d)}}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"doBoxesOverlap",value:function(e,t){var n=!1,o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value;if(n)break;var u=!0,l=!1,f=void 0;try{for(var p,h=t[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var y=p.value;if(n)break;n=c.overlaps(y)}}catch(e){l=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw f}}}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}}])&&Yt(t.prototype,n),o&&Yt(t,o),e}();function Vt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Wt=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=o.getComponent(Kt),i=o.getComponent(Oe).phiniteStateMachine;r.onDamage(function(){i.doTransition({to:"enemy-stun"})}),r.onDeath(function(){i.doTransition({to:"enemy-dead"})})}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){}}])&&Vt(t.prototype,n),o&&Vt(t,o),e}();function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zt(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qt(e){return(Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qt(e,t){return(qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $t=1,en=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Zt(this,Qt(t).call(this,{entityFetcher:function(e){return e.getEntities("arrow").filter(function(e){return"arrow-flying"===e.getComponent(Oe).phiniteStateMachine.currentState.id})},boxType:"hitbox"},{entityFetcher:function(e){return e.getEntities(Wt)},boxType:"hurtbox"},function(e,t){e.getComponent(Oe).phiniteStateMachine.doTransition({to:"arrow-disabled"}),t.getComponent(Kt).decreaseHealth($t)}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qt(e,t)}(t,Ut),t}(),tn={preload:"preload",title:"title",exploration:"exploration",hud:"hud",death:"death",newGame:"newGame",continueGame:"continueGame",prefabTest:"prefabTest"};function nn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function on(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var rn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),on(this,"scene",void 0),on(this,"healthListenerCleanupFn",void 0),this.scene=t}var t,n,o;return t=e,(n=[{key:"start",value:function(e){var t=this;this.healthListenerCleanupFn=this.scene.persistence.onChange(gt.health,function(e){e<=0&&(t.scene.scene.stop(tn.hud),t.scene.scene.pause(tn.exploration),t.scene.scene.launch(tn.death,{respawnAreaKey:t.scene.areaManager.currentAreaKey}))})}},{key:"stop",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn(),delete this.healthListenerCleanupFn}}])&&nn(t.prototype,n),o&&nn(t,o),e}();function an(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var cn,un,ln,fn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),sn(this,"scene",void 0),sn(this,"identifierA",void 0),sn(this,"identifierB",void 0),sn(this,"listeners",void 0),this.scene=t,this.identifierA=n,this.identifierB=o,this.listeners=[]}var t,n,o;return t=e,(n=[{key:"start",value:function(e){var t=this,n=e.getEntities(this.identifierA),o=e.getEntities(this.identifierB),r=this.scene.controls.action,i=!0,a=!1,s=void 0;try{for(var c,u=function(){var e=c.value,n=!0,i=!1,a=void 0;try{for(var s,u=function(){var n=s.value,o=function(){e.getComponent(bt).interactionTracker.getEntityIds("active").includes(n.id)&&t.onInteraction&&t.onInteraction(n)},i=r.onPress(o);t.listeners.push({control:"action",listener:o,listenerCancelFn:i})},l=o[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)u()}catch(e){i=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw a}}},l=n[Symbol.iterator]();!(i=(c=l.next()).done);i=!0)u()}catch(e){a=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw s}}}},{key:"stop",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,r=this.listeners[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){o.value.listenerCancelFn()}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"update",value:function(e){var t=e.getEntities(this.identifierA),n=e.getEntities(this.identifierB),o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value.getComponent(bt).interactionTracker,u=this.getInteractingEntityBs(c,n,"entering"),l=!0,f=!1,p=void 0;try{for(var h,y=u[Symbol.iterator]();!(l=(h=y.next()).done);l=!0){var d=h.value;this.onEnter&&this.onEnter(d)}}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}var b=this.getInteractingEntityBs(c,n,"exiting"),v=!0,m=!1,g=void 0;try{for(var w,C=b[Symbol.iterator]();!(v=(w=C.next()).done);v=!0){var P=w.value;this.onExit&&this.onExit(P)}}catch(e){m=!0,g=e}finally{try{v||null==C.return||C.return()}finally{if(m)throw g}}}}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"destroy",value:function(){this.listeners=[]}},{key:"getInteractingEntityBs",value:function(e,t,n){var o=e.getEntityIds(n);return t.filter(function(e){return o.includes(e.id)})}}])&&an(t.prototype,n),o&&an(t,o),e}();function pn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.TOP="top",e.LEFT="left"}(ln||(ln={}));var yn=10,dn=(hn(cn={},ln.TOP,"indicator-down"),hn(cn,ln.LEFT,"indicator-right"),cn),bn=(hn(un={},ln.TOP,"indicator-down"),hn(un,ln.LEFT,"indicator-right"),un),vn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),hn(this,"sprite",void 0),hn(this,"side",void 0);var r=n.x,i=n.y;this.side=o,this.sprite=t.add.sprite(r,i,dn[o]),this.sprite.setDepth(n.depth),o===ln.TOP?(this.sprite.setOrigin(.5,1),this.sprite.y=i-n.height*n.scaleY/2-yn):o===ln.LEFT&&(this.sprite.setOrigin(1,.5),this.sprite.x=r-n.width*n.scaleX/2-yn)}var t,n,o;return t=e,(n=[{key:"show",value:function(){this.sprite.visible=!0,this.sprite.active=!0,this.sprite.anims.play(bn[this.side])}},{key:"hide",value:function(){this.sprite.visible=!1,this.sprite.active=!1,this.sprite.anims.stop()}},{key:"destroy",value:function(){this.sprite.destroy()}}])&&pn(t.prototype,n),o&&pn(t,o),e}();function mn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var gn=function(){function e(t,n,o){var r,i,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s=void 0,(i="indicator")in(r=this)?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s;var c=n.indicatorSide||ln.TOP,u=o.getComponent(a).sprite;this.indicator=new vn(t,u,c),this.indicator.hide()}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.indicator.destroy()}}])&&mn(t.prototype,n),o&&mn(t,o),e}();function wn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Pn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Cn(this,"toAreaKey",void 0),Cn(this,"toMarker",void 0),this.toAreaKey=n.toAreaKey,this.toMarker=n.toMarker}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.toAreaKey,delete this.toMarker}}])&&wn(t.prototype,n),o&&wn(t,o),e}();function xn(e){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function On(e){return(On=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function En(e,t){return(En=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jn=function(e){function t(e){var n,o,r,i,a,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(r=On(t).call(this,e,Ct,Pn))||"object"!==xn(r)&&"function"!=typeof r?Sn(o):r,i=Sn(n),s=void 0,(a="explorationScene")in i?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s,n.explorationScene=e,n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&En(e,t)}(t,fn),n=t,(o=[{key:"onEnter",value:function(e){e.getComponent(gn).indicator.show()}},{key:"onInteraction",value:function(e){var t=e.getComponent(Pn);this.explorationScene.loadNewArea(t.toAreaKey,t.toMarker)}},{key:"onExit",value:function(e){e.getComponent(gn).indicator.hide()}}])&&kn(n.prototype,o),r&&kn(n,r),t}();function Tn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var An=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_n(this,"scene",void 0),_n(this,"conversation",void 0),_n(this,"entityY",void 0),_n(this,"conversationBoxSprite",void 0),_n(this,"conversationProgressIndex",void 0),this.scene=t,this.conversation=t.cache.json.get("conversations")[n.conversationKey];var r=o.getComponent(a).sprite;this.entityY=r.y,this.conversationProgressIndex=0,this.conversationBoxSprite=t.add.ninePatch(r.x,r.y,0,0,"conversation-box",null,{top:6,left:15,right:15,bottom:12}),this.stopConversation()}var t,n,o;return t=e,(n=[{key:"startConversation",value:function(){this.conversationBoxSprite.alpha=1,this.conversationProgressIndex=0,this.updateConversationText()}},{key:"continueConversation",value:function(){this.hasMoreConversation()?this.conversationProgressIndex+=1:this.stopConversation(),this.updateConversationText()}},{key:"stopConversation",value:function(){this.conversationBoxSprite.alpha=0}},{key:"hasMoreConversation",value:function(){return this.conversationProgressIndex<this.conversation.length-1}},{key:"destroy",value:function(){this.conversationBoxSprite.destroy()}},{key:"updateConversationText",value:function(){var e=this.scene.add.bitmapText(0,0,"compass-24-conversation",this.conversation[this.conversationProgressIndex]);e.setMaxWidth(300),e.setOrigin(.5);var t=e.getTextBounds().local;if(this.conversationBoxSprite.resize(t.width+50,t.height+50),this.conversationBoxSprite.add(e),this.hasMoreConversation()){var n=this.scene.add.sprite(this.conversationBoxSprite.width/2-5,-this.conversationBoxSprite.height/2-2,"indicator-right");n.setOrigin(1,0),n.anims.play("indicator-right"),this.conversationBoxSprite.add(n)}this.conversationBoxSprite.y=this.entityY-this.conversationBoxSprite.height/2-40}}])&&Tn(t.prototype,n),o&&Tn(t,o),e}();function In(e){return(In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Mn(e){return(Mn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dn(e,t){return(Dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bn=function(e){function t(e){var n,o,r,i,a,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(r=Mn(t).call(this,e,Ct,"npc"))||"object"!==In(r)&&"function"!=typeof r?Ln(o):r,i=Ln(n),s=void 0,(a="interacting")in i?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s,n.interacting=!1,n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dn(e,t)}(t,fn),n=t,(o=[{key:"onEnter",value:function(e){e.getComponent(gn).indicator.show()}},{key:"onInteraction",value:function(e){var t=e.getComponent(An);this.interacting?this.interacting&&t.hasMoreConversation()?t.continueConversation():(this.interacting=!1,t.stopConversation()):(this.interacting=!0,e.getComponent(gn).indicator.hide(),t.startConversation())}},{key:"onExit",value:function(e){this.interacting&&(e.getComponent(An).stopConversation(),this.interacting=!1),e.getComponent(gn).indicator.hide()}}])&&Rn(n.prototype,o),r&&Rn(n,r),t}();function Hn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Fn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Fn(this,"isTextboxShowing",void 0),Fn(this,"signs",void 0),Fn(this,"textboxSprite",void 0),Fn(this,"textboxShowTween",void 0),Fn(this,"textboxHideTween",void 0),this.signs=t.cache.json.get("signs"),this.isTextboxShowing=!1;var o=t.cameras.main.width/2;this.textboxSprite=t.add.ninePatch(o,-100,400,100,"textbox",null,{top:10,bottom:10,left:10,right:10}),this.textboxSprite.setDepth(10).setScrollFactor(0);var r=t.add.bitmapText(0,0,"compass-24",this.signs[n.signId].message);r.setOrigin(.5),this.textboxSprite.add(r),this.textboxShowTween=t.tweens.add({targets:this.textboxSprite,y:75,duration:300,ease:Phaser.Math.Easing.Quadratic.Out}).pause(),this.textboxHideTween=t.tweens.add({targets:[this.textboxSprite],y:-100,duration:300,ease:Phaser.Math.Easing.Quadratic.In}).pause()}var t,n,o;return t=e,(n=[{key:"showTextbox",value:function(){this.isTextboxShowing=!0,this.textboxHideTween.pause(),this.textboxShowTween.restart()}},{key:"hideTextbox",value:function(){this.isTextboxShowing=!1,this.textboxShowTween.pause(),this.textboxHideTween.restart()}},{key:"destroy",value:function(){this.textboxShowTween.remove(),this.textboxHideTween.remove(),this.textboxSprite.destroy(),delete this.textboxShowTween,delete this.textboxHideTween,delete this.textboxSprite}}])&&Hn(t.prototype,n),o&&Hn(t,o),e}();function Nn(e){return(Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Kn(e,t){return!t||"object"!==Nn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yn(e){return(Yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gn(e,t){return(Gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Un=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Kn(this,Yn(t).call(this,e,Ct,"sign"))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gn(e,t)}(t,fn),n=t,(o=[{key:"onEnter",value:function(e){e.getComponent(gn).indicator.show()}},{key:"onInteraction",value:function(e){e.getComponent(zn).isTextboxShowing?e.getComponent(zn).hideTextbox():e.getComponent(zn).showTextbox()}},{key:"onExit",value:function(e){e.getComponent(gn).indicator.hide(),e.getComponent(zn).isTextboxShowing&&e.getComponent(zn).hideTextbox()}}])&&Xn(n.prototype,o),r&&Xn(n,r),t}();function Vn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jn=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Wn(this,"isInvulnerable",void 0),Wn(this,"scene",void 0),Wn(this,"sprite",void 0),this.scene=t,this.isInvulnerable=!1,this.sprite=o.getComponent(a).sprite}var t,n,o;return t=e,(n=[{key:"makeInvulnerable",value:function(){var e=this;this.isInvulnerable=!0,this.sprite.alpha=.5;var t=this.scene.time.delayedCall(500,function(){e.sprite.alpha=1,e.isInvulnerable=!1,t.destroy()})}},{key:"destroy",value:function(){delete this.isInvulnerable}}])&&Vn(t.prototype,n),o&&Vn(t,o),e}();function Zn(e){return(Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qn(e,t){return!t||"object"!==Zn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qn(e){return(qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $n(e,t){return($n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var eo=1,to=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Qn(this,qn(t).call(this,{entityFetcher:function(e){return e.getEntities(Ct).filter(function(e){return!e.getComponent(Jn).isInvulnerable})},boxType:"hurtbox"},{entityFetcher:function(e){return e.getEntities(Wt)},boxType:"hurtbox"},function(e,t){e.getComponent(Jn).makeInvulnerable(),e.getComponent(Ct).decreaseHealth(eo)}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$n(e,t)}(t,Ut),t}();function no(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var oo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=e.getEntities(it),n=!0,o=!1,r=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value,u=!0,l=!1,f=void 0;try{for(var p,h=c.getComponent(it).attachments[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){p.value.syncToSprite(c.getComponent(a).sprite)}}catch(e){l=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw f}}}}catch(e){o=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}}}])&&no(t.prototype,n),o&&no(t,o),e}();function ro(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var io=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="boundsFrames")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.boundsFrames=t.cache.json.get(n.boundsKey)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.boundsFrames}}])&&ro(t.prototype,n),o&&ro(t,o),e}();function ao(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var so=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities(io).forEach(function(e){var t=e.getComponent(a).sprite.frame.texture.key,n=e.getComponent(a).sprite.frame.name,o=e.getComponent(io).boundsFrames.find(function(e){return e.key===t&&e.frame===n});if(o){var r=o.bounds,i={x:r.offset.x,y:r.offset.y};e.getComponent(a).sprite.flipX&&(i.x=e.getComponent(a).sprite.width-r.offset.x-r.size.width),e.getComponent(a).sprite.flipY&&(i.y=e.getComponent(a).sprite.height-r.offset.y-r.size.height);var s={x:e.getComponent(a).sprite.displayWidth*e.getComponent(a).sprite.originX/e.getComponent(a).sprite.scale,y:e.getComponent(a).sprite.displayHeight*e.getComponent(a).sprite.originY/e.getComponent(a).sprite.scale};Phaser.Math.RotateAround(i,s.x,s.y,e.getComponent(a).sprite.rotation),e.getComponent(de).body.setSize(r.size.width,r.size.height),e.getComponent(de).body.setOffset(i.x,i.y)}else e.getComponent(de).body.setSize(e.getComponent(a).sprite.width,e.getComponent(a).sprite.height),e.getComponent(de).body.setOffset(0,0);e.getComponent(de).body.updateBounds()})}}])&&ao(t.prototype,n),o&&ao(t,o),e}();function co(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var uo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities(ct).filter(function(e){return e.getComponent(ct).enabled}).forEach(function(e){var t=e.getComponent(a).sprite.frame.texture.key,n=e.getComponent(a).sprite.frame.name,o=e.getComponent(ct).hitboxFrames.find(function(e){return e.key===t&&e.frame===n});if(o&&o.hitboxes)for(var r=e.getComponent(it).getAttachmentsByType("hitbox"),i=0;i<r.length;i++){var s=o.hitboxes[i],c=r[i];s?(c.enable(),c.setConfig({offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):c.disable()}})}}])&&co(t.prototype,n),o&&co(t,o),e}();function lo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var fo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities(Ot).filter(function(e){return e.getComponent(Ot).enabled}).forEach(function(e){var t=e.getComponent(a).sprite.frame.texture.key,n=e.getComponent(a).sprite.frame.name,o=e.getComponent(Ot).hurtboxFrames.find(function(e){return e.key===t&&e.frame===n});if(o&&o.hurtboxes)for(var r=e.getComponent(it).getAttachmentsByType("hurtbox"),i=0;i<r.length;i++){var s=o.hurtboxes[i],c=r[i];s?(c.enable(),c.setConfig({offsetX:s.x,offsetY:s.y,width:s.width,height:s.height})):c.disable()}})}}])&&lo(t.prototype,n),o&&lo(t,o),e}();function po(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ho=function(){function e(t){var n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=void 0,(o="scene")in(n=this)?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,this.scene=t}var t,n,o;return t=e,(n=[{key:"update",value:function(e){var t=e.getEntities(bt),n=!0,o=!1,r=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;this.syncInteractionCircleToEntity(s),this.syncDebugCircle(s)}}catch(e){o=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw r}}var c=!0,u=!1,l=void 0;try{for(var f,p=t[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var h=f.value,y=this.getIntersectingInteractionIds(h,t);h.getComponent(bt).interactionTracker.update(y)}}catch(e){u=!0,l=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}}},{key:"syncInteractionCircleToEntity",value:function(e){var t=e.getComponent(a).sprite;e.getComponent(bt).interactionCircle.setPosition(t.x,t.y)}},{key:"getIntersectingInteractionIds",value:function(e,t){return t.filter(function(t){return t.id!==e.id}).filter(function(t){var n=e.getComponent(bt).interactionCircle,o=t.getComponent(bt).interactionCircle;return Phaser.Geom.Intersects.CircleToCircle(n,o)}).map(function(e){return e.id})}},{key:"syncDebugCircle",value:function(e){var t=e.getComponent(bt).debugInteractionCircle;if(t){var n=e.getComponent(a).sprite,o=this.scene.input.activePointer.positionToCamera(this.scene.cameras.main);t.setPosition(n.x,n.y),Phaser.Geom.Intersects.CircleToCircle(e.getComponent(bt).interactionCircle,new Phaser.Geom.Circle(o.x,o.y,1))?t.setFillStyle(16711680,.5):t.setFillStyle(65280,.5)}}}])&&po(t.prototype,n),o&&po(t,o),e}();function yo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var bo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){e.getEntities(Oe).forEach(function(e){e.getComponent(Oe).phiniteStateMachine.update()})}}])&&yo(t.prototype,n),o&&yo(t,o),e}(),vo={components:[{component:a,data:{texture:"adventurer-core",frame:0}},{component:de,data:{maxVelocityX:350}},Ct,{component:it,data:{attachmentDebug:!1}},{component:Ot,data:{hurtboxesKey:"adventurer-hurtboxes"}},{component:io,data:{boundsKey:"adventurer-bounds"}},{component:bt,data:{interactionRadius:30,interactionDebug:!1}},{component:Oe,data:{stateSet:"adventurer",initialStateId:"adventurer-stand"}},{component:Te},Jn,Re]},mo={components:[{component:a,data:{texture:"arrow",frame:0}},de,{component:it,data:{attachmentDebug:!1}},{component:ct,data:{hitboxesKey:"arrow-hitboxes"}},{component:Oe,data:{stateSet:"arrow",initialStateId:"arrow-disabled"}},{component:io,data:{boundsKey:"arrow-bounds"}}]},go={components:[{component:a,data:{texture:"doors",frame:1,depth:2}},Pn,gn,{component:bt,data:{interactionRadius:40}}]},wo={components:[{component:a,data:{texture:"enemy",frame:0}},de,{component:it,data:{attachmentDebug:!1}},{component:Oe,data:{stateSet:"enemy",initialStateId:"enemy-idle"}},{component:Ot,data:{hurtboxesKey:"enemy-hurtboxes"}},{component:ct,data:{hitboxesKey:"enemy-hitboxes"}},{component:Kt,data:{maxHealth:2}},{component:bt,data:{interactionRadius:220,interactionDebug:!1}},Wt,{component:Lt,data:{zoneBoundaryName:"enemyBounds"}},{component:Re}]};function Co(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Po={components:[a,Oe,{component:bt,data:{interactionRadius:70,interactionDebug:!1}},gn,An,function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="npcId")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.npcId=n.npcId}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.npcId}}])&&Co(t.prototype,n),o&&Co(t,o),e}()]},xo={components:[{component:a,data:{texture:"sheep-walk",frame:0,depth:0}},de,{component:Oe,data:{stateSet:"sheep",initialStateId:"sheep-walk-right"}},{component:Lt,data:{zoneBoundaryName:"sheepBounds"}}]},ko={components:[{component:a,data:{texture:"core-tileset-spritesheet",frame:1128}},{component:bt,data:{interactionRadius:30,interactionDebug:!1}},gn,zn]};function Oo(e){return(Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function So(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Eo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function jo(e){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function To(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _o(e,t){return(_o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ao=function(e){function t(){var e,n,o,r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=jo(t).call(this,{key:tn.exploration}))||"object"!==Oo(o)&&"function"!=typeof o?To(n):o,r=To(e),a=void 0,(i="isLoadingArea")in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,e.isLoadingArea=!1,e}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_o(e,t)}(t,pe),n=t,(o=[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(e){var t=this;this.registerStateSets(),this.registerAreas(),this.registerBackgroundSets(),this.registerSystems(),this.registerPrefabs(),this.cameras.main.fadeOut(0),this.loadNewArea(e.areaKey,e.markerName).then(function(){t.cameras.main.fadeIn(1e3),t.scene.launch(tn.hud)})}},{key:"registerStateSets",value:function(){this.stateRegistrar.registerSets([{id:"adventurer",states:Qe},{id:"arrow",states:ut},{id:"enemy",states:Bt},{id:"sheep",states:zt},{id:"old-lady",states:Ht},{id:"old-man",states:Ft}])}},{key:"registerAreas",value:function(){this.areaManager.registerArea("woollards-farm","woollards-farm","core-tileset","core-tileset"),this.areaManager.registerArea("woollards-house","woollards-house","core-tileset","core-tileset")}},{key:"registerBackgroundSets",value:function(){this.areaManager.registerBackgroundSet("green-hills",["green-hills-1","green-hills-2","green-hills-3","green-hills-4"])}},{key:"registerSystems",value:function(){this.phecs.phSystems.registerSystems([en,rn,jn,Bn,Un,to,oo,so,uo,fo,ho,bo])}},{key:"registerPrefabs",value:function(){this.phecs.phEntities.registerPrefab("adventurer",vo),this.phecs.phEntities.registerPrefab("arrow",mo),this.phecs.phEntities.registerPrefab("door",go),this.phecs.phEntities.registerPrefab("enemy",wo),this.phecs.phEntities.registerPrefab("npc",Po),this.phecs.phEntities.registerPrefab("sheep",xo),this.phecs.phEntities.registerPrefab("sign",ko)}},{key:"loadNewArea",value:function(e,t){var n=this;return new Promise(function(o,i){n.isLoadingArea?i():(n.isLoadingArea=!0,n.time.delayedCall(0,function(){n.controls.stop(),n.phecs.reset(),n.areaManager.unload(),n.areaManager.load(e);var i=n.areaManager.map,s=n.areaManager.tileset,c=n.phecs.phEntities.createPrefab("adventurer",{},2),u=r(i.properties);t?n.areaManager.placeEntityAtMarker(c,t):u.startingMarker&&n.areaManager.placeEntityAtMarker(c,u.startingMarker),u.entityLayerCollisions&&u.entityLayerCollisions.split(",").forEach(function(e){var t=So(e.split(":"),2),o=t[0],r=t[1],i=n.phecs.phEntities.getEntities(o),s=n.areaManager.getTileLayer(r);if(null==s)throw new Error("Layer does not exist for collision pair: ".concat(e));var c=!0,u=!1,l=void 0;try{for(var f,p=i[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var h=f.value.getComponent(a).sprite;n.physics.add.collider(h,s)}}catch(e){u=!0,l=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}}),n.controls.start(),n.phecs.start();var l=n.calculateCameraBounds(i,s),f=l.x,p=l.y,h=l.width,y=l.height;n.cameras.main.setBounds(f,p,h,y),n.cameras.main.startFollow(c.getComponent(a).sprite,!0),n.persistence.set(vt,e),n.persistence.set(mt,t),n.persistence.save(),n.isLoadingArea=!1,o()},[],null))})}},{key:"shutdown",value:function(){this.phecs.shutdown(),this.areaManager.unload()}},{key:"calculateCameraBounds",value:function(e,t){var n=0,o=0,r=e.width*t.tileWidth,i=e.height*t.tileHeight;return r<800&&(n-=(800-r)/2),i<450&&(o-=(450-i)/2),{x:n,y:o,width:r,height:i}}}])&&Eo(n.prototype,o),i&&Eo(n,i),t}();function Io(e){return(Io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ro(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Mo(e,t){return!t||"object"!==Io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Lo(e){return(Lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Do(e,t){return(Do=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Mo(this,Lo(t).call(this,{key:tn.death}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Do(e,t)}(t,pe),n=t,(o=[{key:"create",value:function(e){var t=this;this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY-24,"compass-72","You died").setOrigin(.5),this.add.bitmapText(this.cameras.main.centerX,this.cameras.main.centerY+32,"compass-24","Try again?").setOrigin(.5),this.input.keyboard.once(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,function(){t.cameras.main.fadeOut(1e3,0,0,0,function(e,n){1===n&&(t.scene.stop(tn.exploration),t.scene.stop(tn.hud),t.scene.stop(tn.death),t.scene.start(tn.continueGame))})})}}])&&Ro(n.prototype,o),r&&Ro(n,r),t}();function Ho(e){return(Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function zo(e){return(zo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function No(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xo(e,t){return(Xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ko(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Yo=function(e){function t(){var e,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=zo(t).call(this,{key:tn.prefabTest}))||"object"!==Ho(o)&&"function"!=typeof o?No(n):o,Ko(No(e),"centerDebugCircle",void 0),Ko(No(e),"enemy",void 0),e}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xo(e,t)}(t,pe),n=t,(o=[{key:"create",value:function(){this.phecs.phEntities.registerPrefab("arrow",mo),this.phecs.phSystems.registerSystems([oo,ho,so,fo,uo]),this.stateRegistrar.registerSets([{id:"arrow",states:ut}]);var e=0,t=this.add.text(200,50,"Frame ".concat(e)),n=this.phecs.phEntities.createPrefab("arrow",{},5,0,0);n.getComponent(a).sprite.x=150,n.getComponent(a).sprite.y=200,n.getComponent(a).sprite.setFrame(e),n.getComponent(de).body.allowGravity=!1,n.getComponent(a).sprite.anims.stop(),this.centerDebugCircle=this.add.circle(0,0,10,65280),this.centerDebugCircle.setDepth(100),this.input.keyboard.on("keydown",function(o){switch(o.key){case"ArrowUp":e++;break;case"ArrowDown":e--}n.getComponent(a).sprite.setFrame(e),t.setText("Frame ".concat(e))}),console.log(n),this.input.keyboard.on(Phaser.Input.Keyboard.Events.ANY_KEY_DOWN,function(e){"ArrowLeft"===e.key?n.getComponent(de).body.acceleration.x=-600:"ArrowRight"===e.key?n.getComponent(de).body.acceleration.x=600:" "===e.key&&(n.getComponent(de).body.acceleration.x=0,n.getComponent(de).body.velocity.x=0)}),this.phecs.start(),this.cameras.main.setBackgroundColor("#cccccc"),this.enemy=n,this.events.on(Phaser.Scenes.Events.POST_UPDATE,this.myUpdate,this)}},{key:"myUpdate",value:function(){var e=this.enemy.getComponent(a).sprite.getCenter();this.centerDebugCircle.setPosition(e.x,e.y)}}])&&Fo(n.prototype,o),r&&Fo(n,r),t}();function Go(e){return(Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Uo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Vo(e,t){return!t||"object"!==Go(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wo(e){return(Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jo(e,t){return(Jo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zo=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Vo(this,Wo(t).call(this,{key:tn.preload}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jo(e,t)}(t,pe),n=t,(o=[{key:"preload",value:function(){this.load.image("title-screen","assets/backgrounds/title-screen.png"),this.load.image("vignette-effect","assets/backgrounds/vignette-effect.png"),this.load.image("green-hills-1","assets/backgrounds/green-hills/1.png"),this.load.image("green-hills-2","assets/backgrounds/green-hills/2.png"),this.load.image("green-hills-3","assets/backgrounds/green-hills/3.png"),this.load.image("green-hills-4","assets/backgrounds/green-hills/4.png"),this.load.bitmapFont("compass-72","assets/fonts/compass-72.png","assets/fonts/compass-72.xml"),this.load.bitmapFont("compass-72-title","assets/fonts/compass-72-title.png","assets/fonts/compass-72-title.xml"),this.load.bitmapFont("compass-24","assets/fonts/compass-24.png","assets/fonts/compass-24.xml"),this.load.bitmapFont("compass-24-conversation","assets/fonts/compass-24-conversation.png","assets/fonts/compass-24-conversation.xml"),this.load.bitmapFont("compass-18","assets/fonts/compass-18.png","assets/fonts/compass-18.xml"),this.load.spritesheet("old-lady","assets/sprites/npcs/old-lady.png",{frameWidth:41,frameHeight:66}),this.load.animation("old-lady-animations","assets/animations/old-lady.json"),this.load.spritesheet("old-man","assets/sprites/npcs/old-man.png",{frameWidth:47,frameHeight:66}),this.load.animation("old-man-animations","assets/animations/old-man.json"),this.load.spritesheet("adventurer-core","assets/sprites/adventurer/adventurer-core.png",{frameWidth:100,frameHeight:74}),this.load.spritesheet("adventurer-bow","assets/sprites/adventurer/adventurer-bow.png",{frameWidth:100,frameHeight:74}),this.load.animation("adventurer-animations","assets/animations/adventurer.json"),this.load.json("adventurer-hurtboxes","assets/hurtboxes/adventurer.json"),this.load.json("adventurer-bounds","assets/bounds/adventurer.json"),this.load.image("arrow","assets/sprites/projectiles/arrow.png"),this.load.json("arrow-bounds","assets/bounds/arrow.json"),this.load.json("arrow-hitboxes","assets/hitboxes/arrow.json"),this.load.spritesheet("sheep-walk","assets/sprites/sheep/sheep-walk.png",{frameWidth:40,frameHeight:34}),this.load.animation("sheep-animations","assets/animations/sheep.json"),this.load.spritesheet("enemy","assets/sprites/enemy/enemy.png",{frameWidth:32,frameHeight:32}),this.load.animation("enemy-animations","assets/animations/enemy.json"),this.load.json("enemy-hurtboxes","assets/hurtboxes/enemy.json"),this.load.json("enemy-hitboxes","assets/hitboxes/enemy.json"),this.load.spritesheet("indicator-down","assets/sprites/indicators/indicator-down.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("indicator-right","assets/sprites/indicators/indicator-right.png",{frameWidth:32,frameHeight:32}),this.load.animation("indicator-animations","assets/animations/indicators.json"),this.load.spritesheet("doors","assets/sprites/doors/doors.png",{frameWidth:64,frameHeight:82}),this.load.spritesheet("core-tileset-spritesheet","assets/tilesets/core-tileset.png",{frameHeight:32,frameWidth:32}),this.load.image("core-tileset","assets/tilesets/core-tileset.png"),this.load.tilemapTiledJSON("woollards-farm","assets/tilemaps/woollards-farm.json"),this.load.tilemapTiledJSON("woollards-house","assets/tilemaps/woollards-house.json"),this.load.image("textbox","assets/sprites/conversations/textbox.png"),this.load.json("signs","assets/signs.json"),this.load.image("conversation-box","assets/sprites/conversations/conversation-box.png"),this.load.json("conversations","assets/conversations.json"),this.load.spritesheet("healthbar","assets/sprites/ui/healthbar.png",{frameWidth:124,frameHeight:22})}},{key:"create",value:function(){this.scene.start(tn.title)}}])&&Uo(n.prototype,o),r&&Uo(n,r),t}();function Qo(e){return(Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qo(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function $o(e){return($o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function er(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tr(e,t){return(tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nr={5:0,4:1,3:2,2:3,1:4},or=function(e){function t(){var e,n,o,r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,e=!(o=$o(t).call(this,{key:tn.hud}))||"object"!==Qo(o)&&"function"!=typeof o?er(n):o,r=er(e),a=void 0,(i="healthListenerCleanupFn")in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,e}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tr(e,t)}(t,pe),n=t,(o=[{key:"init",value:function(){var e=this;this.events.once(Phaser.Scenes.Events.SHUTDOWN,function(){return e.shutdown()})}},{key:"create",value:function(){var e=this.add.sprite(80,25,"healthbar",0);this.healthListenerCleanupFn=this.persistence.onChange(gt.health,function(t){e.setFrame(nr[t])})}},{key:"shutdown",value:function(){this.healthListenerCleanupFn&&this.healthListenerCleanupFn()}}])&&qo(n.prototype,o),r&&qo(n,r),t}();function rr(e){return(rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ir(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ar(e){return(ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cr(e,t){return(cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ur(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var lr="archer-adventure-save-game",fr=function(e){function t(e){var n,o,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(r=ar(t).call(this,e))||"object"!==rr(r)&&"function"!=typeof r?sr(o):r,ur(sr(n),"data",void 0),ur(sr(n),"onChangeListeners",void 0),n.data={},n.onChangeListeners={},n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cr(e,t)}(t,Phaser.Plugins.BasePlugin),n=t,(o=[{key:"get",value:function(e){return this.data[e]}},{key:"update",value:function(e,t){var n=t(this.data[e]);this.set(e,n)}},{key:"set",value:function(e,t){this.data[e]=t,(this.onChangeListeners[e]||[]).forEach(function(e){return e(t)})}},{key:"onChange",value:function(e,t){var n=this;return this.onChangeListeners[e]=this.onChangeListeners[e]||[],this.onChangeListeners[e].push(t),function(){var o=n.onChangeListeners[e].findIndex(function(e){return e==t});n.onChangeListeners[e].splice(o,1)}}},{key:"hasSaveGame",value:function(){return null!=localStorage.getItem(lr)}},{key:"save",value:function(){localStorage.setItem(lr,JSON.stringify(this.data))}},{key:"load",value:function(){var e=localStorage.getItem(lr);if(!e)throw new Error("PERSISTENCE_PLUGIN::NO_SAVED_DATA");this.data=JSON.parse(e)}}])&&ir(n.prototype,o),r&&ir(n,r),t}();function pr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var hr=function(){function e(t,n){var o,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="bitmapText")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.bitmapText=t.add.bitmapText(n.x,n.y,n.font,n.text),n.origin&&this.bitmapText.setOrigin(n.origin)}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.bitmapText.destroy()}}])&&pr(t.prototype,n),o&&pr(t,o),e}();function yr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var dr=function(){function e(t,n,o){var r,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(i="indicator")in(r=this)?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a;var s=n.indicatorSide||ln.TOP,c=o.getComponent(hr).bitmapText;this.indicator=new vn(t,c,s),this.indicator.hide()}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.indicator.destroy()}}])&&yr(t.prototype,n),o&&yr(t,o),e}();function br(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var mr=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),vr(this,"callback",void 0),vr(this,"disabled",void 0),this.callback=n.menuActionCallback,this.disabled=n.menuActionDisabled}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){delete this.callback}}])&&br(t.prototype,n),o&&br(t,o),e}();function gr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function wr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Cr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),wr(this,"scene",void 0),wr(this,"selectedIndex",void 0),wr(this,"menuOptions",void 0),this.scene=t,this.selectedIndex=0,this.menuOptions=[]}var t,n,o;return t=e,(n=[{key:"start",value:function(e){var t=this;this.menuOptions=e.getEntities("menuButton"),this.scene.controls.up.onPress(function(){return t.changeMenuSelector("up")}),this.scene.controls.down.onPress(function(){return t.changeMenuSelector("down")}),this.scene.controls.action.onPress(function(){return t.selectMenuOption()}),this.selectFirstEnabledIndicatorPosition()}},{key:"selectFirstEnabledIndicatorPosition",value:function(){var e=this.menuOptions.findIndex(function(e){return!e.getComponent(mr).disabled});this.updateIndicatorPosition(e)}},{key:"changeMenuSelector",value:function(e){var t="up"===e?-1:1,n=0,o=this.selectedIndex,r=this.selectedIndex;do{if(n++,r=Phaser.Math.Wrap(this.selectedIndex+t,0,this.menuOptions.length),n===this.menuOptions.length){r=o;break}}while(this.menuOptions[r].getComponent(mr).disabled);r!=o&&this.updateIndicatorPosition(r)}},{key:"updateIndicatorPosition",value:function(e){this.menuOptions[this.selectedIndex].getComponent(dr).indicator.hide(),this.selectedIndex=e,this.menuOptions[this.selectedIndex].getComponent(dr).indicator.show()}},{key:"selectMenuOption",value:function(){this.menuOptions[this.selectedIndex].getComponent(mr).callback()}}])&&gr(t.prototype,n),o&&gr(t,o),e}();function Pr(e){return(Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function kr(e,t){return!t||"object"!==Pr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Or(e){return(Or=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sr(e,t){return(Sr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Er=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),kr(this,Or(t).call(this,{key:tn.title}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sr(e,t)}(t,pe),n=t,(o=[{key:"init",value:function(){this.phecs.phEntities.registerPrefab("menuTitle",{components:[hr]}),this.phecs.phEntities.registerPrefab("menuButton",{components:[hr,dr,mr]}),this.phecs.phSystems.registerSystems([Cr])}},{key:"create",value:function(){this.add.image(0,0,"title-screen").setOrigin(0,0),this.add.image(0,0,"vignette-effect").setOrigin(0,0).setAlpha(.1),this.phecs.phEntities.createPrefab("menuTitle",{x:400,y:160,origin:.5,font:"compass-72-title",text:"Archer Adventure"}),this.createMenuButtons(),this.phecs.start(),this.controls.start()}},{key:"createMenuButtons",value:function(){var e=this,t=[{text:"Continue Game",menuActionDisabled:!this.persistence.hasSaveGame(),menuActionCallback:function(){e.phecs.stop(),e.scene.stop(),e.scene.start(tn.continueGame)}},{text:"New Game",menuActionCallback:function(){e.phecs.stop(),e.scene.stop(),e.scene.start(tn.newGame)}}],n=250;t.map(function(t){var o=e.phecs.phEntities.createPrefab("menuButton",{x:400,y:n,origin:.5,font:"compass-24",text:t.text,indicatorSide:ln.LEFT,menuActionDisabled:t.menuActionDisabled,menuActionCallback:t.menuActionCallback});t.menuActionDisabled&&(o.getComponent(hr).bitmapText.alpha=.5),n+=40})}}])&&xr(n.prototype,o),r&&xr(n,r),t}();function jr(e){return(jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _r(e,t){return!t||"object"!==jr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ar(e){return(Ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ir(e,t){return(Ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Rr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),_r(this,Ar(t).call(this,{key:tn.newGame}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ir(e,t)}(t,pe),n=t,(o=[{key:"create",value:function(){this.persistence.set(gt.maxHealth,5),this.persistence.set(gt.health,5),this.persistence.set(vt,"woollards-farm"),this.persistence.set(mt,"adventurerStart"),this.persistence.save(),this.scene.start(tn.continueGame)}}])&&Tr(n.prototype,o),r&&Tr(n,r),t}();function Mr(e){return(Mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lr(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Dr(e,t){return!t||"object"!==Mr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Br(e){return(Br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hr(e,t){return(Hr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Dr(this,Br(t).call(this,{key:tn.continueGame}))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hr(e,t)}(t,pe),n=t,(o=[{key:"create",value:function(){this.persistence.load(),this.persistence.set(gt.health,this.persistence.get(gt.maxHealth));var e={areaKey:this.persistence.get(vt),markerName:this.persistence.get(mt)};this.scene.start(tn.exploration,e)}}])&&Lr(n.prototype,o),r&&Lr(n,r),t}(),zr={width:800,height:450,plugins:{global:[{key:"NinePatchPlugin",plugin:o.NinePatchPlugin,start:!0},{key:"ParallaxSpritePlugin",plugin:J,start:!0},{key:"PersistencePlugin",plugin:fr,mapping:"persistence",start:!0}],scene:[{key:"StateRegistrar",plugin:z,mapping:"stateRegistrar"},{key:"Phecs",plugin:R,mapping:"phecs"},{key:"Controls",plugin:ie,mapping:"controls"},{key:"AreaManager",plugin:y,mapping:"areaManager"}]},scene:[Zo,Er,Rr,Fr,Ao,or,Bo,Yo],pixelArt:!0,physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1100}}}};new Phaser.Game(zr)}});